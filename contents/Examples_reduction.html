
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reduction &#8212; OpenMP Application Programming Interface Examples</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e7340bb3dbd8dde6db86f25597f54a1b.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="User-Defined Reduction" href="Examples_udr.html" />
    <link rel="prev" title="The lastprivate Clause" href="Examples_lastprivate.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">OpenMP Application Programming Interface Examples</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Welcome to OMP Jupyter Book
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="Foreword_Chapt.html">
   Foreword
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Introduction_Chapt.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Examples_Chapt.html">
   Examples
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="Chap_parallel_execution.html">
   Parallel Execution
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_ploop.html">
     A Simple Parallel Loop
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_parallel.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       parallel
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_host_teams.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       teams
      </span>
     </code>
     Construct on Host
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_nthrs_nesting.html">
     Controlling the Number of Threads on Multiple Nesting Levels
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_nthrs_dynamic.html">
     Interaction Between the
     <code class="docutils literal notranslate">
      <span class="pre">
       num_threads
      </span>
     </code>
     Clause and
     <code class="docutils literal notranslate">
      <span class="pre">
       omp_set_dynamic
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_fort_do.html">
     Fortran Restrictions on the
     <code class="docutils literal notranslate">
      <span class="pre">
       do
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_nowait.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       nowait
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_collapse.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       collapse
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_linear_in_loop.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       linear
      </span>
     </code>
     Clause in Loop Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_psections.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       parallel
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       sections
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_fpriv_sections.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       firstprivate
      </span>
     </code>
     Clause and the
     <code class="docutils literal notranslate">
      <span class="pre">
       sections
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_single.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       single
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_workshare.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       workshare
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_master.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       master
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_loop.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       loop
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_pra_iterator.html">
     Parallel Random Access Iterator Loop
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_set_dynamic_nthrs.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       omp_set_dynamic
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       omp_set_num_threads
      </span>
     </code>
     Routines
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_get_nthrs.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       omp_get_num_threads
      </span>
     </code>
     Routine
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="Chap_affinity.html">
   OpenMP Affinity
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_affinity.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       proc_bind
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_task_affinity.html">
     Task Affinity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_affinity_display.html">
     Affinity Display
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_affinity_query.html">
     Affinity Query Functions
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="Chap_tasking.html">
   Tasking
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_tasking.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       task
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       taskwait
      </span>
     </code>
     Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_task_priority.html">
     Task Priority
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_task_dep.html">
     Task Dependences
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_taskgroup.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       taskgroup
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_taskyield.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       taskyield
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_taskloop.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       taskloop
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_parallel_master_taskloop.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       parallel
      </span>
      <span class="pre">
       master
      </span>
      <span class="pre">
       taskloop
      </span>
     </code>
     Construct
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="Chap_devices.html">
   Devices
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_defaultmap.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       defaultmap
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_pointer_mapping.html">
     Pointer mapping
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_structure_mapping.html">
     Structure mapping
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_array_sections.html">
     Array Sections in Device Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_array_shaping.html">
     Array Shaping
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_mapper.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       declare
      </span>
      <span class="pre">
       mapper
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_data.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       data
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_unstructured_data.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       enter
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       data
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       exit
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       data
      </span>
     </code>
     Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_update.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       update
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_declare_target.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       declare
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_teams.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       teams
      </span>
     </code>
     Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_async_target_depend.html">
     Asynchronous
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     Execution and Dependences
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_async_target_with_tasks.html">
     Asynchronous
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     with Tasks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_async_target_nowait.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       nowait
      </span>
     </code>
     Clause on
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_async_target_nowait_depend.html">
     Asynchronous
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     with
     <code class="docutils literal notranslate">
      <span class="pre">
       nowait
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       depend
      </span>
     </code>
     Clauses
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_device.html">
     Device Routines
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="Chap_SIMD.html">
   SIMD
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_SIMD.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       simd
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       declare
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       simd
      </span>
     </code>
     Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_SIMD.html#inbranch-and-notinbranch-clauses">
     <code class="docutils literal notranslate">
      <span class="pre">
       inbranch
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       notinbranch
      </span>
     </code>
     Clauses
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_SIMD.html#loop-carried-lexical-forward-dependence">
     Loop-Carried Lexical Forward Dependence
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_linear_modifier.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       ref
      </span>
     </code>
     ,
     <code class="docutils literal notranslate">
      <span class="pre">
       val
      </span>
     </code>
     ,
     <code class="docutils literal notranslate">
      <span class="pre">
       uval
      </span>
     </code>
     Modifiers for
     <code class="docutils literal notranslate">
      <span class="pre">
       linear
      </span>
     </code>
     Clause
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="Chap_synchronization.html">
   Synchronization
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_critical.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       critical
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_worksharing_critical.html">
     Worksharing Constructs Inside a
     <code class="docutils literal notranslate">
      <span class="pre">
       critical
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_barrier_regions.html">
     Binding of
     <code class="docutils literal notranslate">
      <span class="pre">
       barrier
      </span>
     </code>
     Regions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_atomic.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       atomic
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_atomic_restrict.html">
     Restrictions on the
     <code class="docutils literal notranslate">
      <span class="pre">
       atomic
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_flush_nolist.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       flush
      </span>
     </code>
     Construct without a List
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_acquire_release.html">
     Synchronization Based on Acquire/Release Semantics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_ordered.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       ordered
      </span>
     </code>
     Clause and the
     <code class="docutils literal notranslate">
      <span class="pre">
       ordered
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_depobj.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       depobj
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_doacross.html">
     Doacross Loop Nest
    </a>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="Examples_locks.html">
     Lock Routines
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="Examples_init_lock.html">
       The
       <code class="docutils literal notranslate">
        <span class="pre">
         omp_init_lock
        </span>
       </code>
       Routine
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Examples_init_lock_with_hint.html">
       The
       <code class="docutils literal notranslate">
        <span class="pre">
         omp_init_lock_with_hint
        </span>
       </code>
       Routine
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Examples_lock_owner.html">
       Ownership of Locks
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Examples_simple_lock.html">
       Simple Lock Routines
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Examples_nestable_lock.html">
       Nestable Lock Routines
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 current active collapsible-parent">
  <a class="reference internal" href="Chap_data_environment.html">
   Data Environment
  </a>
  <ul class="current collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_threadprivate.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       threadprivate
      </span>
     </code>
     Directive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_default_none.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       default(none)
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_private.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       private
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_fort_loopvar.html">
     Fortran Private Loop Iteration Variables
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_fort_sp_common.html">
     Fortran Restrictions on
     <code class="docutils literal notranslate">
      <span class="pre">
       shared
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       private
      </span>
     </code>
     Clauses with Common Blocks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_fort_sa_private.html">
     Fortran Restrictions on Storage Association with the
     <code class="docutils literal notranslate">
      <span class="pre">
       private
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_carrays_fpriv.html">
     C/C++ Arrays in a
     <code class="docutils literal notranslate">
      <span class="pre">
       firstprivate
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_lastprivate.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       lastprivate
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Reduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_udr.html">
     User-Defined Reduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_scan.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       scan
      </span>
     </code>
     Directive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_copyin.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       copyin
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_copyprivate.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       copyprivate
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="Examples_cpp_reference.html">
     C++ Reference in Data-Sharing Clauses
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="Examples_associate.html">
       Fortran
       <code class="docutils literal notranslate">
        <span class="pre">
         ASSOCIATE
        </span>
       </code>
       Construct
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="Chap_memory_model.html">
   Memory Model
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_mem_model.html">
     The OpenMP Memory Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_allocators.html">
     Memory Allocators
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_fort_race.html">
     Race Conditions Caused by Implied Copies of Shared Variables in Fortran
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="Chap_program_control.html">
   Program Control
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_cond_comp.html">
     Conditional Compilation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_icv.html">
     Internal Control Variables (ICVs)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_standalone.html">
     Placement of
     <code class="docutils literal notranslate">
      <span class="pre">
       flush
      </span>
     </code>
     ,
     <code class="docutils literal notranslate">
      <span class="pre">
       barrier
      </span>
     </code>
     ,
     <code class="docutils literal notranslate">
      <span class="pre">
       taskwait
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       taskyield
      </span>
     </code>
     Directives
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_cancellation.html">
     Cancellation Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_requires.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       requires
      </span>
     </code>
     Directive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_variant.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       declare
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       variant
      </span>
     </code>
     Directive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_metadirective.html">
     Metadirective Directive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_nested_loop.html">
     Nested Loop Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_nesting_restrict.html">
     Restrictions on Nesting of Regions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_offload.html">
     Target Offload
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="History.html">
   Document Revision History
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/contents/Examples_reduction.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/passlab/Examples"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/passlab/Examples/issues/new?title=Issue%20on%20page%20%2Fcontents/Examples_reduction.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/passlab/Examples/main?urlpath=lab/tree/notebook/contents/Examples_reduction.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i>
            Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-reduction-clause">
   The
   <code class="docutils literal notranslate">
    <span class="pre">
     reduction
    </span>
   </code>
   Clause
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#task-reduction">
   Task Reduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reduction-on-combined-target-constructs">
   Reduction on Combined Target Constructs
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#task-reduction-with-target-constructs">
   Task Reduction with Target Constructs
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#taskloop-reduction">
   Taskloop Reduction
  </a>
 </li>
</ul>

        </nav>
        
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="reduction">
<h1>Reduction<a class="headerlink" href="#reduction" title="Permalink to this headline">¶</a></h1>
<p>This section covers ways to perform reductions in parallel, task, taskloop, and SIMD regions.</p>
<div class="section" id="the-reduction-clause">
<h2>The <code class="docutils literal notranslate"><span class="pre">reduction</span></code> Clause<a class="headerlink" href="#the-reduction-clause" title="Permalink to this headline">¶</a></h2>
<p>The following example demonstrates the <code class="docutils literal notranslate"><span class="pre">reduction</span></code> clause; note that some  reductions can be expressed in the loop in several ways, as shown for the <code class="docutils literal notranslate"><span class="pre">max</span></code>  and <code class="docutils literal notranslate"><span class="pre">min</span></code> reductions below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//%compiler: clang
//%cflags: -fopenmp

/*
* name: reduction.1c
* type: C
* version: omp_3.1
*/
#include &lt;math.h&gt;
void reduction1(float *x, int *y, int n)
{
  int i, b, c;
  float a, d;
  a = 0.0;
  b = 0;
  c = y[0];
  d = x[0];
  #pragma omp parallel for private(i) shared(x, y, n) \
                          reduction(+:a) reduction(^:b) \
                          reduction(min:c) reduction(max:d)
    for (i=0; i&lt;n; i++) {
      a += x[i];
      b ^= y[i];
      if (c &gt; y[i]) c = y[i];
      d = fmaxf(d,x[i]);
    }
}

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>
! name: reduction.1f
! type: F-free
SUBROUTINE REDUCTION1(A, B, C, D, X, Y, N)
    REAL :: X(*), A, D
    INTEGER :: Y(*), N, B, C
    INTEGER :: I
    A = 0
    B = 0
    C = Y(1)
    D = X(1)
    !$OMP PARALLEL DO PRIVATE(I) SHARED(X, Y, N) REDUCTION(+:A) &amp;
    !$OMP&amp; REDUCTION(IEOR:B) REDUCTION(MIN:C)  REDUCTION(MAX:D)
      DO I=1,N
        A = A + X(I)
        B = IEOR(B, Y(I))
        C = MIN(C, Y(I))
        IF (D &lt; X(I)) D = X(I)
      END DO

END SUBROUTINE REDUCTION1

</pre></div>
</div>
</div>
</div>
<p>A common implementation of the preceding example is to treat it as if it had been  written as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//%compiler: clang
//%cflags: -fopenmp

/*
* name: reduction.2c
* type: C
*/
#include &lt;limits.h&gt;
#include &lt;math.h&gt;
void reduction2(float *x, int *y, int n)
{
  int i, b, b_p, c, c_p;
  float a, a_p, d, d_p;
  a = 0.0f;
  b = 0;
  c = y[0];
  d = x[0];
  #pragma omp parallel shared(a, b, c, d, x, y, n) \
                          private(a_p, b_p, c_p, d_p)
  {
    a_p = 0.0f;
    b_p = 0;
    c_p = INT_MAX;
    d_p = -HUGE_VALF;
    #pragma omp for private(i)
    for (i=0; i&lt;n; i++) {
      a_p += x[i];
      b_p ^= y[i];
      if (c_p &gt; y[i]) c_p = y[i];
      d_p = fmaxf(d_p,x[i]);
    }
    #pragma omp critical
    {
      a += a_p;
      b ^= b_p;
      if( c &gt; c_p ) c = c_p;
      d = fmaxf(d,d_p);
    }
  }
}

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>
! name: reduction.2f
! type: F-free
  SUBROUTINE REDUCTION2(A, B, C, D, X, Y, N)
    REAL :: X(*), A, D
    INTEGER :: Y(*), N, B, C
    REAL :: A_P, D_P
    INTEGER :: I, B_P, C_P
    A = 0
    B = 0
    C = Y(1)
    D = X(1)
    !$OMP PARALLEL SHARED(X, Y, A, B, C, D, N) &amp;
    !$OMP&amp;         PRIVATE(A_P, B_P, C_P, D_P)
      A_P = 0.0
      B_P = 0
      C_P = HUGE(C_P)
      D_P = -HUGE(D_P)
      !$OMP DO PRIVATE(I)
      DO I=1,N
        A_P = A_P + X(I)
        B_P = IEOR(B_P, Y(I))
        C_P = MIN(C_P, Y(I))
        IF (D_P &lt; X(I)) D_P = X(I)
      END DO
      !$OMP CRITICAL
        A = A + A_P
        B = IEOR(B, B_P)
        C = MIN(C, C_P)
        D = MAX(D, D_P)
      !$OMP END CRITICAL
    !$OMP END PARALLEL
  END SUBROUTINE REDUCTION2

</pre></div>
</div>
</div>
</div>
<p>The following program is non-conforming because the reduction is on the  <strong>intrinsic procedure name</strong> <code class="docutils literal notranslate"><span class="pre">MAX</span></code> but that name has been redefined to be the variable  named <code class="docutils literal notranslate"><span class="pre">MAX</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>
! name: reduction.3f
! type: F-free
 PROGRAM REDUCTION_WRONG
 MAX = HUGE(0)
 M = 0

 !$OMP PARALLEL DO REDUCTION(MAX: M)
! MAX is no longer the intrinsic so this is non-conforming
 DO I = 1, 100
    CALL SUB(M,I)
 END DO

 END PROGRAM REDUCTION_WRONG

 SUBROUTINE SUB(M,I)
    M = MAX(M,I)
 END SUBROUTINE SUB

</pre></div>
</div>
</div>
</div>
<p>The following conforming program performs the reduction using the  <strong>intrinsic procedure name</strong> <code class="docutils literal notranslate"><span class="pre">MAX</span></code> even though the intrinsic <code class="docutils literal notranslate"><span class="pre">MAX</span></code> has been renamed  to <code class="docutils literal notranslate"><span class="pre">REN</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>
! name: reduction.4f
! type: F-free
MODULE M
   INTRINSIC MAX
END MODULE M

PROGRAM REDUCTION3
   USE M, REN =&gt; MAX
   N = 0
!$OMP PARALLEL DO REDUCTION(REN: N)     ! still does MAX
   DO I = 1, 100
      N = MAX(N,I)
   END DO
END PROGRAM REDUCTION3

</pre></div>
</div>
</div>
</div>
<p>The following conforming program performs the reduction using   <em>intrinsic procedure name</em>  <code class="docutils literal notranslate"><span class="pre">MAX</span></code> even though the intrinsic <code class="docutils literal notranslate"><span class="pre">MAX</span></code> has been renamed  to <code class="docutils literal notranslate"><span class="pre">MIN</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>
! name: reduction.5f
! type: F-free
MODULE MOD
   INTRINSIC MAX, MIN
END MODULE MOD

PROGRAM REDUCTION4
   USE MOD, MIN=&gt;MAX, MAX=&gt;MIN
   REAL :: R
   R = -HUGE(0.0)

!$OMP PARALLEL DO REDUCTION(MIN: R)     ! still does MAX
   DO I = 1, 1000
      R = MIN(R, SIN(REAL(I)))
   END DO
   PRINT *, R
END PROGRAM REDUCTION4

</pre></div>
</div>
</div>
</div>
<p>The following example is non-conforming because the initialization (<code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">=</span>&#160; <span class="pre">0</span></code>) of the original list item <code class="docutils literal notranslate"><span class="pre">a</span></code> is not synchronized with the update of  <code class="docutils literal notranslate"><span class="pre">a</span></code> as a result of the reduction computation in the <code class="docutils literal notranslate"><span class="pre">for</span></code> loop. Therefore,  the example may print an incorrect value for <code class="docutils literal notranslate"><span class="pre">a</span></code>.</p>
<p>To avoid this problem, the initialization of the original list item <code class="docutils literal notranslate"><span class="pre">a</span></code>  should complete before any update of <code class="docutils literal notranslate"><span class="pre">a</span></code> as a result of the <code class="docutils literal notranslate"><span class="pre">reduction</span></code>  clause. This can be achieved by adding an explicit barrier after the assignment  <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">=</span> <span class="pre">0</span></code>, or by enclosing the assignment <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">=</span> <span class="pre">0</span></code> in a <code class="docutils literal notranslate"><span class="pre">single</span></code>  directive (which has an implied barrier), or by initializing <code class="docutils literal notranslate"><span class="pre">a</span></code> before  the start of the <code class="docutils literal notranslate"><span class="pre">parallel</span></code> region.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//%compiler: clang
//%cflags: -fopenmp

/*
* name: reduction.6c
* type: C
*/
#include &lt;stdio.h&gt;

int main (void)
{
  int a, i;

  #pragma omp parallel shared(a) private(i)
  {
    #pragma omp master
    a = 0;

    // To avoid race conditions, add a barrier here.

    #pragma omp for reduction(+:a)
    for (i = 0; i &lt; 10; i++) {
        a += i;
    }

    #pragma omp single
    printf (&quot;Sum is %d\n&quot;, a);
  }
  return 0;
}

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>
! name: reduction.6f
! type: F-fixed
      INTEGER A, I

!$OMP PARALLEL SHARED(A) PRIVATE(I)

!$OMP MASTER
      A = 0
!$OMP END MASTER

      ! To avoid race conditions, add a barrier here.

!$OMP DO REDUCTION(+:A)
      DO I= 0, 9
         A = A + I
      END DO

!$OMP SINGLE
      PRINT *, &quot;Sum is &quot;, A
!$OMP END SINGLE

!$OMP END PARALLEL
      END

</pre></div>
</div>
</div>
</div>
<p>The following example demonstrates the reduction of array  <em>a</em> .  In C/C++ this is illustrated by the explicit use of an array section  <em>a[0:N]</em>  in the <code class="docutils literal notranslate"><span class="pre">reduction</span></code> clause.  The corresponding Fortran example uses array syntax supported in the base language.  As of the OpenMP 4.5 specification the explicit use of array section in the <code class="docutils literal notranslate"><span class="pre">reduction</span></code> clause in Fortran is not permitted.  But this oversight has been fixed in the OpenMP 5.0 specification.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//%compiler: clang
//%cflags: -fopenmp

/*
* name: reduction.7c
* type: C
* version: omp_4.5
*/
#include &lt;stdio.h&gt;

#define N 100
void init(int n, float (*b)[N]);

int main(){

  int i,j;
  float a[N], b[N][N];

  init(N,b);

  for(i=0; i&lt;N; i++) a[i]=0.0e0;

  #pragma omp parallel for reduction(+:a[0:N]) private(j)
  for(i=0; i&lt;N; i++){
    for(j=0; j&lt;N; j++){
       a[j] +=  b[i][j];
    }
  }
  printf(&quot; a[0] a[N-1]: %f %f\n&quot;, a[0], a[N-1]);

  return 0;
}

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>
! name: reduction.7f
! type: F-free
program array_red

  integer,parameter :: n=100
  integer           :: j
  real              :: a(n), b(n,n)

  call init(n,b)

  a(:) = 0.0e0

  !$omp parallel do reduction(+:a)
  do j = 1, n
     a(:) = a(:) + b(:,j)
  end do

  print*, &quot; a(1) a(n): &quot;, a(1), a(n)

end program

</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="task-reduction">
<h2>Task Reduction<a class="headerlink" href="#task-reduction" title="Permalink to this headline">¶</a></h2>
<p>In OpenMP 5.0 the <code class="docutils literal notranslate"><span class="pre">task_reduction</span></code> clause was created for the <code class="docutils literal notranslate"><span class="pre">taskgroup</span></code> construct,  to allow reductions among explicit tasks that have an <code class="docutils literal notranslate"><span class="pre">in_reduction</span></code> clause.</p>
<p>In the  <em>task_reduction.1</em>  example below a reduction is performed as the algorithm traverses a linked list. The reduction statement is assigned to be an explicit task using a <code class="docutils literal notranslate"><span class="pre">task</span></code> construct and is specified to be a reduction participant with  the <code class="docutils literal notranslate"><span class="pre">in_reduction</span></code> clause. A <code class="docutils literal notranslate"><span class="pre">taskgroup</span></code> construct encloses the tasks participating in the reduction, and specifies, with the <code class="docutils literal notranslate"><span class="pre">task_reduction</span></code> clause, that the taskgroup has tasks participating in a reduction.  After the <code class="docutils literal notranslate"><span class="pre">taskgroup</span></code> region the original variable will contain  the final value of the reduction.</p>
<p>Note: The  <em>res</em>  variable is private in the  <em>linked_list_sum</em>  routine and is not required to be shared (as in the case of a <code class="docutils literal notranslate"><span class="pre">parallel</span></code> construct reduction).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//%compiler: clang
//%cflags: -fopenmp

/*
* name:       task_reduction.1c
* type:       C
*/

#include&lt;stdlib.h&gt;
#include&lt;stdio.h&gt;
#define N 10

typedef struct node_tag {
    int val;
    struct node_tag *next;
} node_t;

int linked_list_sum(node_t *p)
{
    int res = 0;

    #pragma omp taskgroup task_reduction(+: res)
    {
        node_t* aux = p;
        while(aux != 0)
        {
            #pragma omp task in_reduction(+: res)
            res += aux-&gt;val;

            aux = aux-&gt;next;
        }
    }
    return res;
}


int main(int argc, char *argv[]) {
    int i;
//                           Create the root node.
    node_t* root = (node_t*) malloc(sizeof(node_t));
    root-&gt;val = 1;

    node_t* aux = root;

//                           Create N-1 more nodes.
    for(i=2;i&lt;=N;++i){
        aux-&gt;next = (node_t*) malloc(sizeof(node_t));
        aux = aux-&gt;next;
        aux-&gt;val = i;
    }

    aux-&gt;next = 0;

    #pragma omp parallel
    #pragma omp single
    {
        int result = linked_list_sum(root);
        printf( &quot;Calculated: %d  Analytic:%d\n&quot;, result, (N*(N+1)/2) );
    }

    return 0;
}


</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>
! name:       task_reduction.1f90
! type:       F-free

module m
    type node_t
        integer :: val
        type(node_t), pointer :: next
    end type
end module m

function linked_list_sum(p) result(res)
    use m
    implicit none
    type(node_t), pointer :: p
    type(node_t), pointer :: aux
    integer :: res

    res = 0

    !$omp taskgroup task_reduction(+: res)
        aux =&gt; p
        do while (associated(aux))
            !$omp task in_reduction(+: res)
                res = res + aux%val
            !$omp end task
            aux =&gt; aux%next
        end do
    !$omp end taskgroup
end function linked_list_sum


program main
    use m
    implicit none
    type(node_t), pointer :: root, aux
    integer :: res, i
    integer, parameter :: N=10

    interface
        function linked_list_sum(p) result(res)
            use m
            implicit none
            type(node_t), pointer :: p
            integer :: res
        end function
    end interface
!                       Create the root node.
    allocate(root)
    root%val = 1
    aux =&gt; root

!                       Create N-1 more nodes.
    do i = 2,N
        allocate(aux%next)
        aux =&gt; aux%next
        aux%val = i
    end do

    aux%next =&gt; null()

    !$omp parallel
    !$omp single
        res = linked_list_sum(root)
        print *, &quot;Calculated:&quot;, res, &quot; Analytic:&quot;, (N*(N+1))/2
    !$omp end single
    !$omp end parallel

end program main


</pre></div>
</div>
</div>
</div>
<p>In OpenMP 5.0 the <code class="docutils literal notranslate"><span class="pre">task</span></code>  <em>reduction-modifier</em>  for the <code class="docutils literal notranslate"><span class="pre">reduction</span></code> clause was introduced to provide a means of performing reductions among implicit and explicit tasks.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">reduction</span></code> clause of a <code class="docutils literal notranslate"><span class="pre">parallel</span></code> or worksharing construct may specify the <code class="docutils literal notranslate"><span class="pre">task</span></code>  <em>reduction-modifier</em>  to include explicit task reductions within their region, provided the reduction operators ( <em>reduction-identifiers</em> ) and variables ( <em>list items</em> ) of the participating tasks match those of the implicit tasks.</p>
<p>There are 2 reduction use cases (identified by USE CASE #) in the  <em>task_reduction.2</em>  example below.</p>
<p>In USE CASE 1 a <code class="docutils literal notranslate"><span class="pre">task</span></code> modifier in the <code class="docutils literal notranslate"><span class="pre">reduction</span></code> clause  of the <code class="docutils literal notranslate"><span class="pre">parallel</span></code> construct is used to include the reductions of any  participating tasks, those with an <code class="docutils literal notranslate"><span class="pre">in_reduction</span></code> clause and matching   <em>reduction-identifiers</em>  (<code class="docutils literal notranslate"><span class="pre">+</span></code>) and list items (<code class="docutils literal notranslate"><span class="pre">x</span></code>).</p>
<p>Note, a <code class="docutils literal notranslate"><span class="pre">taskgroup</span></code> construct (with a <code class="docutils literal notranslate"><span class="pre">task_reduction</span></code> clause) in not necessary to scope the explicit task reduction (as seen in the example above).  Hence, even without the implicit task reduction statement (without the C <code class="docutils literal notranslate"><span class="pre">x++</span></code>   and Fortran <code class="docutils literal notranslate"><span class="pre">x=x+1</span></code> statements), the <code class="docutils literal notranslate"><span class="pre">task</span></code>  <em>reduction-modifier</em>   in a <code class="docutils literal notranslate"><span class="pre">reduction</span></code> clause of the <code class="docutils literal notranslate"><span class="pre">parallel</span></code> construct can be used to avoid having to create a <code class="docutils literal notranslate"><span class="pre">taskgroup</span></code> construct  (and its <code class="docutils literal notranslate"><span class="pre">task_reduction</span></code> clause) around the task generating structure.</p>
<p>In USE CASE 2 tasks participating in the reduction are within a worksharing region (a parallel worksharing-loop construct). Here, too, no <code class="docutils literal notranslate"><span class="pre">taskgroup</span></code> is required, and the  <em>reduction-identifier</em>  (<code class="docutils literal notranslate"><span class="pre">+</span></code>) and list item (variable <code class="docutils literal notranslate"><span class="pre">x</span></code>) match as required.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//%compiler: clang
//%cflags: -fopenmp

/*
* name:       task_reduction.2.c
* type:       C
* version: omp_5.0
*/
#include &lt;stdio.h&gt;
int main(void){
   int N=100, M=10;
   int i, x;

// USE CASE 1  explicit-task reduction + parallel reduction clause
   x=0;
   #pragma omp parallel num_threads(M) reduction(task,+:x)
   {

     x++;                // implicit task reduction statement

     #pragma omp single
     for(i=0;i&lt;N;i++)
       #pragma omp task in_reduction(+:x)
       x++;

   }
   printf(&quot;x=%d  =M+N\n&quot;,x);  // x= 110  =M+N


// USE CASE 2  task reduction +  worksharing reduction clause
   x=0;
   #pragma omp parallel for num_threads(M) reduction(task,+:x)
   for(i=0; i&lt; N; i++){

      x++;

      if( i%2 == 0){
       #pragma omp task in_reduction(+:x)
       x--;
      }
   }
   printf(&quot;x=%d  =N-N/2\n&quot;,x);  // x= 50  =N-N/2

   return 0;
}

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>
! name:       task_reduction.2.f90
! type:       F-free
! version:    omp_5.0

program task_modifier

   integer :: N=100, M=10
   integer :: i, x

! USE CASE 1  explicit-task reduction + parallel reduction clause
   x=0
   !$omp parallel num_threads(M) reduction(task,+:x)

     x=x+1                   !! implicit task reduction statement

     !$omp single
       do i = 1,N
         !$omp task in_reduction(+:x)
           x=x+1
         !$omp end task
       end do
     !$omp end single

   !$omp end parallel
   write(*,&#39;(&quot;x=&quot;,I0,&quot; =M+N&quot;)&#39;) x   ! x= 110 =M+N


! USE CASE 2  task reduction +  worksharing reduction clause
   x=0
   !$omp parallel do num_threads(M) reduction(task,+:x)
     do i = 1,N

        x=x+1

        if( mod(i,2) == 0) then
           !$omp task in_reduction(+:x)
             x=x-1
           !$omp end task
        endif

     end do
   write(*,&#39;(&quot;x=&quot;,I0,&quot;  =N-N/2&quot;)&#39;) x   ! x= 50 =N-N/2

end program

</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="reduction-on-combined-target-constructs">
<h2>Reduction on Combined Target Constructs<a class="headerlink" href="#reduction-on-combined-target-constructs" title="Permalink to this headline">¶</a></h2>
<p>When a <code class="docutils literal notranslate"><span class="pre">reduction</span></code> clause appears on a combined construct that combines  a <code class="docutils literal notranslate"><span class="pre">target</span></code> construct with another construct, there is an implicit map  of the list items with a <code class="docutils literal notranslate"><span class="pre">tofrom</span></code> map type for the <code class="docutils literal notranslate"><span class="pre">target</span></code> construct.  Otherwise, the list items (if they are scalar variables) would be  treated as firstprivate by default in the <code class="docutils literal notranslate"><span class="pre">target</span></code> construct, which  is unlikely to provide the intended behavior since the result of the reduction that is in the firstprivate variable would be discarded  at the end of the <code class="docutils literal notranslate"><span class="pre">target</span></code> region.</p>
<p>In the following example, the use of the <code class="docutils literal notranslate"><span class="pre">reduction</span></code> clause on <code class="docutils literal notranslate"><span class="pre">sum1</span></code> or <code class="docutils literal notranslate"><span class="pre">sum2</span></code> should, by default, result in an implicit <code class="docutils literal notranslate"><span class="pre">tofrom</span></code> map for that variable. So long as neither <code class="docutils literal notranslate"><span class="pre">sum1</span></code> nor <code class="docutils literal notranslate"><span class="pre">sum2</span></code> were already present on the device, the mapping behavior ensures the value for <code class="docutils literal notranslate"><span class="pre">sum1</span></code> computed in the first <code class="docutils literal notranslate"><span class="pre">target</span></code> construct is used in the second <code class="docutils literal notranslate"><span class="pre">target</span></code> construct.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//%compiler: clang
//%cflags: -fopenmp

/*
* name: target_reduction.1.c
* type: C
* version: omp_5.0
*/
#include &lt;stdio.h&gt;
int f(int);
int g(int);
int main()
{
   int sum1=0, sum2=0;
   int i;
   const int n = 100;

   #pragma omp target teams distribute reduction(+:sum1)
   for (int i = 0; i &lt; n; i++) {
      sum1 += f(i);
   }

   #pragma omp target teams distribute reduction(+:sum2)
   for (int i = 0; i &lt; n; i++) {
      sum2 += g(i) * sum1;
   }

   printf(  &quot;sum1 = %d, sum2 = %d\n&quot;, sum1, sum2);
   //OUTPUT: sum1 = 9900, sum2 = 147015000
   return 0;
}

int f(int res){ return res*2; }
int g(int res){ return res*3; }

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>
! name: target_reduction.1.f90
! type: F-free
! version: omp_5.0
program target_reduction_ex1
   interface
      function f(res)
             integer :: f, res
          end function
      function g(res)
             integer :: g, res
          end function
   end interface
   integer :: sum1, sum2, i
   integer, parameter :: n = 100
   sum1 = 0
   sum2 = 0
   !$omp target teams distribute reduction(+:sum1)
       do i=1,n
          sum1 = sum1 + f(i)
       end do
   !$omp target teams distribute reduction(+:sum2)
       do i=1,n
          sum2 = sum2 + g(i)*sum1
       end do
   print *, &quot;sum1 = &quot;, sum1, &quot;, sum2 = &quot;, sum2
   !!OUTPUT: sum1 =     10100 , sum2 = 153015000
end program


integer function f(res)
   integer :: res
   f = res*2
end function
integer function g(res)
   integer :: res
   g = res*3
end function

</pre></div>
</div>
</div>
</div>
<p>In next example,  the variables <code class="docutils literal notranslate"><span class="pre">sum1</span></code> and <code class="docutils literal notranslate"><span class="pre">sum2</span></code> remain on the device for the duration of the <code class="docutils literal notranslate"><span class="pre">target</span></code> <code class="docutils literal notranslate"><span class="pre">data</span></code> region so that it is their device copies that are updated by the reductions. Note the significance of mapping <code class="docutils literal notranslate"><span class="pre">sum1</span></code> on the second <code class="docutils literal notranslate"><span class="pre">target</span></code> construct; otherwise, it would be treated by default as firstprivate and the result computed for <code class="docutils literal notranslate"><span class="pre">sum1</span></code> in the prior <code class="docutils literal notranslate"><span class="pre">target</span></code> region may not be used. Alternatively, a <code class="docutils literal notranslate"><span class="pre">target</span></code> <code class="docutils literal notranslate"><span class="pre">update</span></code> construct could be used between the two <code class="docutils literal notranslate"><span class="pre">target</span></code> constructs to update the host version of <code class="docutils literal notranslate"><span class="pre">sum1</span></code> with the value that is in the corresponding device version after the completion of the first construct.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//%compiler: clang
//%cflags: -fopenmp

/*
* name: target_reduction.2.c
* type: C
* version: omp_5.0
*/
#include &lt;stdio.h&gt;
int f(int);
int g(int);
int main()
{
   int sum1=0, sum2=0;
   int i;
   const int n = 100;

   #pragma omp target data map(sum1,sum2)
   {
      #pragma omp target teams distribute reduction(+:sum1)
      for (int i = 0; i &lt; n; i++) {
         sum1 += f(i);
      }

      #pragma omp target teams distribute map(sum1) reduction(+:sum2)
      for (int i = 0; i &lt; n; i++) {
         sum2 += g(i) * sum1;
      }
   }
   printf(  &quot;sum1 = %d, sum2 = %d\n&quot;, sum1, sum2);
   //OUTPUT: sum1 = 9900, sum2 = 147015000
   return 0;
}

int f(int res){ return res*2; }
int g(int res){ return res*3; }

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>
! name: target_reduction.2.f90
! type: F-free
! version: omp_5.0

program target_reduction_ex2
   interface
      function f(res)
             integer :: f, res
          end function
      function g(res)
             integer :: g, res
          end function
   end interface
   integer :: sum1, sum2, i
   integer, parameter :: n = 100
   sum1 = 0
   sum2 = 0
   !$omp target data map(sum1, sum2)
       !$omp target teams distribute reduction(+:sum1)
           do i=1,n
              sum1 = sum1 + f(i)
           end do
       !$omp target teams distribute map(sum1) reduction(+:sum2)
           do i=1,n
              sum2 = sum2 + g(i)*sum1
           end do
   !$omp end target data
   print *, &quot;sum1 = &quot;, sum1, &quot;, sum2 = &quot;, sum2
   !!OUTPUT: sum1 =     10100 , sum2 = 153015000
end program


integer function f(res)
   integer :: res
   f = res*2
end function
integer function g(res)
   integer :: res
   g = res*3
end function

</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="task-reduction-with-target-constructs">
<h2>Task Reduction with Target Constructs<a class="headerlink" href="#task-reduction-with-target-constructs" title="Permalink to this headline">¶</a></h2>
<p>The following examples illustrate how task reductions can apply to target tasks that result from a <code class="docutils literal notranslate"><span class="pre">target</span></code> construct with the <code class="docutils literal notranslate"><span class="pre">in_reduction</span></code> clause. Here, the <code class="docutils literal notranslate"><span class="pre">in_reduction</span></code> clause specifies that the target task participates in the task reduction defined in the scope of the enclosing <code class="docutils literal notranslate"><span class="pre">taskgroup</span></code> construct. Partial results from all tasks participating in the task reduction will be combined (in some order) into the original variable listed in the <code class="docutils literal notranslate"><span class="pre">task_reduction</span></code> clause before exiting the <code class="docutils literal notranslate"><span class="pre">taskgroup</span></code> region.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//%compiler: clang
//%cflags: -fopenmp

/*
* name: target_task_reduction.1.c
* type: C
* version: omp_5.0
*/
#include &lt;stdio.h&gt;
#pragma omp declare target to(device_compute)
void device_compute(int *);
void host_compute(int *);
int main()
{
   int sum = 0;

   #pragma omp parallel master
   #pragma omp taskgroup task_reduction(+:sum)
   {
      #pragma omp target in_reduction(+:sum) nowait
          device_compute(&amp;sum);

      #pragma omp task in_reduction(+:sum)
          host_compute(&amp;sum);
   }
   printf(  &quot;sum = %d\n&quot;, sum);
   //OUTPUT: sum = 2
   return 0;
}

void device_compute(int *sum){ *sum = 1; }
void   host_compute(int *sum){ *sum = 1; }

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>
! name: target_task_reduction.1.f90
! type: F-free
! version: omp_5.0
program target_task_reduction_ex1
   interface
      subroutine device_compute(res)
      !$omp declare target to(device_compute)
        integer :: res
      end subroutine device_compute
      subroutine host_compute(res)
        integer :: res
      end subroutine host_compute
   end interface
   integer :: sum
   sum = 0
   !$omp parallel master
      !$omp taskgroup task_reduction(+:sum)
         !$omp target in_reduction(+:sum) nowait
            call device_compute(sum)
         !$omp end target
         !$omp task in_reduction(+:sum)
            call host_compute(sum)
         !$omp end task
      !$omp end taskgroup
   !$omp end parallel master
   print *, &quot;sum = &quot;, sum
   !!OUTPUT: sum = 2
end program

subroutine device_compute(sum)
   integer :: sum
   sum = 1
end subroutine
subroutine host_compute(sum)
   integer :: sum
   sum = 1
end subroutine

</pre></div>
</div>
</div>
</div>
<p>In the next pair of examples, the task reduction is defined by a <code class="docutils literal notranslate"><span class="pre">reduction</span></code> clause with the <code class="docutils literal notranslate"><span class="pre">task</span></code> modifier, rather than a <code class="docutils literal notranslate"><span class="pre">task_reduction</span></code> clause on a <code class="docutils literal notranslate"><span class="pre">taskgroup</span></code> construct. Again, the partial results from the participating tasks will be combined in some order into the original reduction variable, <code class="docutils literal notranslate"><span class="pre">sum</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//%compiler: clang
//%cflags: -fopenmp

/*
* name: target_task_reduction.2.c
* type: C
* version: omp_5.0
*/
#include &lt;stdio.h&gt;
#pragma omp declare target to(device_compute)
extern void device_compute(int *);
extern void host_compute(int *);
int main()
{
   int sum = 0;

   #pragma omp parallel sections reduction(task, +:sum)
   {
      #pragma omp section
          {
             #pragma omp target in_reduction(+:sum)
             device_compute(&amp;sum);
          }
      #pragma omp section
          {
             host_compute(&amp;sum);
          }
   }
   printf(  &quot;sum = %d\n&quot;, sum);
   //OUTPUT: sum = 2
   return 0;
}

void device_compute(int *sum){ *sum = 1; }
void   host_compute(int *sum){ *sum = 1; }

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>
! name: target_task_reduction.2.f90
! type: F-free
! version: omp_5.0
program target_task_reduction_ex2
   interface
      subroutine device_compute(res)
      !$omp declare target to(device_compute)
        integer :: res
      end subroutine device_compute
      subroutine host_compute(res)
        integer :: res
      end subroutine host_compute
   end interface
   integer :: sum
   sum = 0
   !$omp parallel sections reduction(task,+:sum)
      !$omp section
         !$omp target in_reduction(+:sum) nowait
           call device_compute(sum)
         !$omp end target
      !$omp section
         call host_compute(sum)
   !$omp end parallel sections
   print *, &quot;sum = &quot;, sum
   !!OUTPUT: sum = 2
end program

subroutine device_compute(sum)
   integer :: sum
   sum = 1
end subroutine
subroutine host_compute(sum)
   integer :: sum
   sum = 1
end subroutine

</pre></div>
</div>
</div>
</div>
<p>Next, the <code class="docutils literal notranslate"><span class="pre">task</span></code> modifier is again used to define a task reduction over participating tasks. This time, the participating tasks are a target task resulting from a <code class="docutils literal notranslate"><span class="pre">target</span></code> construct with the <code class="docutils literal notranslate"><span class="pre">in_reduction</span></code> clause, and the implicit task (executing on the master thread) that calls <code class="docutils literal notranslate"><span class="pre">host_compute</span></code>. As before, the partial results from these paricipating tasks are combined in some order into the original reduction variable.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//%compiler: clang
//%cflags: -fopenmp

/*
* name: target_task_reduction.2b.c
* type: C
* version: omp_5.0
*/
#include &lt;stdio.h&gt;
#pragma omp declare target to(device_compute)
extern void device_compute(int *);
extern void host_compute(int *);
int main()
{
   int sum = 0;

   #pragma omp parallel master reduction(task, +:sum)
   {
       #pragma omp target in_reduction(+:sum) nowait
       device_compute(&amp;sum);

       host_compute(&amp;sum);
   }
   printf(  &quot;sum = %d\n&quot;, sum);
   //OUTPUT: sum = 2
   return 0;
}

void device_compute(int *sum){ *sum = 1; }
void   host_compute(int *sum){ *sum = 1; }

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>
! name: target_task_reduction.2b.f90
! type: F-free
! version: omp_5.0
program target_task_reduction_ex2b
   interface
      subroutine device_compute(res)
      !$omp declare target to(device_compute)
        integer :: res
      end subroutine device_compute
      subroutine host_compute(res)
        integer :: res
      end subroutine host_compute
   end interface
   integer :: sum
   sum = 0
   !$omp parallel master reduction(task,+:sum)
         !$omp target in_reduction(+:sum) nowait
           call device_compute(sum)
         !$omp end target
         call host_compute(sum)
   !$omp end parallel sections
   print *, &quot;sum = &quot;, sum
   !!OUTPUT: sum = 2
end program


subroutine device_compute(sum)
   integer :: sum
   sum = 1
end subroutine
subroutine host_compute(sum)
   integer :: sum
   sum = 1
end subroutine


</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="taskloop-reduction">
<h2>Taskloop Reduction<a class="headerlink" href="#taskloop-reduction" title="Permalink to this headline">¶</a></h2>
<p>In the OpenMP 5.0 Specification the <code class="docutils literal notranslate"><span class="pre">taskloop</span></code> construct was extended to include the reductions.</p>
<p>The following two examples show how to implement a reduction over an array using taskloop reduction in two different ways. In the first example we apply the <code class="docutils literal notranslate"><span class="pre">reduction</span></code> clause to the <code class="docutils literal notranslate"><span class="pre">taskloop</span></code> construct. As it was explained above in the task reduction examples, a reduction over tasks is divided in two components: the scope of the reduction, which is defined by a <code class="docutils literal notranslate"><span class="pre">taskgroup</span></code> region, and the tasks that participate in the reduction. In this example, the <code class="docutils literal notranslate"><span class="pre">reduction</span></code> clause defines both semantics. First, it specifies that the implicit <code class="docutils literal notranslate"><span class="pre">taskgroup</span></code> region associated with the <code class="docutils literal notranslate"><span class="pre">taskloop</span></code> construct is the scope of the reduction, and second, it defines all tasks created by the <code class="docutils literal notranslate"><span class="pre">taskloop</span></code> construct as participants of the reduction. About the first property, it is important to note that if we add the <code class="docutils literal notranslate"><span class="pre">nogroup</span></code> clause to the <code class="docutils literal notranslate"><span class="pre">taskloop</span></code> construct the code will be nonconforming, basically because we have a set of tasks that participate in a reduction that has not been defined.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//%compiler: clang
//%cflags: -fopenmp

/*
* name:       taskloop_reduction.1.c
* type:       C
* version:    omp_5.0
*/
#include &lt;stdio.h&gt;

int array_sum(int n, int *v) {
    int i;
    int res = 0;

    #pragma omp taskloop reduction(+: res)
    for(i = 0; i &lt; n; ++i)
        res += v[i];

    return res;
}

int main(int argc, char *argv[]) {
    int n = 10;
    int v[10] = {1,2,3,4,5,6,7,8,9,10};

    #pragma omp parallel
    #pragma omp single
    {
        int res = array_sum(n, v);
        printf(&quot;The result is %d\n&quot;, res);
    }
    return 0;
}

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>
! name: taskloop_reduction.1.f90
! type: F-free
! version:    omp_5.0

function array_sum(n, v) result(res)
    implicit none
    integer :: n, v(n), res
    integer :: i

    res = 0
    !$omp taskloop reduction(+: res)
    do i=1, n
        res = res + v(i)
    end do
    !$omp end taskoop

end function array_sum

program main
    implicit none
    integer :: n, v(10), res
    integer :: i

    integer, external :: array_sum

    n = 10
    do i=1, n
        v(i) = i
    end do

    !$omp parallel
    !$omp single
    res = array_sum(n, v)
    print *, &quot;The result is&quot;, res
    !$omp end single
    !$omp end parallel
end program main

</pre></div>
</div>
</div>
</div>
<p>The second example computes exactly the same value as in the preceding <em>taskloop_reduction.1</em>  code section, but in a very different way. First, in the  <em>array_sum</em>  function a <code class="docutils literal notranslate"><span class="pre">taskgroup</span></code> region is created  that defines the scope of a new reduction using the <code class="docutils literal notranslate"><span class="pre">task_reduction</span></code> clause. After that, a task and also the tasks generated by a taskloop participate in  that reduction by using the <code class="docutils literal notranslate"><span class="pre">in_reduction</span></code> clause on the <code class="docutils literal notranslate"><span class="pre">task</span></code> and <code class="docutils literal notranslate"><span class="pre">taskloop</span></code> constructs, respectively.  Note that the <code class="docutils literal notranslate"><span class="pre">nogroup</span></code> clause was added to the <code class="docutils literal notranslate"><span class="pre">taskloop</span></code> construct. This is allowed because what is expressed with the <code class="docutils literal notranslate"><span class="pre">in_reduction</span></code> clause is different from what is expressed with the <code class="docutils literal notranslate"><span class="pre">reduction</span></code> clause. In one case the generated tasks are specified to participate in a previously  declared reduction (<code class="docutils literal notranslate"><span class="pre">in_reduction</span></code> clause) whereas in the other case creation of a new reduction is specified and also that all tasks generated  by the taskloop will participate on it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//%compiler: clang
//%cflags: -fopenmp

/*
* name:       taskloop_reduction.2.c
* type:       C
* version:    omp_5.0
*/
#include &lt;stdio.h&gt;

int array_sum(int n, int *v) {
    int i;
    int res = 0;

    #pragma omp taskgroup task_reduction(+: res)
    {
        if (n &gt; 0) {
            #pragma omp task in_reduction(+: res)
            res = res + v[0];

            #pragma omp taskloop in_reduction(+: res) nogroup
            for(i = 1; i &lt; n; ++i)
                res += v[i];
        }
    }

    return res;
}

int main(int argc, char *argv[]) {
    int n = 10;
    int v[10] = {1,2,3,4,5,6,7,8,9,10};

    #pragma omp parallel
    #pragma omp single
    {
        int res = array_sum(n, v);
        printf(&quot;The result is %d\n&quot;, res);
    }
    return 0;
}

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>
! name: taskloop_reduction.2.f90
! type: F-free
! version:    omp_5.0

function array_sum(n, v) result(res)
    implicit none
    integer :: n, v(n), res
    integer :: i

    res = 0
    !$omp taskgroup task_reduction(+: res)
    if (n &gt; 0) then
        !$omp task in_reduction(+: res)
        res = res + v(1)
        !$omp end task

        !$omp taskloop in_reduction(+: res) nogroup
        do i=2, n
            res = res + v(i)
        end do
        !$omp end taskoop
    endif
    !$omp end taskgroup

end function array_sum

program main
    implicit none
    integer :: n, v(10), res
    integer :: i

    integer, external :: array_sum

    n = 10
    do i=1, n
        v(i) = i
    end do

    !$omp parallel
    !$omp single
    res = array_sum(n, v)
    print *, &quot;The result is&quot;, res
    !$omp end single
    !$omp end parallel
end program main

</pre></div>
</div>
</div>
</div>
<p>In the OpenMP 5.0 Specification, <code class="docutils literal notranslate"><span class="pre">reduction</span></code> clauses for the <code class="docutils literal notranslate"><span class="pre">taskloop</span></code> <code class="docutils literal notranslate"> <span class="pre">simd</span></code> construct were also added.</p>
<p>The examples below compare reductions for the <code class="docutils literal notranslate"><span class="pre">taskloop</span></code> and the <code class="docutils literal notranslate"><span class="pre">taskloop</span></code> <code class="docutils literal notranslate"><span class="pre">simd</span></code> constructs. These examples illustrate the use of <code class="docutils literal notranslate"><span class="pre">reduction</span></code> clauses within  “stand-alone” <code class="docutils literal notranslate"><span class="pre">taskloop</span></code> constructs, and the use of <code class="docutils literal notranslate"><span class="pre">in_reduction</span></code> clauses for tasks of taskloops to participate with other reductions within the scope of a parallel region.</p>
<p><strong>taskloop reductions:</strong></p>
<p>In the  <em>taskloop reductions</em>  section of the example below,   <em>taskloop 1</em>  uses the <code class="docutils literal notranslate"><span class="pre">reduction</span></code> clause  in a <code class="docutils literal notranslate"><span class="pre">taskloop</span></code> construct for a sum reduction, accumulated in  <em>asum</em> .  The behavior is as though a <code class="docutils literal notranslate"><span class="pre">taskgroup</span></code> construct encloses the  taskloop region with a <code class="docutils literal notranslate"><span class="pre">task_reduction</span></code> clause, and each taskloop task has an <code class="docutils literal notranslate"><span class="pre">in_reduction</span></code> clause with the specifications  of the <code class="docutils literal notranslate"><span class="pre">reduction</span></code> clause. At the end of the taskloop region  <em>asum</em>  contains the result of the reduction.</p>
<p>The next taskloop,  <em>taskloop 2</em> , illustrates the use of the  <code class="docutils literal notranslate"><span class="pre">in_reduction</span></code> clause to participate in a previously defined reduction scope of a <code class="docutils literal notranslate"><span class="pre">parallel</span></code> construct.</p>
<p>The task reductions of  <em>task 2</em>  and  <em>taskloop 2</em>  are combined across the <code class="docutils literal notranslate"><span class="pre">taskloop</span></code> construct and the single <code class="docutils literal notranslate"><span class="pre">task</span></code> construct, as specified in the <code class="docutils literal notranslate"><span class="pre">reduction(task,</span></code> <code class="docutils literal notranslate"><span class="pre">+:asum)</span></code> clause of the <code class="docutils literal notranslate"><span class="pre">parallel</span></code> construct. At the end of the parallel region  <em>asum</em>  contains the combined result of all reductions.</p>
<p><strong>taskloop simd reductions:</strong></p>
<p>Reductions for the <code class="docutils literal notranslate"><span class="pre">taskloop</span></code> <code class="docutils literal notranslate"><span class="pre">simd</span></code> construct are shown in the second half of the code. Since each component construct, <code class="docutils literal notranslate"><span class="pre">taskloop</span></code> and <code class="docutils literal notranslate"><span class="pre">simd</span></code>,  can accept a reduction-type clause, the <code class="docutils literal notranslate"><span class="pre">taskloop</span></code> <code class="docutils literal notranslate"><span class="pre">simd</span></code> construct is a composite construct, and the specific application of the reduction clause is defined within the <code class="docutils literal notranslate"><span class="pre">taskloop</span></code> <code class="docutils literal notranslate"><span class="pre">simd</span></code> construct section of the OpenMP 5.0 Specification. The code below illustrates use cases for these reductions.</p>
<p>In the  <em>taskloop simd reduction</em>  section of the example below,  <em>taskloop simd 3</em>  uses the <code class="docutils literal notranslate"><span class="pre">reduction</span></code> clause  in a <code class="docutils literal notranslate"><span class="pre">taskloop</span></code> <code class="docutils literal notranslate"><span class="pre">simd</span></code> construct for a sum reduction within a loop. For this case a <code class="docutils literal notranslate"><span class="pre">reduction</span></code> clause is used, as one would use  for a <code class="docutils literal notranslate"><span class="pre">simd</span></code> construct. The SIMD reductions of each task are combined, and the results of these tasks are further  combined just as in the <code class="docutils literal notranslate"><span class="pre">taskloop</span></code> construct with the <code class="docutils literal notranslate"><span class="pre">reduction</span></code> clause for  <em>taskloop 1</em> . At the end of the taskloop region  <em>asum</em>  contains the combined result of all reductions.</p>
<p>If a <code class="docutils literal notranslate"><span class="pre">taskloop</span></code> <code class="docutils literal notranslate"><span class="pre">simd</span></code> construct is to participate in a previously defined  reduction scope, the reduction participation should be specified with a <code class="docutils literal notranslate"><span class="pre">in_reduction</span></code> clause, as shown in the <code class="docutils literal notranslate"><span class="pre">parallel</span></code> region enclosing  <em>task 4</em>  and  <em>taskloop simd 4</em>  code sections.</p>
<p>Here the <code class="docutils literal notranslate"><span class="pre">taskloop</span></code> <code class="docutils literal notranslate"><span class="pre">simd</span></code> construct’s  <code class="docutils literal notranslate"><span class="pre">in_reduction</span></code> clause specifies participation of the construct’s tasks as  a task reduction within the scope of the parallel region.   That is, the results of each task of the <code class="docutils literal notranslate"><span class="pre">taskloop</span></code> construct component  contribute to the reduction in a broader level, just as in  <em>parallel reduction a</em>  code section above. Also, each <code class="docutils literal notranslate"><span class="pre">simd</span></code>-component construct occurs as if it has a <code class="docutils literal notranslate"><span class="pre">reduction</span></code> clause, and the SIMD results of each task are combined as though to form a single result for each task (that participates in the <code class="docutils literal notranslate"><span class="pre">in_reduction</span></code> clause). At the end of the parallel region  <em>asum</em>  contains the combined result of all reductions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//%compiler: clang
//%cflags: -fopenmp

/*
* name: taskloop_simd_reduction.1c
* type: C
* version: omp_5.0
*/

#include &lt;stdio.h&gt;
#define N 100

int main(){
  int i, a[N], asum=0;

  for(i=0;i&lt;N;i++) a[i]=i;

// taskloop reductions

  #pragma omp parallel master
  #pragma omp taskloop reduction(+:asum)                //taskloop 1
    for(i=0;i&lt;N;i++){ asum += a[i]; }


  #pragma omp parallel reduction(task, +:asum)          // parallel reduction a
  {
     #pragma omp master
     #pragma omp task            in_reduction(+:asum)    //task 2
       for(i=0;i&lt;N;i++){ asum += a[i]; }

     #pragma omp master taskloop in_reduction(+:asum)    //taskloop 2
       for(i=0;i&lt;N;i++){ asum += a[i]; }
  }

// taskloop simd reductions

  #pragma omp parallel master
  #pragma omp taskloop simd reduction(+:asum)            //taskloop simd 3
    for(i=0;i&lt;N;i++){ asum += a[i]; }


  #pragma omp parallel reduction(task, +:asum)          // parallel reduction b
  {
     #pragma omp master
     #pragma omp task                 in_reduction(+:asum) //task 4
       for(i=0;i&lt;N;i++){ asum += a[i]; }

     #pragma omp master taskloop simd in_reduction(+:asum) //taskloop simd 4
       for(i=0;i&lt;N;i++){ asum += a[i]; }

  }

  printf(&quot;asum=%d \n&quot;,asum); // output: asum=29700
}

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>
! name: taskloop_simd_reduction.1f90
! type:       F-free
! version:    omp_5.0

program main

  use omp_lib
  integer, parameter ::  N=100
  integer            :: i, a(N), asum=0

  a = [( i, i=1,N )]    !! initialize

!! taskloop reductions

  !$omp parallel master
  !$omp taskloop reduction(+:asum)                     !! taskloop 1
    do i=1,N;  asum = asum + a(i);  enddo
  !$omp end taskloop
  !$omp end parallel master


  !$omp parallel reduction(task, +:asum)               !! parallel reduction a

     !$omp master
     !$omp task            in_reduction(+:asum)        !! task 2
       do i=1,N;  asum = asum + a(i);  enddo
     !$omp end task
     !$omp end master

     !$omp master taskloop in_reduction(+:asum)        !! taskloop 2
       do i=1,N;  asum = asum + a(i);  enddo
     !$omp end master taskloop

  !$omp end parallel

!! taskloop simd reductions

  !$omp parallel master
  !$omp taskloop simd reduction(+:asum)                !! taskloop simd 3
    do i=1,N;  asum = asum + a(i);  enddo
  !$omp end taskloop simd
  !$omp end parallel master


  !$omp parallel reduction(task, +:asum)               !! parallel reduction b

    !$omp master
    !$omp task                 in_reduction(+:asum)    !! task 4
       do i=1,N;  asum = asum + a(i);  enddo
    !$omp end task
    !$omp end master

    !$omp master taskloop simd in_reduction(+:asum)    !! taskloop simd 4
       do i=1,N;  asum = asum + a(i);  enddo
    !$omp end master taskloop simd

  !$omp end parallel

  print*,&quot;asum=&quot;,asum   !! output: asum=30300

end program

</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "native"
        },
        kernelOptions: {
            kernelName: "native",
            path: "./contents"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'native'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="Examples_lastprivate.html" title="previous page">The <code class="docutils literal notranslate"><span class="pre">lastprivate</span></code> Clause</a>
    <a class='right-next' id="next-link" href="Examples_udr.html" title="next page">User-Defined Reduction</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The OpenMP Community<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>