
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>simd and declare simd Constructs &#8212; OpenMP Application Programming Interface Examples</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ref, val, uval Modifiers for linear Clause" href="Examples_linear_modifier.html" />
    <link rel="prev" title="SIMD" href="Chap_SIMD.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">OpenMP Application Programming Interface Examples</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Welcome to OMP Jupyter Book
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Foreword_Chapt.html">
   Foreword
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Introduction_Chapt.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Examples_Chapt.html">
   Examples
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="Chap_parallel_execution.html">
   Parallel Execution
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_ploop.html">
     A Simple Parallel Loop
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_parallel.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       parallel
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_host_teams.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       teams
      </span>
     </code>
     Construct on Host
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_nthrs_nesting.html">
     Controlling the Number of Threads on Multiple Nesting Levels
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_nthrs_dynamic.html">
     Interaction Between the
     <code class="docutils literal notranslate">
      <span class="pre">
       num_threads
      </span>
     </code>
     Clause and
     <code class="docutils literal notranslate">
      <span class="pre">
       omp_set_dynamic
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_fort_do.html">
     Fortran Restrictions on the
     <code class="docutils literal notranslate">
      <span class="pre">
       do
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_nowait.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       nowait
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_collapse.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       collapse
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_linear_in_loop.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       linear
      </span>
     </code>
     Clause in Loop Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_psections.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       parallel
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       sections
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_fpriv_sections.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       firstprivate
      </span>
     </code>
     Clause and the
     <code class="docutils literal notranslate">
      <span class="pre">
       sections
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_single.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       single
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_workshare.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       workshare
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_master.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       master
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_loop.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       loop
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_pra_iterator.html">
     Parallel Random Access Iterator Loop
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_set_dynamic_nthrs.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       omp_set_dynamic
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       omp_set_num_threads
      </span>
     </code>
     Routines
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_get_nthrs.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       omp_get_num_threads
      </span>
     </code>
     Routine
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="Chap_affinity.html">
   OpenMP Affinity
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_affinity.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       proc_bind
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_task_affinity.html">
     Task Affinity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_affinity_display.html">
     Affinity Display
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_affinity_query.html">
     Affinity Query Functions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="Chap_tasking.html">
   Tasking
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_tasking.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       task
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       taskwait
      </span>
     </code>
     Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_task_priority.html">
     Task Priority
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_task_dep.html">
     Task Dependences
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_taskgroup.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       taskgroup
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_taskyield.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       taskyield
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_taskloop.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       taskloop
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_parallel_master_taskloop.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       parallel
      </span>
      <span class="pre">
       master
      </span>
      <span class="pre">
       taskloop
      </span>
     </code>
     Construct
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="Chap_devices.html">
   Devices
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_defaultmap.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       defaultmap
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_pointer_mapping.html">
     Pointer mapping
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_structure_mapping.html">
     Structure mapping
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_array_sections.html">
     Array Sections in Device Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_array_shaping.html">
     Array Shaping
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_mapper.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       declare
      </span>
      <span class="pre">
       mapper
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_data.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       data
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_unstructured_data.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       enter
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       data
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       exit
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       data
      </span>
     </code>
     Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_update.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       update
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_declare_target.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       declare
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_teams.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       teams
      </span>
     </code>
     Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_async_target_depend.html">
     Asynchronous
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     Execution and Dependences
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_async_target_with_tasks.html">
     Asynchronous
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     with Tasks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_async_target_nowait.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       nowait
      </span>
     </code>
     Clause on
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_async_target_nowait_depend.html">
     Asynchronous
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     with
     <code class="docutils literal notranslate">
      <span class="pre">
       nowait
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       depend
      </span>
     </code>
     Clauses
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_device.html">
     Device Routines
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="Chap_SIMD.html">
   SIMD
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     <code class="docutils literal notranslate">
      <span class="pre">
       simd
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       declare
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       simd
      </span>
     </code>
     Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_linear_modifier.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       ref
      </span>
     </code>
     ,
     <code class="docutils literal notranslate">
      <span class="pre">
       val
      </span>
     </code>
     ,
     <code class="docutils literal notranslate">
      <span class="pre">
       uval
      </span>
     </code>
     Modifiers for
     <code class="docutils literal notranslate">
      <span class="pre">
       linear
      </span>
     </code>
     Clause
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="Chap_synchronization.html">
   Synchronization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_critical.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       critical
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_worksharing_critical.html">
     Worksharing Constructs Inside a
     <code class="docutils literal notranslate">
      <span class="pre">
       critical
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_barrier_regions.html">
     Binding of
     <code class="docutils literal notranslate">
      <span class="pre">
       barrier
      </span>
     </code>
     Regions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_atomic.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       atomic
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_atomic_restrict.html">
     Restrictions on the
     <code class="docutils literal notranslate">
      <span class="pre">
       atomic
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_flush_nolist.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       flush
      </span>
     </code>
     Construct without a List
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_acquire_release.html">
     Synchronization Based on Acquire/Release Semantics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_ordered.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       ordered
      </span>
     </code>
     Clause and the
     <code class="docutils literal notranslate">
      <span class="pre">
       ordered
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_depobj.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       depobj
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_doacross.html">
     Doacross Loop Nest
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="Examples_locks.html">
     Lock Routines
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
    <label for="toctree-checkbox-7">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="Examples_init_lock.html">
       The
       <code class="docutils literal notranslate">
        <span class="pre">
         omp_init_lock
        </span>
       </code>
       Routine
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Examples_init_lock_with_hint.html">
       The
       <code class="docutils literal notranslate">
        <span class="pre">
         omp_init_lock_with_hint
        </span>
       </code>
       Routine
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Examples_lock_owner.html">
       Ownership of Locks
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Examples_simple_lock.html">
       Simple Lock Routines
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Examples_nestable_lock.html">
       Nestable Lock Routines
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="Chap_data_environment.html">
   Data Environment
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_threadprivate.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       threadprivate
      </span>
     </code>
     Directive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_default_none.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       default(none)
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_private.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       private
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_fort_loopvar.html">
     Fortran Private Loop Iteration Variables
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_fort_sp_common.html">
     Fortran Restrictions on
     <code class="docutils literal notranslate">
      <span class="pre">
       shared
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       private
      </span>
     </code>
     Clauses with Common Blocks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_fort_sa_private.html">
     Fortran Restrictions on Storage Association with the
     <code class="docutils literal notranslate">
      <span class="pre">
       private
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_carrays_fpriv.html">
     C/C++ Arrays in a
     <code class="docutils literal notranslate">
      <span class="pre">
       firstprivate
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_lastprivate.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       lastprivate
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_reduction.html">
     Reduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_udr.html">
     User-Defined Reduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_scan.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       scan
      </span>
     </code>
     Directive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_copyin.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       copyin
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_copyprivate.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       copyprivate
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="Examples_cpp_reference.html">
     C++ Reference in Data-Sharing Clauses
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
    <label for="toctree-checkbox-9">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="Examples_associate.html">
       Fortran
       <code class="docutils literal notranslate">
        <span class="pre">
         ASSOCIATE
        </span>
       </code>
       Construct
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="Chap_memory_model.html">
   Memory Model
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_mem_model.html">
     The OpenMP Memory Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_allocators.html">
     Memory Allocators
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_fort_race.html">
     Race Conditions Caused by Implied Copies of Shared Variables in Fortran
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="Chap_program_control.html">
   Program Control
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_cond_comp.html">
     Conditional Compilation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_icv.html">
     Internal Control Variables (ICVs)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_standalone.html">
     Placement of
     <code class="docutils literal notranslate">
      <span class="pre">
       flush
      </span>
     </code>
     ,
     <code class="docutils literal notranslate">
      <span class="pre">
       barrier
      </span>
     </code>
     ,
     <code class="docutils literal notranslate">
      <span class="pre">
       taskwait
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       taskyield
      </span>
     </code>
     Directives
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_cancellation.html">
     Cancellation Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_requires.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       requires
      </span>
     </code>
     Directive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_variant.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       declare
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       variant
      </span>
     </code>
     Directive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_metadirective.html">
     Metadirective Directive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_nested_loop.html">
     Nested Loop Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_nesting_restrict.html">
     Restrictions on Nesting of Regions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_offload.html">
     Target Offload
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="History.html">
   Document Revision History
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/contents/Examples_SIMD.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/passlab/Examples"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/passlab/Examples/issues/new?title=Issue%20on%20page%20%2Fcontents/Examples_SIMD.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/passlab/Examples/main?urlpath=lab/tree/notebook/contents/Examples_SIMD.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   <code class="docutils literal notranslate">
    <span class="pre">
     simd
    </span>
   </code>
   and
   <code class="docutils literal notranslate">
    <span class="pre">
     declare
    </span>
   </code>
   <code class="docutils literal notranslate">
    <span class="pre">
     simd
    </span>
   </code>
   Constructs
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#inbranch-and-notinbranch-clauses">
   <code class="docutils literal notranslate">
    <span class="pre">
     inbranch
    </span>
   </code>
   and
   <code class="docutils literal notranslate">
    <span class="pre">
     notinbranch
    </span>
   </code>
   Clauses
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#loop-carried-lexical-forward-dependence">
   Loop-Carried Lexical Forward Dependence
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="simd-and-declare-simd-constructs">
<h1><code class="docutils literal notranslate"><span class="pre">simd</span></code> and <code class="docutils literal notranslate"><span class="pre">declare</span></code> <code class="docutils literal notranslate"><span class="pre">simd</span></code> Constructs<a class="headerlink" href="#simd-and-declare-simd-constructs" title="Permalink to this headline">¶</a></h1>
<p>The following example illustrates the basic use of the <code class="docutils literal notranslate"><span class="pre">simd</span></code> construct  to assure the compiler that the loop can be vectorized.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//%compiler: clang
//%cflags: -fopenmp

/*
* name: SIMD.1c
* type: C
* version: omp_4.0
*/
void star( double *a, double *b, double *c, int n, int *ioff )
{
   int i;
   #pragma omp simd
   for ( i = 0; i &lt; n; i++ )
      a[i] *= b[i] * c[i+ *ioff];
}

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>
! name: SIMD.1f
! type: F-free
! version: omp_4.0
subroutine star(a,b,c,n,ioff_ptr)
   implicit none
   double precision :: a(*),b(*),c(*)
   integer          :: n, i
   integer, pointer :: ioff_ptr

   !$omp simd
   do i = 1,n
      a(i) = a(i) * b(i) * c(i+ioff_ptr)
   end do

end subroutine

</pre></div>
</div>
</div>
</div>
<p>When a function can be inlined within a loop the compiler has an opportunity to  vectorize the loop. By guaranteeing SIMD behavior of a function’s operations,  characterizing the arguments of the function and privatizing temporary  variables of the loop, the compiler can often create faster, vector code for  the loop. In the examples below the <code class="docutils literal notranslate"><span class="pre">declare</span></code> <code class="docutils literal notranslate"><span class="pre">simd</span></code> construct is  used on the  <em>add1</em>  and  <em>add2</em>  functions to enable creation of their  corresponding SIMD function versions for execution within the associated SIMD  loop. The functions characterize two different approaches of accessing data  within the function: by a single variable and as an element in a data array,  respectively. The  <em>add3</em>  C function uses dereferencing.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">declare</span></code> <code class="docutils literal notranslate"><span class="pre">simd</span></code> constructs also illustrate the use of  <code class="docutils literal notranslate"><span class="pre">uniform</span></code> and <code class="docutils literal notranslate"><span class="pre">linear</span></code> clauses.  The <code class="docutils literal notranslate"><span class="pre">uniform(fact)</span></code> clause  indicates that the variable  <em>fact</em>  is invariant across the SIMD lanes. In  the  <em>add2</em>  function  <em>a</em>  and  <em>b</em>  are included in the <code class="docutils literal notranslate"><span class="pre">uniform</span></code>  list because the C pointer and the Fortran array references are constant.  The   <em>i</em>  index used in the  <em>add2</em>  function is included in a <code class="docutils literal notranslate"><span class="pre">linear</span></code>  clause with a constant-linear-step of 1, to guarantee a unity increment of the  associated loop. In the <code class="docutils literal notranslate"><span class="pre">declare</span></code> <code class="docutils literal notranslate"><span class="pre">simd</span></code> construct for the  <em>add3</em>   C function the  <code class="docutils literal notranslate"><span class="pre">linear(a,b:1)</span></code> clause instructs the compiler to generate  unit-stride loads across the SIMD lanes; otherwise,  costly <strong>gather</strong>  instructions would be generated for the unknown sequence of access of the  pointer dereferences.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">simd</span></code> constructs for the loops the <code class="docutils literal notranslate"><span class="pre">private(tmp)</span></code> clause is  necessary to assure that the each vector operation has its own  <em>tmp</em>   variable.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//%compiler: clang
//%cflags: -fopenmp

/*
* name: SIMD.2c
* type: C
* version: omp_4.0
*/
#include &lt;stdio.h&gt;

#pragma omp declare simd uniform(fact)
double add1(double a, double b, double fact)
{
   double c;
   c = a + b + fact;
   return c;
}

#pragma omp declare simd uniform(a,b,fact) linear(i:1)
double add2(double *a, double *b, int i, double fact)
{
   double c;
   c = a[i] + b[i] + fact;
   return c;
}

#pragma omp declare simd uniform(fact) linear(a,b:1)
double add3(double *a, double *b, double fact)
{
   double c;
   c = *a + *b + fact;
   return c;
}

void work( double *a, double *b, int n )
{
   int i;
   double tmp;
   #pragma omp simd private(tmp)
   for ( i = 0; i &lt; n; i++ ) {
      tmp  = add1( a[i],  b[i], 1.0);
      a[i] = add2( a,     b, i, 1.0) + tmp;
      a[i] = add3(&amp;a[i], &amp;b[i], 1.0);
   }
}

int main(){
   int i;
   const int N=32;
   double a[N], b[N];

   for ( i=0; i&lt;N; i++ ) {
      a[i] = i; b[i] = N-i;
   }

   work(a, b, N );

   for ( i=0; i&lt;N; i++ ) {
      printf(&quot;%d %f\n&quot;, i, a[i]);
   }

   return 0;
}

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>
! name: SIMD.2f
! type: F-free
! version: omp_4.0
program main
   implicit none
   integer, parameter :: N=32
   integer :: i
   double precision   :: a(N), b(N)
   do i = 1,N
      a(i) = i-1
      b(i) = N-(i-1)
   end do
   call work(a, b, N )
   do i = 1,N
      print*, i,a(i)
   end do
end program

function add1(a,b,fact) result(c)
   implicit none
!$omp declare simd(add1) uniform(fact)
   double precision :: a,b,fact, c
   c = a + b + fact
end function

function add2(a,b,i, fact) result(c)
   implicit none
!$omp declare simd(add2) uniform(a,b,fact) linear(i:1)
   integer          :: i
   double precision :: a(*),b(*),fact, c
   c = a(i) + b(i) + fact
end function

subroutine work(a, b, n )
   implicit none
   double precision           :: a(n),b(n), tmp
   integer                    :: n, i
   double precision, external :: add1, add2

   !$omp simd private(tmp)
   do i = 1,n
      tmp  = add1(a(i), b(i), 1.0d0)
      a(i) = add2(a,    b, i, 1.0d0) + tmp
      a(i) = a(i) + b(i) + 1.0d0
   end do
end subroutine

</pre></div>
</div>
</div>
</div>
<p>A thread that encounters a SIMD construct executes a vectorized code of the  iterations. Similar to the concerns of a worksharing loop a loop vectorized  with a SIMD construct must assure that temporary and reduction variables are  privatized and declared as reductions with clauses.  The example below  illustrates the use of <code class="docutils literal notranslate"><span class="pre">private</span></code> and <code class="docutils literal notranslate"><span class="pre">reduction</span></code> clauses in a SIMD  construct.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//%compiler: clang
//%cflags: -fopenmp

/*
* name: SIMD.3c
* type: C
* version: omp_4.0
*/
double work( double *a, double *b, int n )
{
   int i;
   double tmp, sum;
   sum = 0.0;
   #pragma omp simd private(tmp) reduction(+:sum)
   for (i = 0; i &lt; n; i++) {
      tmp = a[i] + b[i];
      sum += tmp;
   }
   return sum;
}

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>
! name: SIMD.3f
! type: F-free
! version: omp_4.0
subroutine work( a, b, n, sum )
   implicit none
   integer :: i, n
   double precision :: a(n), b(n), sum, tmp

   sum = 0.0d0
   !$omp simd private(tmp) reduction(+:sum)
   do i = 1,n
      tmp = a(i) + b(i)
      sum = sum + tmp
   end do

end subroutine work

</pre></div>
</div>
</div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">safelen(N)</span></code> clause in a <code class="docutils literal notranslate"><span class="pre">simd</span></code> construct assures the compiler that  there are no loop-carried dependencies for vectors of size  <em>N</em>  or below. If  the <code class="docutils literal notranslate"><span class="pre">safelen</span></code> clause is not specified, then the default safelen value is  the number of loop iterations.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">safelen(16)</span></code> clause in the example below guarantees that the vector  code is safe for vectors up to and including size 16.  In the loop,  <em>m</em>  can  be 16 or greater, for correct code execution.  If the value of  <em>m</em>  is less  than 16, the behavior is undefined.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//%compiler: clang
//%cflags: -fopenmp

/*
* name: SIMD.4c
* type: C
* version: omp_4.0
*/
void work( float *b, int n, int m )
{
   int i;
   #pragma omp simd safelen(16)
   for (i = m; i &lt; n; i++)
      b[i] = b[i-m] - 1.0f;
}

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>
! name: SIMD.4f
! type: F-free
! version: omp_4.0
subroutine work( b, n, m )
   implicit none
   real       :: b(n)
   integer    :: i,n,m

   !$omp simd safelen(16)
   do i = m+1, n
      b(i) = b(i-m) - 1.0
   end do
end subroutine work

</pre></div>
</div>
</div>
</div>
<p>The following SIMD construct instructs the compiler to collapse the  <em>i</em>  and   <em>j</em>  loops into a single SIMD loop in which SIMD chunks are executed by  threads of the team. Within the workshared loop chunks of a thread, the SIMD  chunks are executed in the lanes of the vector units.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//%compiler: clang
//%cflags: -fopenmp

/*
* name: SIMD.5c
* type: C
* version: omp_4.0
*/
void work( double **a, double **b, double **c, int n )
{
   int i, j;
   double tmp;
   #pragma omp for simd collapse(2) private(tmp)
   for (i = 0; i &lt; n; i++) {
      for (j = 0; j &lt; n; j++) {
         tmp = a[i][j] + b[i][j];
         c[i][j] = tmp;
      }
   }
}

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>
! name: SIMD.5f
! type: F-free
! version: omp_4.0
subroutine work( a, b, c,  n )
   implicit none
   integer :: i,j,n
   double precision :: a(n,n), b(n,n), c(n,n), tmp

   !$omp do simd collapse(2) private(tmp)
   do j = 1,n
      do i = 1,n
         tmp = a(i,j) + b(i,j)
         c(i,j) = tmp
      end do
   end do

end subroutine work

</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="inbranch-and-notinbranch-clauses">
<h1><code class="docutils literal notranslate"><span class="pre">inbranch</span></code> and <code class="docutils literal notranslate"><span class="pre">notinbranch</span></code> Clauses<a class="headerlink" href="#inbranch-and-notinbranch-clauses" title="Permalink to this headline">¶</a></h1>
<p>The following examples illustrate the use of the <code class="docutils literal notranslate"><span class="pre">declare</span></code> <code class="docutils literal notranslate"><span class="pre">simd</span></code>  construct with the <code class="docutils literal notranslate"><span class="pre">inbranch</span></code> and <code class="docutils literal notranslate"><span class="pre">notinbranch</span></code> clauses. The  <code class="docutils literal notranslate"><span class="pre">notinbranch</span></code> clause informs the compiler that the function  <em>foo</em>  is  never called conditionally in the SIMD loop of the function  <em>myaddint</em> . On  the other hand, the <code class="docutils literal notranslate"><span class="pre">inbranch</span></code> clause for the function goo indicates that  the function is always called conditionally in the SIMD loop inside  the function  <em>myaddfloat</em> .</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//%compiler: clang
//%cflags: -fopenmp

/*
* name: SIMD.6c
* type: C
* version: omp_4.0
*/
#pragma omp declare simd linear(p:1) notinbranch
int foo(int *p){
  *p = *p + 10;
  return *p;
}

int myaddint(int *a, int *b, int n)
{
#pragma omp simd
  for (int i=0; i&lt;n; i++){
      a[i]  = foo(&amp;b[i]);  /* foo is not called under a condition */
  }
  return a[n-1];
}

#pragma omp declare simd linear(p:1) inbranch
float goo(float *p){
  *p = *p + 18.5f;
  return *p;
}

int myaddfloat(float *x, float *y, int n)
{
#pragma omp simd
  for (int i=0; i&lt;n; i++){
     x[i] = (x[i] &gt; y[i]) ? goo(&amp;y[i]) : y[i];
       /* goo is called under the condition (or within a branch) */
  }
  return x[n-1];
}

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>
! name: SIMD.6f
! type: F-free
! version: omp_4.0
function foo(p) result(r)
  implicit none
!$omp declare simd(foo) notinbranch
  integer :: p, r
  p = p + 10
  r = p
end function foo

function myaddint(a, b,  n) result(r)
  implicit none
  integer :: a(*), b(*), n, r
  integer :: i
  integer, external :: foo

  !$omp simd
  do i=1, n
      a(i) = foo(b(i))  ! foo is not called under a condition
  end do
  r = a(n)

end function myaddint

function goo(p) result(r)
  implicit none
!$omp declare simd(goo) inbranch
  real :: p, r
  p = p + 18.5
  r = p
end function goo

function myaddfloat(x, y, n) result(r)
  implicit none
  real :: x(*), y(*), r
  integer :: n
  integer :: i
  real, external :: goo

  !$omp simd
  do i=1, n
     if (x(i) &gt; y(i)) then
        x(i) = goo(y(i))
        ! goo is called under the condition (or within a branch)
     else
        x(i) = y(i)
     endif
  end do

  r = x(n)
end function myaddfloat

</pre></div>
</div>
</div>
</div>
<p>In the code below, the function  <em>fib()</em>  is called in the main program and  also recursively called in the function  <em>fib()</em>  within an <code class="docutils literal notranslate"><span class="pre">if</span></code>  condition. The compiler creates a masked vector version and a non-masked vector  version for the function  <em>fib()</em>  while retaining the original scalar  version of the  <em>fib()</em>  function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//%compiler: clang
//%cflags: -fopenmp

/*
* name: SIMD.7c
* type: C
* version: omp_4.0
*/
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

#define N 45
int a[N], b[N], c[N];

#pragma omp declare simd inbranch
int fib( int n )
{
   if (n &lt;= 1)
      return n;
   else {
      return fib(n-1) + fib(n-2);
   }
}

int main(void)
{
   int i;

   #pragma omp simd
   for (i=0; i &lt; N; i++) b[i] = i;

   #pragma omp simd
   for (i=0; i &lt; N; i++) {
      a[i] = fib(b[i]);
   }
   printf(&quot;Done a[%d] = %d\n&quot;, N-1, a[N-1]);
   return 0;
}

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>
! name: SIMD.7f
! type: F-free
! version: omp_4.0
program fibonacci
   implicit none
   integer,parameter :: N=45
   integer           :: a(0:N-1), b(0:N-1)
   integer           :: i
   integer, external :: fib

   !$omp simd
   do i = 0,N-1
      b(i) = i
   end do

   !$omp simd
   do i=0,N-1
      a(i) = fib(b(i))
   end do

   write(*,*) &quot;Done a(&quot;, N-1, &quot;) = &quot;, a(N-1)
                        ! 44  701408733
end program

recursive function fib(n) result(r)
   implicit none
!$omp declare simd(fib) inbranch
   integer  :: n, r

   if (n &lt;= 1) then
      r = n
   else
      r = fib(n-1) + fib(n-2)
   endif

end function fib

</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="loop-carried-lexical-forward-dependence">
<h1>Loop-Carried Lexical Forward Dependence<a class="headerlink" href="#loop-carried-lexical-forward-dependence" title="Permalink to this headline">¶</a></h1>
<p>The following example tests the restriction on an SIMD loop with the loop-carried lexical forward-dependence. This dependence must be preserved for the correct execution of SIMD loops.</p>
<p>A loop can be vectorized even though the iterations are not completely independent when it has loop-carried dependences that are forward lexical dependences, indicated in the code below by the read of  <em>A[j+1]</em>  and the write to  <em>A[j]</em>  in C/C++ code (or  <em>A(j+1)</em>  and  <em>A(j)</em>  in Fortran). That is, the read of  <em>A[j+1]</em>  (or  <em>A(j+1)</em>  in Fortran) before the write to  <em>A[j]</em>  (or  <em>A(j)</em>  in Fortran) ordering must be preserved for each iteration in  <em>j</em>  for valid SIMD code generation.</p>
<p>This test assures that the compiler preserves the loop carried lexical forward-dependence for generating a correct SIMD code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//%compiler: clang
//%cflags: -fopenmp

/*
* name: SIMD.8c
* type: C
* version: omp_4.0
*/
#include &lt;stdio.h&gt;
#include &lt;math.h&gt;

int   P[1000];
float A[1000];

float do_work(float *arr)
{
  float pri;
  int i;
#pragma omp simd lastprivate(pri)
  for (i = 0; i &lt; 999; ++i) {
    int j = P[i];

    pri = 0.5f;
    if (j % 2 == 0) {
      pri = A[j+1] + arr[i];
    }
    A[j] = pri * 1.5f;
    pri = pri + A[j];
  }
  return pri;
}

int main(void)
{
  float pri, arr[1000];
  int i;

  for (i = 0; i &lt; 1000; ++i) {
     P[i]   = i;
     A[i]   = i * 1.5f;
     arr[i] = i * 1.8f;
  }
  pri = do_work(&amp;arr[0]);
  if (pri == 8237.25) {
    printf(&quot;passed: result pri = %7.2f (8237.25) \n&quot;, pri);
  }
  else {
    printf(&quot;failed: result pri = %7.2f (8237.25) \n&quot;, pri);
  }
  return 0;
}

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>
! name: SIMD.8f
! type: F-free
! version: omp_4.0
module work

integer :: P(1000)
real    :: A(1000)

contains
function do_work(arr) result(pri)
  implicit none
  real, dimension(*) :: arr

  real :: pri
  integer :: i, j

  !$omp simd private(j) lastprivate(pri)
  do i = 1, 999
    j = P(i)

    pri = 0.5
    if (mod(j-1, 2) == 0) then
      pri = A(j+1) + arr(i)
    endif
    A(j) = pri * 1.5
    pri = pri + A(j)
  end do

end function do_work

end module work

program simd_8f
  use work
  implicit none
  real :: pri, arr(1000)
  integer :: i

  do i = 1, 1000
     P(i)   = i
     A(i)   = (i-1) * 1.5
     arr(i) = (i-1) * 1.8
  end do
  pri = do_work(arr)
  if (pri == 8237.25) then
    print 2, &quot;passed&quot;, pri
  else
    print 2, &quot;failed&quot;, pri
  endif
2 format(a, &quot;: result pri = &quot;, f7.2, &quot; (8237.25)&quot;)

end program

</pre></div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "native"
        },
        kernelOptions: {
            kernelName: "native",
            path: "./contents"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'native'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="Chap_SIMD.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">SIMD</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="Examples_linear_modifier.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title"><code class="docutils literal notranslate"><span class="pre">ref</span></code>, <code class="docutils literal notranslate"><span class="pre">val</span></code>, <code class="docutils literal notranslate"><span class="pre">uval</span></code> Modifiers for <code class="docutils literal notranslate"><span class="pre">linear</span></code> Clause</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By The OpenMP Community<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>