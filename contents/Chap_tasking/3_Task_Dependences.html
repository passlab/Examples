
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>5.3. Task Dependences &#8212; OpenMP Application Programming Interface Examples</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="5.4. Task Detachment" href="4_Task_Detachment.html" />
    <link rel="prev" title="5.2. Task Priority" href="2_Task_Priority.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">OpenMP Application Programming Interface Examples</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Welcome to OMP Jupyter Book
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Title_Page.html">
   Cover
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Foreword_Chapt.html">
   Foreword
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chap_introduction/0_Chap_introduction.html">
   1. Introduction
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_introduction/1_Examples_Organization.html">
     1.1. Examples Organization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chap_directives/0_Chap_directives.html">
   2. OpenMP Directive Syntax
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_directives/1_C_C%2B%2B_Pragmas.html">
     2.1. C/C++ Pragmas
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_directives/2_C%2B%2B_Attributes.html">
     2.2. C++ Attributes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_directives/3_Fortran_Comments_Fixed_Source_Form.html">
     2.3. Fortran Comments (Fixed Source Form)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_directives/4_Fortran_Comments_Free_Source_Form.html">
     2.4. Fortran Comments (Free Source Form)
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chap_parallel_execution/0_Chap_parallel_execution.html">
   3. Parallel Execution
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_parallel_execution/1_A_Simple_Parallel_Loop.html">
     3.1. A Simple Parallel Loop
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_parallel_execution/2_parallel_Construct.html">
     3.2.
     <strong>
      parallel
     </strong>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_parallel_execution/3_teams_Construct_on_Host.html">
     3.3.
     <strong>
      teams
     </strong>
     Construct on Host
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_parallel_execution/4_Controlling_the_Number_of_Threads_on_Multiple_Nesting_Levels.html">
     3.4. Controlling the Number of Threads on Multiple Nesting Levels
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_parallel_execution/5_Interaction_Between_the_num_threads_Clause_and_omp_set_dynamic.html">
     3.5. Interaction Between the
     <strong>
      num_threads
     </strong>
     Clause and
     <strong>
      omp_set_dynamic
     </strong>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_parallel_execution/6_Fortran_Restrictions_on_the_do_Construct.html">
     3.6. Fortran Restrictions on the
     <strong>
      do
     </strong>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_parallel_execution/7_nowait_Clause.html">
     3.7.
     <strong>
      nowait
     </strong>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_parallel_execution/8_collapse_Clause.html">
     3.8.
     <strong>
      collapse
     </strong>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_parallel_execution/9_linear_Clause_in_Loop_Constructs.html">
     3.9.
     <strong>
      linear
     </strong>
     Clause in Loop Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_parallel_execution/10_parallel_sections_Construct.html">
     3.10.
     <strong>
      parallel
     </strong>
     <strong>
      sections
     </strong>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_parallel_execution/11_firstprivate_Clause_and_sections_Construct.html">
     3.11.
     <strong>
      firstprivate
     </strong>
     Clause and
     <strong>
      sections
     </strong>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_parallel_execution/12_single_Construct.html">
     3.12.
     <strong>
      single
     </strong>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_parallel_execution/13_workshare_Construct.html">
     3.13.
     <strong>
      workshare
     </strong>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_parallel_execution/14_masked_Construct.html">
     3.14.
     <strong>
      masked
     </strong>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_parallel_execution/15_loop_Construct.html">
     3.15.
     <strong>
      loop
     </strong>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_parallel_execution/16_Parallel_Random_Access_Iterator_Loop.html">
     3.16. Parallel Random Access Iterator Loop
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_parallel_execution/17_omp_set_dynamic_and_omp_set_num_threads_Routines.html">
     3.17.
     <strong>
      omp_set_dynamic
     </strong>
     and
     <strong>
      omp_set_num_threads
     </strong>
     Routines
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_parallel_execution/18_omp_get_num_threads_Routine.html">
     3.18.
     <strong>
      omp_get_num_threads
     </strong>
     Routine
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chap_affinity/0_Chap_affinity.html">
   4. OpenMP Affinity
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_affinity/1_proc_bind_Clause.html">
     4.1.
     <strong>
      proc_bind
     </strong>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_affinity/2_Task_Affinity.html">
     4.2. Task Affinity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_affinity/3_Affinity_Display.html">
     4.3. Affinity Display
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_affinity/4_Affinity_Query_Func.html">
     4.4. Affinity Query Functions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="0_Chap_tasking.html">
   5. Tasking
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="1_task_and_taskwait_Constructs.html">
     5.1.
     <strong>
      task
     </strong>
     and
     <strong>
      taskwait
     </strong>
     Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="2_Task_Priority.html">
     5.2. Task Priority
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     5.3. Task Dependences
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="4_Task_Detachment.html">
     5.4. Task Detachment
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="5_taskgroup_Construct.html">
     5.5.
     <strong>
      taskgroup
     </strong>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="6_taskyield_Construct.html">
     5.6.
     <strong>
      taskyield
     </strong>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="7_taskloop_Construct.html">
     5.7.
     <strong>
      taskloop
     </strong>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="8_Combined_parallel_masked_and_taskloop_Constructs.html">
     5.8. Combined
     <strong>
      parallel
     </strong>
     <strong>
      masked
     </strong>
     and
     <strong>
      taskloop
     </strong>
     Constructs
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chap_devices/0_Chap_devices.html">
   6. Devices
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_devices/1_target_Construct.html">
     6.1.
     <strong>
      target
     </strong>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_devices/2_defaultmap_Clause.html">
     6.2.
     <strong>
      defaultmap
     </strong>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_devices/3_Pointer_Mapping.html">
     6.3. Pointer Mapping
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_devices/4_Structure_Mapping.html">
     6.4. Structure Mapping
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_devices/5_Fortran_Allocatable_Array_Mapping.html">
     6.5. Fortran Allocatable Array Mapping
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_devices/6_Array_Sections_in_Device_Constructs.html">
     6.6. Array Sections in Device Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_devices/7_C%2B%2B_Virtual_Functions.html">
     6.7. C++ Virtual Functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_devices/8_Array_Shaping.html">
     6.8. Array Shaping
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_devices/9_declare_mapper_Directive.html">
     6.9.
     <strong>
      declare mapper
     </strong>
     Directive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_devices/10_target_data_Construct.html">
     6.10.
     <strong>
      target
     </strong>
     <strong>
      data
     </strong>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_devices/11_target_enter_data_and_target_exit_data_Constructs.html">
     6.11.
     <strong>
      target
     </strong>
     <strong>
      enter
     </strong>
     <strong>
      data
     </strong>
     and
     <strong>
      target
     </strong>
     <strong>
      exit
     </strong>
     <strong>
      data
     </strong>
     Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_devices/12_target_update_Construct.html">
     6.12.
     <strong>
      target
     </strong>
     <strong>
      update
     </strong>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_devices/13_Declare_Target_Directive.html">
     6.13. Declare Target Directive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_devices/14_Lambda_Expressions.html">
     6.14. Lambda Expressions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_devices/15_teams_Construct_and_Related_Combined_Constructs.html">
     6.15.
     <strong>
      teams
     </strong>
     Construct and Related Combined Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_devices/16_Asynchronous_target_Execution_and_Dependences.html">
     6.16. Asynchronous
     <strong>
      target
     </strong>
     Execution and Dependences
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_devices/17_Device_Routines.html">
     6.17. Device Routines
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chap_SIMD/0_Chap_SIMD.html">
   7. SIMD
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_SIMD/1_simd_and_declare_simd_Directives.html">
     7.1.
     <strong>
      simd
     </strong>
     and
     <strong>
      declare
     </strong>
     <strong>
      simd
     </strong>
     Directives
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_SIMD/2_inbranch_and_notinbranch_Clauses.html">
     7.2.
     <strong>
      inbranch
     </strong>
     and
     <strong>
      notinbranch
     </strong>
     Clauses
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_SIMD/3_Loop-Carried_Lexical_Forward_Dependence.html">
     7.3. Loop-Carried Lexical Forward Dependence
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_SIMD/4_ref_val_uvalModifiers_for_linear_Clause.html">
     7.4.
     <strong>
      ref
     </strong>
     ,
     <strong>
      val
     </strong>
     ,
     <strong>
      uval
     </strong>
     Modifiers for
     <strong>
      linear
     </strong>
     Clause
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chap_loop_transformations/0_Chap_loop_transformations.html">
   8. Loop Transformations
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_loop_transformations/1_tile_Construct.html">
     8.1.
     <strong>
      tile
     </strong>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_loop_transformations/2_unroll_Construct.html">
     8.2.
     <strong>
      unroll
     </strong>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_loop_transformations/3_Incomplete_Tiles.html">
     8.3. Incomplete Tiles
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chap_synchronization/0_Chap_synchronization.html">
   9. Synchronization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_synchronization/1_critical_Construct.html">
     9.1.
     <strong>
      critical
     </strong>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_synchronization/2_Worksharing_Constructs_Inside_a_critical_Construct.html">
     9.2. Worksharing Constructs Inside a
     <strong>
      critical
     </strong>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_synchronization/3_Binding_of_barrier_Regions.html">
     9.3. Binding of
     <strong>
      barrier
     </strong>
     Regions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_synchronization/4_atomic_Construct.html">
     9.4.
     <strong>
      atomic
     </strong>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_synchronization/5_Restrictions_on_the_atomic_Construct.html">
     9.5. Restrictions on the
     <strong>
      atomic
     </strong>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_synchronization/6_flush_Construct_without_a_List.html">
     9.6.
     <strong>
      flush
     </strong>
     Construct without a List
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_synchronization/7_Synchronization_Based_on_Acquire_Release_Semantics.html">
     9.7. Synchronization Based on Acquire/Release Semantics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_synchronization/8_ordered_Clause_and_ordered_Construct.html">
     9.8.
     <strong>
      ordered
     </strong>
     Clause and
     <strong>
      ordered
     </strong>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_synchronization/9_depobj_Construct.html">
     9.9.
     <strong>
      depobj
     </strong>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_synchronization/10_Doacross_Loop_Nest.html">
     9.10. Doacross Loop Nest
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_synchronization/11_Lock_Routines.html">
     9.11. Lock Routines
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chap_data_environment/0_Chap_data_environment.html">
   10. Data Environment
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_data_environment/1_threadprivate_Directive.html">
     10.1.
     <strong>
      threadprivate
     </strong>
     Directive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_data_environment/2_default_none_Clause.html">
     10.2.
     <strong>
      default(none)
     </strong>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_data_environment/3_private_Clause.html">
     10.3.
     <strong>
      private
     </strong>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_data_environment/4_Fortran_Private_Loop_Iteration_Variables.html">
     10.4. Fortran Private Loop Iteration Variables
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_data_environment/5_Fortran_Restrictions_on_shared_and_private_Clauses_with_Common_Blocks.html">
     10.5. Fortran Restrictions on
     <strong>
      shared
     </strong>
     and
     <strong>
      private
     </strong>
     Clauses with Common Blocks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_data_environment/6_Fortran_Restrictions_on_Storage_Association_with_the_private_Clause.html">
     10.6. Fortran Restrictions on Storage Association with the
     <strong>
      private
     </strong>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_data_environment/7_C_C%2B%2B_Arrays_in_a_firstprivate_Clause.html">
     10.7. C/C++ Arrays in a
     <strong>
      firstprivate
     </strong>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_data_environment/8_lastprivate_Clause.html">
     10.8.
     <strong>
      lastprivate
     </strong>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_data_environment/9_Reduction.html">
     10.9. Reduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_data_environment/10_scan_Directive.html">
     10.10.
     <strong>
      scan
     </strong>
     Directive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_data_environment/11_copyin_Clause.html">
     10.11.
     <strong>
      copyin
     </strong>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_data_environment/12_copyprivate_Clause.html">
     10.12.
     <strong>
      copyprivate
     </strong>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_data_environment/13_C%2B%2B_Reference_in_Data-Sharing_Clauses.html">
     10.13. C++ Reference in Data-Sharing Clauses
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_data_environment/14_Fortran_ASSOCIATE_Construct.html">
     10.14. Fortran
     <strong>
      ASSOCIATE
     </strong>
     Construct
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chap_memory_model/0_Chap_memory_model.html">
   11. Memory Model
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_memory_model/1_OpenMP_Memory_Model.html">
     11.1. OpenMP Memory Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_memory_model/2_Memory_Allocators.html">
     11.2. Memory Allocators
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_memory_model/3_Race_Conditions_Caused_by_Implied_Copies_of_Shared_Variables_in_Fortran.html">
     11.3. Race Conditions Caused by Implied Copies of Shared Variables in Fortran
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chap_program_control/0_Chap_program_control.html">
   12. Program Control
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_program_control/1_Conditional_Compilation.html">
     12.1. Conditional Compilation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_program_control/2_Internal_Control_Variables_ICVs.html">
     12.2. Internal Control Variables (ICVs)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_program_control/3_Placement_of_flush%2C_barrier_taskwait_and_taskyield_Directives.html">
     12.3. Placement of
     <strong>
      flush
     </strong>
     ,
     <strong>
      barrier
     </strong>
     ,
     <strong>
      taskwait
     </strong>
     and
     <strong>
      taskyield
     </strong>
     Directives
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_program_control/4_Cancellation_Constructs.html">
     12.4. Cancellation Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_program_control/5_requires_Directive.html">
     12.5.
     <strong>
      requires
     </strong>
     Directive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_program_control/6_declare_variant_Directive.html">
     12.6.
     <strong>
      declare
     </strong>
     <strong>
      variant
     </strong>
     Directive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_program_control/7_Metadirectives.html">
     12.7. Metadirectives
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_program_control/8_Nested_Loop_Constructs.html">
     12.8. Nested Loop Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_program_control/9_Restrictions_on_Nesting_of_Regions.html">
     12.9. Restrictions on Nesting of Regions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_program_control/10_Target_Offload.html">
     12.10. Target Offload
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_program_control/11_Controlling_Concurrency_and_Reproducibility_with_the_order_Clause.html">
     12.11. Controlling Concurrency and Reproducibility with  the
     <strong>
      order
     </strong>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_program_control/12_interop_Construct.html">
     12.12.
     <strong>
      interop
     </strong>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_program_control/13_Utilities.html">
     12.13. Utilities
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chap_ompt_interface/0_Chap_ompt_interface.html">
   13. OMPT Interface
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
  <label for="toctree-checkbox-13">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chap_ompt_interface/1_OMPT_Start.html">
     13.1. OMPT Start
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/passlab/Examples/main?urlpath=lab/tree/notebook/contents/Chap_tasking/3_Task_Dependences.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/passlab/Examples"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/passlab/Examples/issues/new?title=Issue%20on%20page%20%2Fcontents/Chap_tasking/3_Task_Dependences.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/contents/Chap_tasking/3_Task_Dependences.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#flow-dependence">
   5.3.1. Flow Dependence
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#anti-dependence">
   5.3.2. Anti-dependence
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#output-dependence">
   5.3.3. Output Dependence
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#concurrent-execution-with-dependences">
   5.3.4. Concurrent Execution with Dependences
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#matrix-multiplication">
   5.3.5. Matrix multiplication
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#taskwait-with-dependences">
   5.3.6.
   <strong>
    taskwait
   </strong>
   with Dependences
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mutually-exclusive-execution-with-dependences">
   5.3.7. Mutually Exclusive Execution with Dependences
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#multidependences-using-iterators">
   5.3.8. Multidependences Using Iterators
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dependence-for-undeferred-tasks">
   5.3.9. Dependence for Undeferred Tasks
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Task Dependences</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#flow-dependence">
   5.3.1. Flow Dependence
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#anti-dependence">
   5.3.2. Anti-dependence
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#output-dependence">
   5.3.3. Output Dependence
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#concurrent-execution-with-dependences">
   5.3.4. Concurrent Execution with Dependences
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#matrix-multiplication">
   5.3.5. Matrix multiplication
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#taskwait-with-dependences">
   5.3.6.
   <strong>
    taskwait
   </strong>
   with Dependences
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mutually-exclusive-execution-with-dependences">
   5.3.7. Mutually Exclusive Execution with Dependences
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#multidependences-using-iterators">
   5.3.8. Multidependences Using Iterators
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dependence-for-undeferred-tasks">
   5.3.9. Dependence for Undeferred Tasks
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="task-dependences">
<h1><span class="section-number">5.3. </span>Task Dependences<a class="headerlink" href="#task-dependences" title="Permalink to this headline">#</a></h1>
<section id="flow-dependence">
<h2><span class="section-number">5.3.1. </span>Flow Dependence<a class="headerlink" href="#flow-dependence" title="Permalink to this headline">#</a></h2>
<p>This example shows a simple flow dependence using a <strong>depend</strong>  clause on the <strong>task</strong> construct.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//%compiler: clang</span>
<span class="c1">//%cflags: -fopenmp</span>

<span class="cm">/*</span>
<span class="cm">* name: task_dep.1</span>
<span class="cm">* type: C</span>
<span class="cm">* version: omp_4.0</span>
<span class="cm">*/</span><span class="w"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="cp">#pragma omp parallel</span>
<span class="w">   </span><span class="cp">#pragma omp single</span>
<span class="w">   </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="cp">#pragma omp task shared(x) depend(out: x)</span>
<span class="w">         </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="cp">#pragma omp task shared(x) depend(in: x)</span>
<span class="w">         </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;x = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="o">!!%</span><span class="n">compiler</span><span class="o">:</span><span class="w"> </span><span class="n">gfortran</span><span class="w"></span>
<span class="o">!!%</span><span class="n">cflags</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="n">fopenmp</span><span class="w"></span>

<span class="o">!</span><span class="w"> </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">task_dep</span><span class="mf">.1</span><span class="w"></span>
<span class="o">!</span><span class="w"> </span><span class="n">type</span><span class="o">:</span><span class="w"> </span><span class="n">F</span><span class="o">-</span><span class="n">free</span><span class="w"></span>
<span class="o">!</span><span class="w"> </span><span class="n">version</span><span class="o">:</span><span class="w">    </span><span class="n">omp_4</span><span class="mf">.0</span><span class="w"></span>
<span class="n">program</span><span class="w"> </span><span class="n">example</span><span class="w"></span>
<span class="w">   </span><span class="n">integer</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">x</span><span class="w"></span>
<span class="w">   </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">   </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">parallel</span><span class="w"></span>
<span class="w">   </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">single</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">shared</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">out</span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">task</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">shared</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">in</span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">print</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;x = &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">task</span><span class="w"></span>
<span class="w">   </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">single</span><span class="w"></span>
<span class="w">   </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">parallel</span><span class="w"></span>
<span class="n">end</span><span class="w"> </span><span class="n">program</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>The program will always print  <strong>“</strong> x = 2 <strong>“</strong> , because the <strong>depend</strong>  clauses enforce the ordering of the tasks. If the <strong>depend</strong> clauses had been  omitted, then the tasks could execute in any order and the program and the program  would have a race condition.</p>
</section>
<section id="anti-dependence">
<h2><span class="section-number">5.3.2. </span>Anti-dependence<a class="headerlink" href="#anti-dependence" title="Permalink to this headline">#</a></h2>
<p>This example shows an anti-dependence using the <strong>depend</strong>  clause on the <strong>task</strong> construct.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//%compiler: clang</span>
<span class="c1">//%cflags: -fopenmp</span>

<span class="cm">/*</span>
<span class="cm">* name: task_dep.2</span>
<span class="cm">* type: C</span>
<span class="cm">* version: omp_4.0</span>
<span class="cm">*/</span><span class="w"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="cp">#pragma omp parallel</span>
<span class="w">   </span><span class="cp">#pragma omp single</span>
<span class="w">   </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="cp">#pragma omp task shared(x) depend(in: x)</span>
<span class="w">         </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;x = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="cp">#pragma omp task shared(x) depend(out: x)</span>
<span class="w">         </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="o">!!%</span><span class="n">compiler</span><span class="o">:</span><span class="w"> </span><span class="n">gfortran</span><span class="w"></span>
<span class="o">!!%</span><span class="n">cflags</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="n">fopenmp</span><span class="w"></span>

<span class="o">!</span><span class="w"> </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">task_dep</span><span class="mf">.2</span><span class="w"></span>
<span class="o">!</span><span class="w"> </span><span class="n">type</span><span class="o">:</span><span class="w"> </span><span class="n">F</span><span class="o">-</span><span class="n">free</span><span class="w"></span>
<span class="o">!</span><span class="w"> </span><span class="n">version</span><span class="o">:</span><span class="w">    </span><span class="n">omp_4</span><span class="mf">.0</span><span class="w"></span>
<span class="n">program</span><span class="w"> </span><span class="n">example</span><span class="w"></span>
<span class="w">   </span><span class="n">integer</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">x</span><span class="w"></span>
<span class="w">   </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">   </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">parallel</span><span class="w"></span>
<span class="w">   </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">single</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">shared</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">in</span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">print</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;x = &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">task</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">shared</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">out</span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">task</span><span class="w"></span>
<span class="w">   </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">single</span><span class="w"></span>
<span class="w">   </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">parallel</span><span class="w"></span>
<span class="n">end</span><span class="w"> </span><span class="n">program</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>The program will always print  <strong>“</strong> x = 1 <strong>“</strong> , because the <strong>depend</strong>  clauses enforce the ordering of the tasks. If the <strong>depend</strong> clauses had been  omitted, then the tasks could execute in any order and the program would have a  race condition.</p>
</section>
<section id="output-dependence">
<h2><span class="section-number">5.3.3. </span>Output Dependence<a class="headerlink" href="#output-dependence" title="Permalink to this headline">#</a></h2>
<p><strong>task dependences!output dependence</strong></p>
<p>This example shows an output dependence using the <strong>depend</strong>  clause on the <strong>task</strong> construct.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//%compiler: clang</span>
<span class="c1">//%cflags: -fopenmp</span>

<span class="cm">/*</span>
<span class="cm">* name: task_dep.3</span>
<span class="cm">* type: C</span>
<span class="cm">* version: omp_4.0</span>
<span class="cm">*/</span><span class="w"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="cp">#pragma omp parallel</span>
<span class="w">   </span><span class="cp">#pragma omp single</span>
<span class="w">   </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="cp">#pragma omp task shared(x) depend(out: x)</span>
<span class="w">         </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="cp">#pragma omp task shared(x) depend(out: x)</span>
<span class="w">         </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="cp">#pragma omp taskwait</span>
<span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;x = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="o">!!%</span><span class="n">compiler</span><span class="o">:</span><span class="w"> </span><span class="n">gfortran</span><span class="w"></span>
<span class="o">!!%</span><span class="n">cflags</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="n">fopenmp</span><span class="w"></span>

<span class="o">!</span><span class="w"> </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">task_dep</span><span class="mf">.3</span><span class="w"></span>
<span class="o">!</span><span class="w"> </span><span class="n">type</span><span class="o">:</span><span class="w"> </span><span class="n">F</span><span class="o">-</span><span class="n">free</span><span class="w"></span>
<span class="o">!</span><span class="w"> </span><span class="n">version</span><span class="o">:</span><span class="w">    </span><span class="n">omp_4</span><span class="mf">.0</span><span class="w"></span>
<span class="n">program</span><span class="w"> </span><span class="n">example</span><span class="w"></span>
<span class="w">   </span><span class="n">integer</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">x</span><span class="w"></span>
<span class="w">   </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">parallel</span><span class="w"></span>
<span class="w">   </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">single</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">shared</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">out</span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">task</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">shared</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">out</span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">task</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">taskwait</span><span class="w"></span>
<span class="w">      </span><span class="n">print</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;x = &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"></span>
<span class="w">   </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">single</span><span class="w"></span>
<span class="w">   </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">parallel</span><span class="w"></span>
<span class="n">end</span><span class="w"> </span><span class="n">program</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>The program will always print  <strong>“</strong> x = 2 <strong>“</strong> , because the <strong>depend</strong>  clauses enforce the ordering of the tasks. If the <strong>depend</strong> clauses had been  omitted, then the tasks could execute in any order and the program would have a  race condition.</p>
</section>
<section id="concurrent-execution-with-dependences">
<h2><span class="section-number">5.3.4. </span>Concurrent Execution with Dependences<a class="headerlink" href="#concurrent-execution-with-dependences" title="Permalink to this headline">#</a></h2>
<p>In this example we show potentially concurrent execution of tasks using multiple  flow dependences expressed using the <strong>depend</strong> clause on the <strong>task</strong>  construct.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//%compiler: clang</span>
<span class="c1">//%cflags: -fopenmp</span>

<span class="cm">/*</span>
<span class="cm">* name: task_dep.4</span>
<span class="cm">* type: C</span>
<span class="cm">* version: omp_4.0</span>
<span class="cm">*/</span><span class="w"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="cp">#pragma omp parallel</span>
<span class="w">   </span><span class="cp">#pragma omp single</span>
<span class="w">   </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="cp">#pragma omp task shared(x) depend(out: x)</span>
<span class="w">         </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="cp">#pragma omp task shared(x) depend(in: x)</span>
<span class="w">         </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;x + 1 = %d. &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="cp">#pragma omp task shared(x) depend(in: x)</span>
<span class="w">         </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;x + 2 = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">+</span><span class="mi">2</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="o">!!%</span><span class="n">compiler</span><span class="o">:</span><span class="w"> </span><span class="n">gfortran</span><span class="w"></span>
<span class="o">!!%</span><span class="n">cflags</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="n">fopenmp</span><span class="w"></span>

<span class="o">!</span><span class="w"> </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">task_dep</span><span class="mf">.4</span><span class="w"></span>
<span class="o">!</span><span class="w"> </span><span class="n">type</span><span class="o">:</span><span class="w"> </span><span class="n">F</span><span class="o">-</span><span class="n">free</span><span class="w"></span>
<span class="o">!</span><span class="w"> </span><span class="n">version</span><span class="o">:</span><span class="w">    </span><span class="n">omp_4</span><span class="mf">.0</span><span class="w"></span>

<span class="n">program</span><span class="w"> </span><span class="n">example</span><span class="w"></span>
<span class="w">   </span><span class="n">integer</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">x</span><span class="w"></span>

<span class="w">   </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>

<span class="w">   </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">parallel</span><span class="w"></span>
<span class="w">   </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">single</span><span class="w"></span>

<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">shared</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">out</span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">task</span><span class="w"></span>

<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">shared</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">in</span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">print</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;x + 1 = &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">task</span><span class="w"></span>

<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">shared</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">in</span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">print</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;x + 2 = &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">task</span><span class="w"></span>

<span class="w">   </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">single</span><span class="w"></span>
<span class="w">   </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">parallel</span><span class="w"></span>
<span class="n">end</span><span class="w"> </span><span class="n">program</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>The last two tasks are dependent on the first task. However, there is no dependence  between the last two tasks, which may execute in any order (or concurrently if  more than one thread is available). Thus, the possible outputs are  <strong>“</strong> x  + 1 = 3. x + 2 = 4.  <strong>“</strong>  and  <strong>“</strong> x + 2 = 4. x + 1 = 3.  <strong>“</strong> .  If the <strong>depend</strong> clauses had been omitted, then all of the tasks could execute  in any order and the program would have a race condition.</p>
</section>
<section id="matrix-multiplication">
<h2><span class="section-number">5.3.5. </span>Matrix multiplication<a class="headerlink" href="#matrix-multiplication" title="Permalink to this headline">#</a></h2>
<p>This example shows a task-based blocked matrix multiplication. Matrices are of  NxN elements, and the multiplication is implemented using blocks of BSxBS elements.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//%compiler: clang</span>
<span class="c1">//%cflags: -fopenmp</span>

<span class="cm">/*</span>
<span class="cm">* name: task_dep.5</span>
<span class="cm">* type: C</span>
<span class="cm">* version: omp_4.0</span>
<span class="cm">*/</span><span class="w"></span>
<span class="c1">// Assume BS divides N perfectly</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">matmul_depend</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">BS</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="n">N</span><span class="p">][</span><span class="n">N</span><span class="p">],</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">N</span><span class="p">][</span><span class="n">N</span><span class="p">],</span><span class="w"> </span><span class="kt">float</span><span class="w"></span>
<span class="n">C</span><span class="p">[</span><span class="n">N</span><span class="p">][</span><span class="n">N</span><span class="p">]</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">ii</span><span class="p">,</span><span class="w"> </span><span class="n">jj</span><span class="p">,</span><span class="w"> </span><span class="n">kk</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">+=</span><span class="n">BS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">+=</span><span class="n">BS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">         </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">+=</span><span class="n">BS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="c1">// Note 1: i, j, k, A, B, C are firstprivate by default</span>
<span class="c1">// Note 2: A, B and C are just pointers</span>
<span class="cp">#pragma omp task private(ii, jj, kk) \</span>
<span class="cp">            depend ( in: A[i:BS][k:BS], B[k:BS][j:BS] ) \</span>
<span class="cp">            depend ( inout: C[i:BS][j:BS] )</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"> </span><span class="n">ii</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">i</span><span class="o">+</span><span class="n">BS</span><span class="p">;</span><span class="w"> </span><span class="n">ii</span><span class="o">++</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">jj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="p">;</span><span class="w"> </span><span class="n">jj</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">j</span><span class="o">+</span><span class="n">BS</span><span class="p">;</span><span class="w"> </span><span class="n">jj</span><span class="o">++</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">kk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="p">;</span><span class="w"> </span><span class="n">kk</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">k</span><span class="o">+</span><span class="n">BS</span><span class="p">;</span><span class="w"> </span><span class="n">kk</span><span class="o">++</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">                     </span><span class="n">C</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">jj</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">C</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">jj</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">kk</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">jj</span><span class="p">];</span><span class="w"></span>
<span class="w">         </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="o">!!%</span><span class="n">compiler</span><span class="o">:</span><span class="w"> </span><span class="n">gfortran</span><span class="w"></span>
<span class="o">!!%</span><span class="n">cflags</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="n">fopenmp</span><span class="w"></span>

<span class="o">!</span><span class="w"> </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">task_dep</span><span class="mf">.5</span><span class="w"></span>
<span class="o">!</span><span class="w"> </span><span class="n">type</span><span class="o">:</span><span class="w"> </span><span class="n">F</span><span class="o">-</span><span class="n">free</span><span class="w"></span>
<span class="o">!</span><span class="w"> </span><span class="n">version</span><span class="o">:</span><span class="w">    </span><span class="n">omp_4</span><span class="mf">.0</span><span class="w"></span>
<span class="o">!</span><span class="w"> </span><span class="n">Assume</span><span class="w"> </span><span class="n">BS</span><span class="w"> </span><span class="n">divides</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="n">perfectly</span><span class="w"></span>
<span class="n">subroutine</span><span class="w"> </span><span class="n">matmul_depend</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">BS</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="n">implicit</span><span class="w"> </span><span class="n">none</span><span class="w"></span>
<span class="w">   </span><span class="n">integer</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">BS</span><span class="p">,</span><span class="w"> </span><span class="n">BM</span><span class="w"></span>
<span class="w">   </span><span class="n">real</span><span class="p">,</span><span class="w"> </span><span class="n">dimension</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="w"></span>
<span class="w">   </span><span class="n">integer</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">ii</span><span class="p">,</span><span class="w"> </span><span class="n">jj</span><span class="p">,</span><span class="w"> </span><span class="n">kk</span><span class="w"></span>
<span class="w">   </span><span class="n">BM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BS</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">   </span><span class="k">do</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">BS</span><span class="w"></span>
<span class="w">      </span><span class="k">do</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">BS</span><span class="w"></span>
<span class="w">         </span><span class="k">do</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">BS</span><span class="w"></span>
<span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">shared</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">C</span><span class="p">)</span><span class="w"> </span><span class="n">private</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">,</span><span class="n">kk</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"></span>
<span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">depend</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">in</span><span class="o">:</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="o">:</span><span class="n">i</span><span class="o">+</span><span class="n">BM</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="o">:</span><span class="n">k</span><span class="o">+</span><span class="n">BM</span><span class="p">),</span><span class="w"> </span><span class="n">B</span><span class="p">(</span><span class="n">k</span><span class="o">:</span><span class="n">k</span><span class="o">+</span><span class="n">BM</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="o">:</span><span class="n">j</span><span class="o">+</span><span class="n">BM</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"></span>
<span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">depend</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">inout</span><span class="o">:</span><span class="w"> </span><span class="n">C</span><span class="p">(</span><span class="n">i</span><span class="o">:</span><span class="n">i</span><span class="o">+</span><span class="n">BM</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="o">:</span><span class="n">j</span><span class="o">+</span><span class="n">BM</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="o">!</span><span class="w">  </span><span class="n">I</span><span class="p">,</span><span class="n">J</span><span class="p">,</span><span class="n">K</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">firstprivate</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="k">default</span><span class="w"></span>
<span class="w">            </span><span class="k">do</span><span class="w"> </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="o">+</span><span class="n">BM</span><span class="w"></span>
<span class="w">               </span><span class="k">do</span><span class="w"> </span><span class="n">jj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="o">+</span><span class="n">BM</span><span class="w"></span>
<span class="w">                  </span><span class="k">do</span><span class="w"> </span><span class="n">kk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="o">+</span><span class="n">BM</span><span class="w"></span>
<span class="w">                     </span><span class="n">C</span><span class="p">(</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">C</span><span class="p">(</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span><span class="n">ii</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">B</span><span class="p">(</span><span class="n">jj</span><span class="p">,</span><span class="n">kk</span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="n">end</span><span class="w"> </span><span class="k">do</span><span class="w"></span>
<span class="w">               </span><span class="n">end</span><span class="w"> </span><span class="k">do</span><span class="w"></span>
<span class="w">            </span><span class="n">end</span><span class="w"> </span><span class="k">do</span><span class="w"></span>
<span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">task</span><span class="w"></span>
<span class="w">         </span><span class="n">end</span><span class="w"> </span><span class="k">do</span><span class="w"></span>
<span class="w">      </span><span class="n">end</span><span class="w"> </span><span class="k">do</span><span class="w"></span>
<span class="w">   </span><span class="n">end</span><span class="w"> </span><span class="k">do</span><span class="w"></span>
<span class="n">end</span><span class="w"> </span><span class="n">subroutine</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="taskwait-with-dependences">
<h2><span class="section-number">5.3.6. </span><strong>taskwait</strong> with Dependences<a class="headerlink" href="#taskwait-with-dependences" title="Permalink to this headline">#</a></h2>
<p>In this subsection three examples illustrate how the <strong>depend</strong> clause can be applied to a <strong>taskwait</strong> construct to make the generating task wait for specific child tasks to complete. This is an OpenMP 5.0 feature.  In the same manner that dependences can order executions among child tasks with <strong>depend</strong> clauses on <strong>task</strong> constructs, the generating task can be scheduled to wait on child tasks at a <strong>taskwait</strong> before it can proceed.</p>
<p>Note: Since the <strong>depend</strong> clause on a <strong>taskwait</strong> construct relaxes the default synchronization behavior (waiting for all children to finish), it is important to realize that child tasks that are not predecessor tasks, as determined by the <strong>depend</strong> clause of the <strong>taskwait</strong> construct, may be running concurrently while the generating task is executing after the taskwait.</p>
<p>In the first example the generating task waits at the <strong>taskwait</strong> construct for the completion of the first child task because a dependence on the first task is produced by  <em>x</em>  with an <strong>in</strong> dependence type within the <strong>depend</strong> clause of the <strong>taskwait</strong> construct. Immediately after the first <strong>taskwait</strong> construct it is safe to access the  <em>x</em>  variable by the generating task, as shown in the print statement. There is no completion restraint on the second child task. Hence, immediately after the first <strong>taskwait</strong> it is unsafe to access the  <em>y</em>  variable since the second child task may still be executing. The second <strong>taskwait</strong> ensures that the second child task has completed; hence it is safe to access the  <em>y</em>  variable in the following print statement.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//%compiler: clang</span>
<span class="c1">//%cflags: -fopenmp</span>

<span class="cm">/*</span>
<span class="cm">* name: task_dep.6</span>
<span class="cm">* type: C</span>
<span class="cm">* version: omp_5.0</span>
<span class="cm">*/</span><span class="w"></span>
<span class="cp">#include</span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="cp">#pragma omp task depend(inout: x) shared(x)</span>
<span class="w">    </span><span class="n">x</span><span class="o">++</span><span class="p">;</span><span class="w">                                        </span><span class="c1">// 1st child task</span>

<span class="w">    </span><span class="cp">#pragma omp task shared(y)</span>
<span class="w">    </span><span class="n">y</span><span class="o">--</span><span class="p">;</span><span class="w">                                        </span><span class="c1">// 2nd child task</span>

<span class="w">    </span><span class="cp">#pragma omp taskwait depend(in: x)          </span><span class="c1">// 1st taskwait</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;x=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">x</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Second task may not be finished.</span>
<span class="w">    </span><span class="c1">// Accessing y here will create a race condition.</span>

<span class="w">    </span><span class="cp">#pragma omp taskwait                        </span><span class="c1">// 2nd taskwait</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;y=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">y</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="cp">#pragma omp parallel</span>
<span class="w">    </span><span class="cp">#pragma omp single</span>
<span class="w">    </span><span class="n">foo</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="o">!!%</span><span class="n">compiler</span><span class="o">:</span><span class="w"> </span><span class="n">gfortran</span><span class="w"></span>
<span class="o">!!%</span><span class="n">cflags</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="n">fopenmp</span><span class="w"></span>

<span class="o">!</span><span class="w"> </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">task_dep</span><span class="mf">.6</span><span class="w"></span>
<span class="o">!</span><span class="w"> </span><span class="n">type</span><span class="o">:</span><span class="w"> </span><span class="n">F</span><span class="o">-</span><span class="n">free</span><span class="w"></span>
<span class="o">!</span><span class="w"> </span><span class="n">version</span><span class="o">:</span><span class="w"> </span><span class="n">omp_5</span><span class="mf">.0</span><span class="w"></span>
<span class="n">subroutine</span><span class="w"> </span><span class="n">foo</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">implicit</span><span class="w"> </span><span class="n">none</span><span class="w"></span>
<span class="w">    </span><span class="n">integer</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"></span>

<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">    </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>

<span class="w">    </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">inout</span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">shared</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w">                         </span><span class="o">!!</span><span class="w"> </span><span class="mi">1</span><span class="n">st</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="n">task</span><span class="w"></span>
<span class="w">    </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">task</span><span class="w"></span>

<span class="w">    </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">shared</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w">                         </span><span class="o">!!</span><span class="w"> </span><span class="mi">2</span><span class="n">nd</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="n">task</span><span class="w"></span>
<span class="w">    </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">task</span><span class="w"></span>

<span class="w">    </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">taskwait</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">in</span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w">          </span><span class="o">!!</span><span class="w"> </span><span class="mi">1</span><span class="n">st</span><span class="w"> </span><span class="n">taskwait</span><span class="w"></span>

<span class="w">    </span><span class="n">print</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;x=&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"></span>

<span class="w">    </span><span class="o">!!</span><span class="w"> </span><span class="n">Second</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">finished</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="o">!!</span><span class="w"> </span><span class="n">Accessing</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">race</span><span class="w"> </span><span class="n">condition</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">taskwait</span><span class="w">                        </span><span class="o">!!</span><span class="w"> </span><span class="mi">2</span><span class="n">nd</span><span class="w"> </span><span class="n">taskwait</span><span class="w"></span>

<span class="w">    </span><span class="n">print</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;y=&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"></span>

<span class="n">end</span><span class="w"> </span><span class="n">subroutine</span><span class="w"> </span><span class="n">foo</span><span class="w"></span>

<span class="n">program</span><span class="w"> </span><span class="n">p</span><span class="w"></span>
<span class="w">    </span><span class="n">implicit</span><span class="w"> </span><span class="n">none</span><span class="w"></span>
<span class="w">    </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">parallel</span><span class="w"></span>
<span class="w">    </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">single</span><span class="w"></span>
<span class="w">       </span><span class="n">call</span><span class="w"> </span><span class="n">foo</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">single</span><span class="w"></span>
<span class="w">    </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">parallel</span><span class="w"></span>
<span class="n">end</span><span class="w"> </span><span class="n">program</span><span class="w"> </span><span class="n">p</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>In this example the first two tasks are serialized, because a dependence on the first child is produced by  <em>x</em>  with the <strong>in</strong> dependence type in the <strong>depend</strong> clause of the second task. However, the generating task at the first <strong>taskwait</strong> waits only on the first child task to complete, because a dependence on only the first child task is produced by  <em>x</em>  with an <strong>in</strong> dependence type within the <strong>depend</strong> clause of the <strong>taskwait</strong> construct. The second <strong>taskwait</strong> (without a <strong>depend</strong> clause) is included to guarantee completion of the second task before  <em>y</em>  is accessed. (While unnecessary, the <strong>depend(inout:</strong> <strong>y)</strong> clause on the  2nd child task is included to illustrate how the child task dependences can be completely annotated in a data-flow model.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//%compiler: clang</span>
<span class="c1">//%cflags: -fopenmp</span>

<span class="cm">/*</span>
<span class="cm">* name: task_dep.7</span>
<span class="cm">* type: C</span>
<span class="cm">* version: omp_5.0</span>
<span class="cm">*/</span><span class="w"></span>
<span class="cp">#include</span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="cp">#pragma omp task depend(inout: x) shared(x)</span>
<span class="w">    </span><span class="n">x</span><span class="o">++</span><span class="p">;</span><span class="w">                                          </span><span class="c1">// 1st child task</span>

<span class="w">    </span><span class="cp">#pragma omp task depend(in: x) depend(inout: y) shared(x, y)</span>
<span class="w">    </span><span class="n">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w">                                       </span><span class="c1">// 2nd child task</span>

<span class="w">    </span><span class="cp">#pragma omp taskwait depend(in: x)            </span><span class="c1">// 1st taskwait</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;x=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">x</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Second task may not be finished.</span>
<span class="w">    </span><span class="c1">// Accessing y here would create a race condition.</span>

<span class="w">    </span><span class="cp">#pragma omp taskwait                          </span><span class="c1">// 2nd taskwait</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;y=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">y</span><span class="p">);</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="cp">#pragma omp parallel</span>
<span class="w">    </span><span class="cp">#pragma omp single</span>
<span class="w">    </span><span class="n">foo</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="o">!!%</span><span class="n">compiler</span><span class="o">:</span><span class="w"> </span><span class="n">gfortran</span><span class="w"></span>
<span class="o">!!%</span><span class="n">cflags</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="n">fopenmp</span><span class="w"></span>

<span class="o">!</span><span class="w"> </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">task_dep</span><span class="mf">.7</span><span class="w"></span>
<span class="o">!</span><span class="w"> </span><span class="n">type</span><span class="o">:</span><span class="w"> </span><span class="n">F</span><span class="o">-</span><span class="n">free</span><span class="w"></span>
<span class="o">!</span><span class="w"> </span><span class="n">version</span><span class="o">:</span><span class="w"> </span><span class="n">omp_5</span><span class="mf">.0</span><span class="w"></span>
<span class="n">subroutine</span><span class="w"> </span><span class="n">foo</span><span class="p">()</span><span class="w"></span>
<span class="n">implicit</span><span class="w"> </span><span class="n">none</span><span class="w"></span>
<span class="n">integer</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"></span>

<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">    </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>

<span class="w">    </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">inout</span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">shared</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w">                         </span><span class="o">!!</span><span class="w"> </span><span class="mi">1</span><span class="n">st</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="n">task</span><span class="w"></span>
<span class="w">    </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">task</span><span class="w"></span>

<span class="w">    </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">in</span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">inout</span><span class="o">:</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="n">shared</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x</span><span class="w">                         </span><span class="o">!!</span><span class="w"> </span><span class="mi">2</span><span class="n">nd</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="n">task</span><span class="w"></span>
<span class="w">    </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">task</span><span class="w"></span>

<span class="w">    </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">taskwait</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">in</span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w">          </span><span class="o">!!</span><span class="w"> </span><span class="mi">1</span><span class="n">st</span><span class="w"> </span><span class="n">taskwait</span><span class="w"></span>

<span class="w">    </span><span class="n">print</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;x=&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"></span>

<span class="w">    </span><span class="o">!!</span><span class="w"> </span><span class="n">Second</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">finished</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="o">!!</span><span class="w"> </span><span class="n">Accessing</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="n">would</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">race</span><span class="w"> </span><span class="n">condition</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">taskwait</span><span class="w">                        </span><span class="o">!!</span><span class="w"> </span><span class="mi">2</span><span class="n">nd</span><span class="w"> </span><span class="n">taskwait</span><span class="w"></span>

<span class="w">    </span><span class="n">print</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;y=&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"></span>

<span class="n">end</span><span class="w"> </span><span class="n">subroutine</span><span class="w"> </span><span class="n">foo</span><span class="w"></span>

<span class="n">program</span><span class="w"> </span><span class="n">p</span><span class="w"></span>
<span class="n">implicit</span><span class="w"> </span><span class="n">none</span><span class="w"></span>
<span class="w">    </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">parallel</span><span class="w"></span>
<span class="w">    </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">single</span><span class="w"></span>
<span class="w">       </span><span class="n">call</span><span class="w"> </span><span class="n">foo</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">single</span><span class="w"></span>
<span class="w">    </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">parallel</span><span class="w"></span>
<span class="n">end</span><span class="w"> </span><span class="n">program</span><span class="w"> </span><span class="n">p</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>This example is similar to the previous one, except the generating task is directed to also wait for completion of the second task.</p>
<p>The <strong>depend</strong> clause of the <strong>taskwait</strong> construct now includes an <strong>in</strong> dependence type for  <em>y</em> .  Hence the generating task must now wait on completion of any child task having  <em>y</em>  with an <strong>out</strong> (here <strong>inout</strong>) dependence type in its <strong>depend</strong> clause. So, the <strong>depend</strong> clause of the <strong>taskwait</strong> construct now constrains the second task to complete at the <strong>taskwait</strong>, too. (This change makes the second <strong>taskwait</strong> of the previous example unnecessary– it has been removed in this example.)</p>
<p>Note: While a taskwait construct ensures that all child tasks have completed; a depend clause on a taskwait construct only waits for specific child tasks (prescribed by the dependence type and list items in the <strong>taskwait</strong>’s <strong>depend</strong> clause). This and the previous example illustrate the need to carefully determine the dependence type of variables in the <strong>taskwait</strong> <strong>depend</strong> clause when selecting child tasks that the generating task must wait on, so that its execution after the taskwait does not produce race conditions on variables accessed by non-completed child tasks.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//%compiler: clang</span>
<span class="c1">//%cflags: -fopenmp</span>

<span class="cm">/*</span>
<span class="cm">* name: task_dep.8</span>
<span class="cm">* type: C</span>
<span class="cm">* version: omp_5.0</span>
<span class="cm">*/</span><span class="w"></span>
<span class="cp">#include</span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="cp">#pragma omp task depend(inout: x) shared(x)</span>
<span class="w">    </span><span class="n">x</span><span class="o">++</span><span class="p">;</span><span class="w">                                          </span><span class="c1">// 1st child task</span>

<span class="w">    </span><span class="cp">#pragma omp task depend(in: x) depend(inout: y) shared(x, y)</span>
<span class="w">    </span><span class="n">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w">                                       </span><span class="c1">// 2st child task</span>

<span class="w">    </span><span class="cp">#pragma omp taskwait depend(in: x,y)</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;x=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">x</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;y=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">y</span><span class="p">);</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="cp">#pragma omp parallel</span>
<span class="w">    </span><span class="cp">#pragma omp single</span>
<span class="w">    </span><span class="n">foo</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="o">!!%</span><span class="n">compiler</span><span class="o">:</span><span class="w"> </span><span class="n">gfortran</span><span class="w"></span>
<span class="o">!!%</span><span class="n">cflags</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="n">fopenmp</span><span class="w"></span>

<span class="o">!</span><span class="w"> </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">task_dep</span><span class="mf">.8</span><span class="w"></span>
<span class="o">!</span><span class="w"> </span><span class="n">type</span><span class="o">:</span><span class="w"> </span><span class="n">F</span><span class="o">-</span><span class="n">free</span><span class="w"></span>
<span class="o">!</span><span class="w"> </span><span class="n">version</span><span class="o">:</span><span class="w"> </span><span class="n">omp_5</span><span class="mf">.0</span><span class="w"></span>
<span class="n">subroutine</span><span class="w"> </span><span class="n">foo</span><span class="p">()</span><span class="w"></span>
<span class="n">implicit</span><span class="w"> </span><span class="n">nonE</span><span class="w"></span>
<span class="n">integer</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"></span>

<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">    </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>

<span class="w">    </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">inout</span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">shared</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w">                         </span><span class="o">!!</span><span class="w"> </span><span class="mi">1</span><span class="n">st</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="n">task</span><span class="w"></span>
<span class="w">    </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">task</span><span class="w"></span>

<span class="w">    </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">in</span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">inout</span><span class="o">:</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="n">shared</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x</span><span class="w">                         </span><span class="o">!!</span><span class="w"> </span><span class="mi">2</span><span class="n">nd</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="n">task</span><span class="w"></span>
<span class="w">    </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">task</span><span class="w"></span>

<span class="w">    </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">taskwait</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">in</span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">print</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;x=&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"></span>
<span class="w">    </span><span class="n">print</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;y=&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"></span>

<span class="n">end</span><span class="w"> </span><span class="n">subroutine</span><span class="w"> </span><span class="n">foo</span><span class="w"></span>

<span class="n">program</span><span class="w"> </span><span class="n">p</span><span class="w"></span>
<span class="n">implicit</span><span class="w"> </span><span class="n">none</span><span class="w"></span>
<span class="w">    </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">parallel</span><span class="w"></span>
<span class="w">    </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">single</span><span class="w"></span>
<span class="w">       </span><span class="n">call</span><span class="w"> </span><span class="n">foo</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">single</span><span class="w"></span>
<span class="w">    </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">parallel</span><span class="w"></span>
<span class="n">end</span><span class="w"> </span><span class="n">program</span><span class="w"> </span><span class="n">p</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="mutually-exclusive-execution-with-dependences">
<h2><span class="section-number">5.3.7. </span>Mutually Exclusive Execution with Dependences<a class="headerlink" href="#mutually-exclusive-execution-with-dependences" title="Permalink to this headline">#</a></h2>
<p>In this example we show a series of tasks, including mutually exclusive tasks, expressing dependences using the <strong>depend</strong> clause on the <strong>task</strong> construct.</p>
<p>The program will always print 6. Tasks T1, T2 and T3 will be scheduled first, in any order. Task T4 will be scheduled after tasks T1 and T2 are completed. T5 will be scheduled after tasks T1 and T3 are completed. Due to the <strong>mutexinoutset</strong> dependence type on <strong>c</strong>, T4 and T5 may be scheduled in any order with respect to each other, but not at the same time. Tasks T6 will be scheduled after both T4 and T5 are completed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//%compiler: clang</span>
<span class="c1">//%cflags: -fopenmp</span>

<span class="cm">/*</span>
<span class="cm">* name: task_dep.9</span>
<span class="cm">* type: C</span>
<span class="cm">* version: omp_5.0</span>
<span class="cm">*/</span><span class="w"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="cp">#pragma omp parallel</span>
<span class="w">   </span><span class="cp">#pragma omp single</span>
<span class="w">   </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="cp">#pragma omp task depend(out: c)</span>
<span class="w">         </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">   </span><span class="cm">/* Task T1 */</span><span class="w"></span>
<span class="w">      </span><span class="cp">#pragma omp task depend(out: a)</span>
<span class="w">         </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w">   </span><span class="cm">/* Task T2 */</span><span class="w"></span>
<span class="w">      </span><span class="cp">#pragma omp task depend(out: b)</span>
<span class="w">         </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w">   </span><span class="cm">/* Task T3 */</span><span class="w"></span>
<span class="w">      </span><span class="cp">#pragma omp task depend(in: a) depend(mutexinoutset: c)</span>
<span class="w">         </span><span class="n">c</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w">  </span><span class="cm">/* Task T4 */</span><span class="w"></span>
<span class="w">      </span><span class="cp">#pragma omp task depend(in: b) depend(mutexinoutset: c)</span>
<span class="w">         </span><span class="n">c</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w">  </span><span class="cm">/* Task T5 */</span><span class="w"></span>
<span class="w">      </span><span class="cp">#pragma omp task depend(in: c)</span>
<span class="w">         </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">;</span><span class="w">   </span><span class="cm">/* Task T6 */</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="o">!!%</span><span class="n">compiler</span><span class="o">:</span><span class="w"> </span><span class="n">gfortran</span><span class="w"></span>
<span class="o">!!%</span><span class="n">cflags</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="n">fopenmp</span><span class="w"></span>

<span class="o">!</span><span class="w"> </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">task_dep</span><span class="mf">.9</span><span class="w"></span>
<span class="o">!</span><span class="w"> </span><span class="n">type</span><span class="o">:</span><span class="w"> </span><span class="n">F</span><span class="o">-</span><span class="n">free</span><span class="w"></span>
<span class="o">!</span><span class="w"> </span><span class="n">version</span><span class="o">:</span><span class="w">    </span><span class="n">omp_5</span><span class="mf">.0</span><span class="w"></span>
<span class="n">program</span><span class="w"> </span><span class="n">example</span><span class="w"></span>
<span class="w">   </span><span class="n">integer</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="w"></span>
<span class="w">   </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">parallel</span><span class="w"></span>
<span class="w">   </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">single</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">out</span><span class="o">:</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">      </span><span class="o">!</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="n">T1</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">task</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">out</span><span class="o">:</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w">      </span><span class="o">!</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="n">T2</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">task</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">out</span><span class="o">:</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w">      </span><span class="o">!</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="n">T3</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">task</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">in</span><span class="o">:</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">mutexinoutset</span><span class="o">:</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">a</span><span class="w">  </span><span class="o">!</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="n">T4</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">task</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">in</span><span class="o">:</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">mutexinoutset</span><span class="o">:</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="w">  </span><span class="o">!</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="n">T5</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">task</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">in</span><span class="o">:</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="w">      </span><span class="o">!</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="n">T6</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">task</span><span class="w"></span>
<span class="w">   </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">single</span><span class="w"></span>
<span class="w">   </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">parallel</span><span class="w"></span>
<span class="w">   </span><span class="n">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="w"></span>
<span class="n">end</span><span class="w"> </span><span class="n">program</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>The following example demonstrates a situation where the <strong>mutexinoutset</strong> dependence type is advantageous. If <strong>shortTaskB</strong> completes before <strong>longTaskA</strong>, the runtime can take advantage of this by scheduling <strong>longTaskBC</strong> before <strong>shortTaskAC</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//%compiler: clang</span>
<span class="c1">//%cflags: -fopenmp</span>

<span class="cm">/*</span>
<span class="cm">* name: task_dep.10</span>
<span class="cm">* type: C</span>
<span class="cm">* version: omp_5.0</span>
<span class="cm">*/</span><span class="w"></span>
<span class="k">extern</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">longTaskA</span><span class="p">(),</span><span class="w"> </span><span class="n">shortTaskB</span><span class="p">();</span><span class="w"></span>
<span class="k">extern</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">shortTaskAC</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="kt">int</span><span class="p">),</span><span class="w"> </span><span class="n">longTaskBC</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="kt">int</span><span class="p">);</span><span class="w"></span>
<span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="cp">#pragma omp parallel</span>
<span class="w">  </span><span class="cp">#pragma omp single</span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">     </span><span class="cp">#pragma omp task depend(out: a)</span>
<span class="w">        </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">longTaskA</span><span class="p">();</span><span class="w"></span>
<span class="w">     </span><span class="cp">#pragma omp task depend(out: b)</span>
<span class="w">        </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shortTaskB</span><span class="p">();</span><span class="w"></span>
<span class="w">     </span><span class="cp">#pragma omp task depend(in: a) depend(mutexinoutset: c)</span>
<span class="w">        </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shortTaskAC</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">c</span><span class="p">);</span><span class="w"></span>
<span class="w">     </span><span class="cp">#pragma omp task depend(in: b) depend(mutexinoutset: c)</span>
<span class="w">        </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">longTaskBC</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="o">!!%</span><span class="n">compiler</span><span class="o">:</span><span class="w"> </span><span class="n">gfortran</span><span class="w"></span>
<span class="o">!!%</span><span class="n">cflags</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="n">fopenmp</span><span class="w"></span>

<span class="o">!</span><span class="w"> </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">task_dep</span><span class="mf">.10</span><span class="w"></span>
<span class="o">!</span><span class="w"> </span><span class="n">type</span><span class="o">:</span><span class="w"> </span><span class="n">F</span><span class="o">-</span><span class="n">free</span><span class="w"></span>
<span class="o">!</span><span class="w"> </span><span class="n">version</span><span class="o">:</span><span class="w">    </span><span class="n">omp_5</span><span class="mf">.0</span><span class="w"></span>
<span class="n">subroutine</span><span class="w"> </span><span class="n">foo</span><span class="w"></span>
<span class="w">   </span><span class="n">integer</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="w"></span>
<span class="w">   </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">parallel</span><span class="w"></span>
<span class="w">   </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">single</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">out</span><span class="o">:</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">longTaskA</span><span class="p">()</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">task</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">out</span><span class="o">:</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shortTaskB</span><span class="p">()</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">task</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">in</span><span class="o">:</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">mutexinoutset</span><span class="o">:</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shortTaskAC</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">c</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">task</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">in</span><span class="o">:</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">mutexinoutset</span><span class="o">:</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">longTaskBC</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">task</span><span class="w"></span>
<span class="w">   </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">single</span><span class="w"></span>
<span class="w">   </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">parallel</span><span class="w"></span>
<span class="n">end</span><span class="w"> </span><span class="n">subroutine</span><span class="w"> </span><span class="n">foo</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="multidependences-using-iterators">
<h2><span class="section-number">5.3.8. </span>Multidependences Using Iterators<a class="headerlink" href="#multidependences-using-iterators" title="Permalink to this headline">#</a></h2>
<p>The following example uses an iterator to define a dynamic number of dependences.</p>
<p>In the <strong>single</strong> construct of a parallel region a loop generates n tasks and each task has an <strong>out</strong> dependence specified through an element of the  <em>v</em>  array.  This is followed by a single task that defines an <strong>in</strong> dependence on each element of the array.  This is accomplished by using the <strong>iterator</strong> modifier in the <strong>depend</strong> clause, supporting a dynamic number of dependences ( <em>n</em>  here).</p>
<p>The task for the  <em>print_all_elements</em>  function is not executed until all dependences prescribed (or registered) by the iterator are fulfilled; that is, after all the tasks generated by the loop have completed.</p>
<p>Note, one cannot simply use an array section in the <strong>depend</strong> clause of the second task construct because this would violate the <strong>depend</strong> clause restriction:</p>
<p>“List items used in <strong>depend</strong> clauses of the same task or sibling tasks must indicate identical storage locations or disjoint storage locations”.</p>
<p>In this case each of the loop tasks use a single disjoint (different storage) element in their <strong>depend</strong> clause; however, the array-section storage area prescribed in the commented directive is neither identical nor disjoint to the storage prescribed by the elements of the loop tasks.  The iterator overcomes this restriction by effectively creating n disjoint storage areas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//%compiler: clang</span>
<span class="c1">//%cflags: -fopenmp</span>

<span class="cm">/*</span>
<span class="cm">* name:       task_dep.11</span>
<span class="cm">* type:       C</span>
<span class="cm">* version: omp_5.0</span>
<span class="cm">*/</span><span class="w"></span>
<span class="cp">#include</span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">set_an_element</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">print_all_elements</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d, &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">parallel_computation</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="cp">#pragma omp parallel</span>
<span class="w">    </span><span class="cp">#pragma omp single</span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="cp">#pragma omp task depend(out: v[i])</span>
<span class="w">            </span><span class="n">set_an_element</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">i</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="cp">#pragma omp task depend(iterator(it = 0:n), in: v[it])</span>
<span class="w">     </span><span class="c1">// The following violates array-section restriction:</span>
<span class="w">     </span><span class="c1">// #pragma omp task depend(in: v[0:n])</span>
<span class="w">        </span><span class="n">print_all_elements</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="o">!!%</span><span class="n">compiler</span><span class="o">:</span><span class="w"> </span><span class="n">gfortran</span><span class="w"></span>
<span class="o">!!%</span><span class="n">cflags</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="n">fopenmp</span><span class="w"></span>

<span class="o">!</span><span class="w"> </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">task_dep</span><span class="mf">.11</span><span class="w"></span>
<span class="o">!</span><span class="w"> </span><span class="n">type</span><span class="o">:</span><span class="w"> </span><span class="n">F</span><span class="o">-</span><span class="n">free</span><span class="w"></span>
<span class="o">!</span><span class="w"> </span><span class="n">version</span><span class="o">:</span><span class="w">    </span><span class="n">omp_5</span><span class="mf">.0</span><span class="w"></span>
<span class="n">subroutine</span><span class="w"> </span><span class="n">set_an_element</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">implicit</span><span class="w"> </span><span class="n">none</span><span class="w"></span>
<span class="w">    </span><span class="n">integer</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="w"></span>

<span class="w">    </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span><span class="w"></span>

<span class="n">end</span><span class="w"> </span><span class="n">subroutine</span><span class="w"></span>

<span class="n">subroutine</span><span class="w"> </span><span class="n">print_all_elements</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">implicit</span><span class="w"> </span><span class="n">none</span><span class="w"></span>
<span class="w">    </span><span class="n">integer</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="w"></span>

<span class="n">end</span><span class="w"> </span><span class="n">subroutine</span><span class="w"></span>

<span class="n">subroutine</span><span class="w"> </span><span class="n">parallel_computation</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">implicit</span><span class="w"> </span><span class="n">none</span><span class="w"></span>
<span class="w">    </span><span class="n">integer</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">n</span><span class="w"></span>
<span class="w">    </span><span class="n">integer</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">parallel</span><span class="w"></span>
<span class="w">    </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">single</span><span class="w"></span>
<span class="w">        </span><span class="k">do</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"></span>
<span class="w">            </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">out</span><span class="o">:</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="w"></span>
<span class="w">                 </span><span class="n">call</span><span class="w"> </span><span class="n">set_an_element</span><span class="p">(</span><span class="n">v</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">task</span><span class="w"></span>
<span class="w">        </span><span class="n">enddo</span><span class="w"></span>

<span class="w">        </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">iterator</span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">in</span><span class="o">:</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">it</span><span class="p">))</span><span class="w"></span>
<span class="w">       </span><span class="o">!!</span><span class="n">$omp</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">in</span><span class="o">:</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="o">:</span><span class="n">n</span><span class="p">))</span><span class="w"> </span><span class="n">Violates</span><span class="w"> </span><span class="n">Array</span><span class="w"> </span><span class="n">section</span><span class="w"> </span><span class="n">restriction</span><span class="p">.</span><span class="w"></span>
<span class="w">            </span><span class="n">call</span><span class="w"> </span><span class="n">print_all_elements</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">task</span><span class="w"></span>

<span class="w">    </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">single</span><span class="w"></span>
<span class="w">    </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">parallel</span><span class="w"></span>
<span class="n">end</span><span class="w"> </span><span class="n">subroutine</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="dependence-for-undeferred-tasks">
<h2><span class="section-number">5.3.9. </span>Dependence for Undeferred Tasks<a class="headerlink" href="#dependence-for-undeferred-tasks" title="Permalink to this headline">#</a></h2>
<p>In the following example, we show that even if a task is undeferred as specified by an <strong>if</strong> clause that evaluates to  <em>false</em> , task dependences are still honored.</p>
<p>The <strong>depend</strong> clauses of the first and second explicit tasks specify that the first task is completed before the second task.</p>
<p>The second explicit task has an <strong>if</strong> clause that evaluates to  <em>false</em> . This means that the execution of the generating task (the implicit task of the <strong>single</strong> region) must be suspended until the second explicit task is completed. But, because of the dependence, the first explicit task must complete first, then the second explicit task can execute and complete, and only then  the generating task can resume to the print statement. Thus, the program will always print ” <strong>x = 2</strong> “.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//%compiler: clang</span>
<span class="c1">//%cflags: -fopenmp</span>

<span class="cm">/*</span>
<span class="cm">* name: task_dep.12</span>
<span class="cm">* type: C</span>
<span class="cm">* version: omp_4.0</span>
<span class="cm">*/</span><span class="w"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="cp">#pragma omp parallel</span>
<span class="w">  </span><span class="cp">#pragma omp single</span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="cm">/* first explicit task */</span><span class="w"></span>
<span class="w">    </span><span class="cp">#pragma omp task shared(x) depend(out: x)</span>
<span class="w">      </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="cm">/* second explicit task */</span><span class="w"></span>
<span class="w">    </span><span class="cp">#pragma omp task shared(x) depend(inout: x) if(0)</span>
<span class="w">      </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="cm">/* statement executed by parent implicit task</span>
<span class="cm">       prints: x = 2 */</span><span class="w"></span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;x = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="o">!!%</span><span class="n">compiler</span><span class="o">:</span><span class="w"> </span><span class="n">gfortran</span><span class="w"></span>
<span class="o">!!%</span><span class="n">cflags</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="n">fopenmp</span><span class="w"></span>

<span class="o">!</span><span class="w"> </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">task_dep</span><span class="mf">.12</span><span class="w"></span>
<span class="o">!</span><span class="w"> </span><span class="n">type</span><span class="o">:</span><span class="w"> </span><span class="n">F</span><span class="o">-</span><span class="n">free</span><span class="w"></span>
<span class="o">!</span><span class="w"> </span><span class="n">version</span><span class="o">:</span><span class="w"> </span><span class="n">omp_4</span><span class="mf">.0</span><span class="w"></span>
<span class="n">program</span><span class="w"> </span><span class="n">example</span><span class="w"></span>
<span class="w">   </span><span class="n">integer</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">x</span><span class="w"></span>
<span class="w">   </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">   </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">parallel</span><span class="w"></span>
<span class="w">   </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">single</span><span class="w"></span>
<span class="w">     </span><span class="o">!</span><span class="p">...</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="n">explicit</span><span class="w"> </span><span class="n">task</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">shared</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">out</span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">task</span><span class="w"></span>

<span class="w">     </span><span class="o">!</span><span class="p">...</span><span class="w"> </span><span class="n">second</span><span class="w"> </span><span class="n">explicit</span><span class="w"> </span><span class="n">task</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">shared</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">depend</span><span class="p">(</span><span class="n">inout</span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="p">(.</span><span class="nb">false</span><span class="p">.)</span><span class="w"></span>
<span class="w">         </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">      </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">task</span><span class="w"></span>

<span class="w">     </span><span class="o">!</span><span class="p">...</span><span class="w"> </span><span class="n">statement</span><span class="w"> </span><span class="n">executed</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">parent</span><span class="w"> </span><span class="n">implicit</span><span class="w"> </span><span class="n">task</span><span class="w"></span>
<span class="w">     </span><span class="o">!</span><span class="w"> </span><span class="n">prints</span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">      </span><span class="n">print</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;x = &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"></span>
<span class="w">   </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">single</span><span class="w"></span>
<span class="w">   </span><span class="o">!</span><span class="n">$omp</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">parallel</span><span class="w"></span>
<span class="n">end</span><span class="w"> </span><span class="n">program</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>In OpenMP 5.1 the <strong>omp_all_memory</strong>  <em>reserved locator</em>  was introduced to specify storage of all objects in memory. In the following example, it is used in Task 4 as a convenient way to specify that the locator (list item) denotes the storage of all objects (locations) in memory, and  will therefore match the  <em>a</em>  and  <em>d</em>  locators of Task 2, Task 3 and Task 6. The dependences guarantee the ordered execution of Tasks 2 and 3 before 4, and Task 4 before Task 6. Since there are no dependences imposed on Task 1 and Task 5, they can be scheduled to execute at any time, with no ordering.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">//%compiler: clang</span>
<span class="c1">//%cflags: -fopenmp</span>

<span class="cm">/*</span>
<span class="cm">* name:       task_dep.13</span>
<span class="cm">* type:       C</span>
<span class="cm">* version:    omp_5.1</span>
<span class="cm">*/</span><span class="w"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(){</span><span class="w"></span>
<span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="w"></span>

<span class="w">   </span><span class="cp">#pragma omp parallel masked num_threads(5)</span>
<span class="w">   </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="cp">#pragma omp task                               </span><span class="c1">// Task 1</span>
<span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;T1</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="cp">#pragma omp task depend(out: a)                </span><span class="c1">// Task 2</span>
<span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="n">a</span><span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;T2 a=%i</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">);</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="cp">#pragma omp task depend(out: d)                </span><span class="c1">// Task 3</span>
<span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="n">d</span><span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;T3 d=%i</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">);</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="cp">#pragma omp task depend(inout: omp_all_memory) </span><span class="c1">// Task 4</span>
<span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="n">a</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="n">d</span><span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;T4 a=%i d=%i</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w">   </span><span class="n">a</span><span class="p">,</span><span class="n">d</span><span class="p">);}</span><span class="w"></span>

<span class="w">      </span><span class="cp">#pragma omp task                               </span><span class="c1">// Task 5</span>
<span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;T5</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="cp">#pragma omp task depend(in: a,d)               </span><span class="c1">// Task 6</span>
<span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="n">a</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="n">d</span><span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;T6 a=%i d=%i</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="n">d</span><span class="p">);</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="cm">/* OUTPUT: ordered {T2,T3 any order}, {T4}, {T6}</span>
<span class="cm">    T2 a=2</span>
<span class="cm">    T3 d=2</span>
<span class="cm">    T4 a=3 d=3</span>
<span class="cm">    T6 a=4 d=4</span>

<span class="cm">  OUTPUT: unordered (can appear interspersed in ordered output)</span>
<span class="cm">    T1</span>
<span class="cm">    T5</span>
<span class="cm">*/</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>!!%compiler: gfortran
!!%cflags: -fopenmp

! name: task_dep.13
! type: F-free
! version: omp_5.1
program main
  integer :: a=1, d=1

  !$omp parallel masked  num_threads(5)

    !$omp task                                 !! Task 1
       write(*,&#39;(&quot;T1&quot;)&#39;)
    !$omp end task

    !$omp task depend(out: a)                  !! Task 2
       a=a+1
       write(*,&#39;(&quot;T2 a=&quot;,i1)&#39;) a
    !$omp end task

    !$omp task depend(out: d)                  !! Task 3
       d=d+1
       write(*,&#39;(&quot;T3 d=&quot;,i1)&#39;) d
    !$omp end task


    !$omp task depend(inout: omp_all_memory)   !! Task 4
       a=a+1; d=d+1
       write(*,&#39;(&quot;T4 a=&quot;,i1,&quot; d=&quot;,i1)&#39;) a, d
    !$omp end task

    !$omp task                                 !! Task 5
       write(*,&#39;(&quot;T5&quot;)&#39;)
    !$omp end task

    !$omp task depend(in: a,d)                 !! Task 6
       a=a+1; d=d+1
       write(*,&#39;(&quot;T6 a=&quot;,i1,&quot; d=&quot;,i1)&#39;) a, d
    !$omp end task

  !$omp end parallel masked

end program

! OUTPUT: ordered  {T2,T3 any order}, {T4}, {T6}
! T2 a=2
! T3 d=2
! T4 a=3 d=3
! T6 a=4 d=4
! OUTPUT: unordered (can appear interspersed in ordered output)
! T1
! T5
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "native"
        },
        kernelOptions: {
            kernelName: "native",
            path: "./contents/Chap_tasking"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'native'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="2_Task_Priority.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">5.2. </span>Task Priority</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="4_Task_Detachment.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">5.4. </span>Task Detachment</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The OpenMP Community<br/>
  
      &copy; <a href="../../copyright.html">Copyright</a> 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>