
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The task and taskwait Constructs &#8212; OpenMP Application Programming Interface Examples</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e7340bb3dbd8dde6db86f25597f54a1b.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Task Priority" href="Examples_task_priority.html" />
    <link rel="prev" title="Tasking" href="Chap_tasking.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">OpenMP Application Programming Interface Examples</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Welcome to OMP Jupyter Book
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="Foreword_Chapt.html">
   Foreword
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Introduction_Chapt.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Examples_Chapt.html">
   Examples
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="Chap_parallel_execution.html">
   Parallel Execution
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_ploop.html">
     A Simple Parallel Loop
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_parallel.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       parallel
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_host_teams.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       teams
      </span>
     </code>
     Construct on Host
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_nthrs_nesting.html">
     Controlling the Number of Threads on Multiple Nesting Levels
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_nthrs_dynamic.html">
     Interaction Between the
     <code class="docutils literal notranslate">
      <span class="pre">
       num_threads
      </span>
     </code>
     Clause and
     <code class="docutils literal notranslate">
      <span class="pre">
       omp_set_dynamic
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_fort_do.html">
     Fortran Restrictions on the
     <code class="docutils literal notranslate">
      <span class="pre">
       do
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_nowait.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       nowait
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_collapse.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       collapse
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_linear_in_loop.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       linear
      </span>
     </code>
     Clause in Loop Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_psections.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       parallel
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       sections
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_fpriv_sections.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       firstprivate
      </span>
     </code>
     Clause and the
     <code class="docutils literal notranslate">
      <span class="pre">
       sections
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_single.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       single
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_workshare.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       workshare
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_master.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       master
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_loop.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       loop
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_pra_iterator.html">
     Parallel Random Access Iterator Loop
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_set_dynamic_nthrs.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       omp_set_dynamic
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       omp_set_num_threads
      </span>
     </code>
     Routines
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_get_nthrs.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       omp_get_num_threads
      </span>
     </code>
     Routine
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="Chap_affinity.html">
   OpenMP Affinity
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_affinity.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       proc_bind
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_task_affinity.html">
     Task Affinity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_affinity_display.html">
     Affinity Display
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_affinity_query.html">
     Affinity Query Functions
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 current active collapsible-parent">
  <a class="reference internal" href="Chap_tasking.html">
   Tasking
  </a>
  <ul class="current collapse-ul">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       task
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       taskwait
      </span>
     </code>
     Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_task_priority.html">
     Task Priority
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_task_dep.html">
     Task Dependences
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_taskgroup.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       taskgroup
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_taskyield.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       taskyield
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_taskloop.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       taskloop
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_parallel_master_taskloop.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       parallel
      </span>
      <span class="pre">
       master
      </span>
      <span class="pre">
       taskloop
      </span>
     </code>
     Construct
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="Chap_devices.html">
   Devices
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_defaultmap.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       defaultmap
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_pointer_mapping.html">
     Pointer mapping
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_structure_mapping.html">
     Structure mapping
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_array_sections.html">
     Array Sections in Device Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_array_shaping.html">
     Array Shaping
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_mapper.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       declare
      </span>
      <span class="pre">
       mapper
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_data.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       data
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_unstructured_data.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       enter
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       data
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       exit
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       data
      </span>
     </code>
     Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_unstructured_data.html#simple-target-enter-data-and-target-exit-data-constructs">
     Simple target enter data and target exit data Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_update.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       update
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_declare_target.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       declare
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_teams.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       teams
      </span>
     </code>
     Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_async_target_depend.html">
     Asynchronous
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     Execution and Dependences
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_async_target_with_tasks.html">
     Asynchronous
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     with Tasks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_async_target_nowait.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       nowait
      </span>
     </code>
     Clause on
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_async_target_nowait_depend.html">
     Asynchronous
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     with
     <code class="docutils literal notranslate">
      <span class="pre">
       nowait
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       depend
      </span>
     </code>
     Clauses
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_device.html">
     Device Routines
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="Chap_SIMD.html">
   SIMD
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_SIMD.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       simd
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       declare
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       simd
      </span>
     </code>
     Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_SIMD.html#inbranch-and-notinbranch-clauses">
     <code class="docutils literal notranslate">
      <span class="pre">
       inbranch
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       notinbranch
      </span>
     </code>
     Clauses
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_SIMD.html#loop-carried-lexical-forward-dependence">
     Loop-Carried Lexical Forward Dependence
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_linear_modifier.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       ref
      </span>
     </code>
     ,
     <code class="docutils literal notranslate">
      <span class="pre">
       val
      </span>
     </code>
     ,
     <code class="docutils literal notranslate">
      <span class="pre">
       uval
      </span>
     </code>
     Modifiers for
     <code class="docutils literal notranslate">
      <span class="pre">
       linear
      </span>
     </code>
     Clause
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="Chap_synchronization.html">
   Synchronization
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_critical.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       critical
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_worksharing_critical.html">
     Worksharing Constructs Inside a
     <code class="docutils literal notranslate">
      <span class="pre">
       critical
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_barrier_regions.html">
     Binding of
     <code class="docutils literal notranslate">
      <span class="pre">
       barrier
      </span>
     </code>
     Regions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_atomic.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       atomic
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_atomic_restrict.html">
     Restrictions on the
     <code class="docutils literal notranslate">
      <span class="pre">
       atomic
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_flush_nolist.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       flush
      </span>
     </code>
     Construct without a List
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_acquire_release.html">
     Synchronization Based on Acquire/Release Semantics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_ordered.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       ordered
      </span>
     </code>
     Clause and the
     <code class="docutils literal notranslate">
      <span class="pre">
       ordered
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_depobj.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       depobj
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_doacross.html">
     Doacross Loop Nest
    </a>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="Examples_locks.html">
     Lock Routines
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="Examples_init_lock.html">
       The
       <code class="docutils literal notranslate">
        <span class="pre">
         omp_init_lock
        </span>
       </code>
       Routine
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Examples_init_lock_with_hint.html">
       The
       <code class="docutils literal notranslate">
        <span class="pre">
         omp_init_lock_with_hint
        </span>
       </code>
       Routine
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Examples_lock_owner.html">
       Ownership of Locks
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Examples_simple_lock.html">
       Simple Lock Routines
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Examples_nestable_lock.html">
       Nestable Lock Routines
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="Chap_data_environment.html">
   Data Environment
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_threadprivate.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       threadprivate
      </span>
     </code>
     Directive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_default_none.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       default(none)
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_private.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       private
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_fort_loopvar.html">
     Fortran Private Loop Iteration Variables
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_fort_sp_common.html">
     Fortran Restrictions on
     <code class="docutils literal notranslate">
      <span class="pre">
       shared
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       private
      </span>
     </code>
     Clauses with Common Blocks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_fort_sa_private.html">
     Fortran Restrictions on Storage Association with the
     <code class="docutils literal notranslate">
      <span class="pre">
       private
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_carrays_fpriv.html">
     C/C++ Arrays in a
     <code class="docutils literal notranslate">
      <span class="pre">
       firstprivate
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_lastprivate.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       lastprivate
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_reduction.html">
     Reduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_udr.html">
     User-Defined Reduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_scan.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       scan
      </span>
     </code>
     Directive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_copyin.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       copyin
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_copyprivate.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       copyprivate
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_cpp_reference.html">
     C++ Reference in Data-Sharing Clauses
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="Chap_memory_model.html">
   Memory Model
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_mem_model.html">
     The OpenMP Memory Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_allocators.html">
     Memory Allocators
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_fort_race.html">
     Race Conditions Caused by Implied Copies of Shared Variables in Fortran
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="Chap_program_control.html">
   Program Control
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_cond_comp.html">
     Conditional Compilation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_icv.html">
     Internal Control Variables (ICVs)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_cancellation.html">
     Cancellation Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_requires.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       requires
      </span>
     </code>
     Directive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_variant.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       declare
      </span>
     </code>
     ~
     <code class="docutils literal notranslate">
      <span class="pre">
       variant
      </span>
     </code>
     Directive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_metadirective.html">
     Metadirective Directive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_nested_loop.html">
     Nested Loop Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_nesting_restrict.html">
     Restrictions on Nesting of Regions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_offload.html">
     Target Offload
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="History.html">
   Document Revision History
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/contents/Examples_tasking.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/passlab/Examples"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/passlab/Examples/issues/new?title=Issue%20on%20page%20%2Fcontents/Examples_tasking.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/passlab/Examples/main?urlpath=lab/tree/notebook/contents/Examples_tasking.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="the-task-and-taskwait-constructs">
<h1>The  <code class="docutils literal notranslate"><span class="pre">task</span></code>  and  <code class="docutils literal notranslate"><span class="pre">taskwait</span></code>  Constructs<a class="headerlink" href="#the-task-and-taskwait-constructs" title="Permalink to this headline">Â¶</a></h1>
<p>The following example shows how to traverse a tree-like structure using explicit  tasks. Note that the  <code class="docutils literal notranslate"><span class="pre">traverse</span></code>  function should be called from within a  parallel region for the different specified tasks to be executed in parallel. Also  note that the tasks will be executed in no specified order because there are no  synchronization directives. Thus, assuming that the traversal will be done in post  order, as in the sequential , is wrong.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="cm">/*</span>
<span class="cm">* name: tasking.1c</span>
<span class="cm">* type: C</span>
<span class="cm">* version: omp_3.0</span>
<span class="cm">*/</span>

<span class="k">struct</span> <span class="nc">node</span> <span class="p">{</span>
  <span class="k">struct</span> <span class="nc">node</span> <span class="o">*</span><span class="n">left</span><span class="p">;</span>
  <span class="k">struct</span> <span class="nc">node</span> <span class="o">*</span><span class="n">right</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">process</span><span class="p">(</span><span class="k">struct</span> <span class="nc">node</span> <span class="o">*</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">traverse</span><span class="p">(</span> <span class="k">struct</span> <span class="nc">node</span> <span class="o">*</span><span class="n">p</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">)</span>
<span class="cp">#pragma omp task   </span><span class="c1">// p is firstprivate by default</span>
      <span class="n">traverse</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">right</span><span class="p">)</span>
<span class="cp">#pragma omp task    </span><span class="c1">// p is firstprivate by default</span>
      <span class="n">traverse</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">right</span><span class="p">);</span>
  <span class="n">process</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<span class="p">}</span>

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="o">!</span> <span class="nl">name</span><span class="p">:</span> <span class="n">tasking</span><span class="mf">.1f</span>
<span class="o">!</span> <span class="nl">type</span><span class="p">:</span> <span class="n">F</span><span class="o">-</span><span class="n">free</span>
<span class="o">!</span> <span class="nl">version</span><span class="p">:</span>    <span class="n">omp_3</span><span class="mf">.0</span>

       <span class="n">RECURSIVE</span> <span class="n">SUBROUTINE</span> <span class="n">traverse</span> <span class="p">(</span> <span class="n">P</span> <span class="p">)</span>
          <span class="n">TYPE</span> <span class="n">Node</span>
             <span class="n">TYPE</span><span class="p">(</span><span class="n">Node</span><span class="p">),</span> <span class="n">POINTER</span> <span class="o">::</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
          <span class="n">END</span> <span class="n">TYPE</span> <span class="n">Node</span>
          <span class="n">TYPE</span><span class="p">(</span><span class="n">Node</span><span class="p">)</span> <span class="o">::</span> <span class="n">P</span>

          <span class="n">IF</span> <span class="p">(</span><span class="n">associated</span><span class="p">(</span><span class="n">P</span><span class="o">%</span><span class="n">left</span><span class="p">))</span> <span class="n">THEN</span>
             <span class="o">!</span><span class="n">$OMP</span> <span class="n">TASK</span>     <span class="o">!</span> <span class="n">P</span> <span class="n">is</span> <span class="n">firstprivate</span> <span class="n">by</span> <span class="k">default</span>
                 <span class="n">CALL</span> <span class="n">traverse</span><span class="p">(</span><span class="n">P</span><span class="o">%</span><span class="n">left</span><span class="p">)</span>
             <span class="o">!</span><span class="n">$OMP</span> <span class="n">END</span> <span class="n">TASK</span>
          <span class="n">ENDIF</span>
          <span class="n">IF</span> <span class="p">(</span><span class="n">associated</span><span class="p">(</span><span class="n">P</span><span class="o">%</span><span class="n">right</span><span class="p">))</span> <span class="n">THEN</span>
             <span class="o">!</span><span class="n">$OMP</span> <span class="n">TASK</span>     <span class="o">!</span> <span class="n">P</span> <span class="n">is</span> <span class="n">firstprivate</span> <span class="n">by</span> <span class="k">default</span>
                 <span class="n">CALL</span> <span class="n">traverse</span><span class="p">(</span><span class="n">P</span><span class="o">%</span><span class="n">right</span><span class="p">)</span>
             <span class="o">!</span><span class="n">$OMP</span> <span class="n">END</span> <span class="n">TASK</span>
          <span class="n">ENDIF</span>
          <span class="n">CALL</span> <span class="n">process</span> <span class="p">(</span> <span class="n">P</span> <span class="p">)</span>

       <span class="n">END</span> <span class="n">SUBROUTINE</span>

</pre></div>
</div>
</div>
</div>
<p>In the next example, we force a postorder traversal of the tree by adding a  <code class="docutils literal notranslate"><span class="pre">taskwait</span></code>   directive. Now, we can safely assume that the left and right sons have been executed  before we process the current node.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="cm">/*</span>
<span class="cm">* name: tasking.2c</span>
<span class="cm">* type: C</span>
<span class="cm">* version: omp_3.0</span>
<span class="cm">*/</span>
<span class="k">struct</span> <span class="nc">node</span> <span class="p">{</span>
  <span class="k">struct</span> <span class="nc">node</span> <span class="o">*</span><span class="n">left</span><span class="p">;</span>
  <span class="k">struct</span> <span class="nc">node</span> <span class="o">*</span><span class="n">right</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">process</span><span class="p">(</span><span class="k">struct</span> <span class="nc">node</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">postorder_traverse</span><span class="p">(</span> <span class="k">struct</span> <span class="nc">node</span> <span class="o">*</span><span class="n">p</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">)</span>
       <span class="cp">#pragma omp task    </span><span class="c1">// p is firstprivate by default</span>
           <span class="n">postorder_traverse</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">right</span><span class="p">)</span>
       <span class="cp">#pragma omp task   </span><span class="c1">// p is firstprivate by default</span>
           <span class="n">postorder_traverse</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">right</span><span class="p">);</span>
    <span class="cp">#pragma omp taskwait</span>
    <span class="n">process</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<span class="p">}</span>

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="o">!</span> <span class="nl">name</span><span class="p">:</span> <span class="n">tasking</span><span class="mf">.2f</span>
<span class="o">!</span> <span class="nl">type</span><span class="p">:</span> <span class="n">F</span><span class="o">-</span><span class="n">free</span>
<span class="o">!</span> <span class="nl">version</span><span class="p">:</span>    <span class="n">omp_3</span><span class="mf">.0</span>
      <span class="n">RECURSIVE</span> <span class="n">SUBROUTINE</span> <span class="n">traverse</span> <span class="p">(</span> <span class="n">P</span> <span class="p">)</span>
         <span class="n">TYPE</span> <span class="n">Node</span>
             <span class="n">TYPE</span><span class="p">(</span><span class="n">Node</span><span class="p">),</span> <span class="n">POINTER</span> <span class="o">::</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
         <span class="n">END</span> <span class="n">TYPE</span> <span class="n">Node</span>
         <span class="n">TYPE</span><span class="p">(</span><span class="n">Node</span><span class="p">)</span> <span class="o">::</span> <span class="n">P</span>
         <span class="n">IF</span> <span class="p">(</span><span class="n">associated</span><span class="p">(</span><span class="n">P</span><span class="o">%</span><span class="n">left</span><span class="p">))</span> <span class="n">THEN</span>
             <span class="o">!</span><span class="n">$OMP</span> <span class="n">TASK</span>    <span class="o">!</span> <span class="n">P</span> <span class="n">is</span> <span class="n">firstprivate</span> <span class="n">by</span> <span class="k">default</span>
                 <span class="n">CALL</span> <span class="n">traverse</span><span class="p">(</span><span class="n">P</span><span class="o">%</span><span class="n">left</span><span class="p">)</span>
             <span class="o">!</span><span class="n">$OMP</span> <span class="n">END</span> <span class="n">TASK</span>
         <span class="n">ENDIF</span>
         <span class="n">IF</span> <span class="p">(</span><span class="n">associated</span><span class="p">(</span><span class="n">P</span><span class="o">%</span><span class="n">right</span><span class="p">))</span> <span class="n">THEN</span>
             <span class="o">!</span><span class="n">$OMP</span> <span class="n">TASK</span>    <span class="o">!</span> <span class="n">P</span> <span class="n">is</span> <span class="n">firstprivate</span> <span class="n">by</span> <span class="k">default</span>
                 <span class="n">CALL</span> <span class="n">traverse</span><span class="p">(</span><span class="n">P</span><span class="o">%</span><span class="n">right</span><span class="p">)</span>
             <span class="o">!</span><span class="n">$OMP</span> <span class="n">END</span> <span class="n">TASK</span>
         <span class="n">ENDIF</span>
         <span class="o">!</span><span class="n">$OMP</span> <span class="n">TASKWAIT</span>
         <span class="n">CALL</span> <span class="n">process</span> <span class="p">(</span> <span class="n">P</span> <span class="p">)</span>
      <span class="n">END</span> <span class="n">SUBROUTINE</span>

</pre></div>
</div>
</div>
</div>
<p>The following example demonstrates how to use the  <code class="docutils literal notranslate"><span class="pre">task</span></code>  construct to process  elements of a linked list in parallel. The thread executing the  <code class="docutils literal notranslate"><span class="pre">single</span></code>   region generates all of the explicit tasks, which are then executed by the threads  in the current team. The pointer  <em>p</em>  is  <code class="docutils literal notranslate"><span class="pre">firstprivate</span></code>  by default  on the  <code class="docutils literal notranslate"><span class="pre">task</span></code>  construct so it is not necessary to specify it in a  <code class="docutils literal notranslate"><span class="pre">firstprivate</span></code>   clause.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="cm">/*</span>
<span class="cm">* name: tasking.3c</span>
<span class="cm">* type: C</span>
<span class="cm">* version: omp_3.0</span>
<span class="cm">*/</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">node</span> <span class="n">node</span><span class="p">;</span>
<span class="k">struct</span> <span class="nc">node</span> <span class="p">{</span>
      <span class="kt">int</span> <span class="n">data</span><span class="p">;</span>
      <span class="n">node</span> <span class="o">*</span> <span class="n">next</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="nf">process</span><span class="p">(</span><span class="n">node</span> <span class="o">*</span> <span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
    <span class="cm">/* do work here */</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">increment_list_items</span><span class="p">(</span><span class="n">node</span> <span class="o">*</span> <span class="n">head</span><span class="p">)</span>
<span class="p">{</span>
    <span class="cp">#pragma omp parallel</span>
    <span class="p">{</span>
        <span class="cp">#pragma omp single</span>
            <span class="p">{</span>
               <span class="n">node</span> <span class="o">*</span> <span class="n">p</span> <span class="o">=</span> <span class="n">head</span><span class="p">;</span>
               <span class="k">while</span> <span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="p">{</span>
                    <span class="cp">#pragma omp task</span>
                     <span class="c1">// p is firstprivate by default</span>
                           <span class="n">process</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
                     <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
                  <span class="p">}</span>
            <span class="p">}</span>
     <span class="p">}</span>
<span class="p">}</span>

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="o">!</span> <span class="nl">name</span><span class="p">:</span> <span class="n">tasking</span><span class="mf">.3f</span>
<span class="o">!</span> <span class="nl">type</span><span class="p">:</span> <span class="n">F</span><span class="o">-</span><span class="n">free</span>
<span class="o">!</span> <span class="nl">version</span><span class="p">:</span>    <span class="n">omp_3</span><span class="mf">.0</span>

      <span class="n">MODULE</span> <span class="n">LIST</span>
          <span class="n">TYPE</span> <span class="n">NODE</span>
             <span class="n">INTEGER</span> <span class="o">::</span> <span class="n">PAYLOAD</span>
             <span class="n">TYPE</span> <span class="p">(</span><span class="n">NODE</span><span class="p">),</span> <span class="n">POINTER</span> <span class="o">::</span> <span class="n">NEXT</span>
          <span class="n">END</span> <span class="n">TYPE</span> <span class="n">NODE</span>
      <span class="n">CONTAINS</span>

          <span class="n">SUBROUTINE</span> <span class="n">PROCESS</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
             <span class="n">TYPE</span> <span class="p">(</span><span class="n">NODE</span><span class="p">),</span> <span class="n">POINTER</span> <span class="o">::</span> <span class="n">P</span>
                 <span class="o">!</span> <span class="k">do</span> <span class="n">work</span> <span class="n">here</span>
          <span class="n">END</span> <span class="n">SUBROUTINE</span>

          <span class="n">SUBROUTINE</span> <span class="n">INCREMENT_LIST_ITEMS</span> <span class="p">(</span><span class="n">HEAD</span><span class="p">)</span>

             <span class="n">TYPE</span> <span class="p">(</span><span class="n">NODE</span><span class="p">),</span> <span class="n">POINTER</span> <span class="o">::</span> <span class="n">HEAD</span>
             <span class="n">TYPE</span> <span class="p">(</span><span class="n">NODE</span><span class="p">),</span> <span class="n">POINTER</span> <span class="o">::</span> <span class="n">P</span>
             <span class="o">!</span><span class="n">$OMP</span> <span class="n">PARALLEL</span> <span class="n">PRIVATE</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
                 <span class="o">!</span><span class="n">$OMP</span> <span class="n">SINGLE</span>
                     <span class="n">P</span> <span class="o">=&gt;</span> <span class="n">HEAD</span>
                     <span class="n">DO</span>
                        <span class="o">!</span><span class="n">$OMP</span> <span class="n">TASK</span>
                            <span class="o">!</span> <span class="n">P</span> <span class="n">is</span> <span class="n">firstprivate</span> <span class="n">by</span> <span class="k">default</span>
                            <span class="n">CALL</span> <span class="n">PROCESS</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
                        <span class="o">!</span><span class="n">$OMP</span> <span class="n">END</span> <span class="n">TASK</span>
                        <span class="n">P</span> <span class="o">=&gt;</span> <span class="n">P</span><span class="o">%</span><span class="n">NEXT</span>
                        <span class="n">IF</span> <span class="p">(</span> <span class="p">.</span><span class="n">NOT</span><span class="p">.</span> <span class="n">ASSOCIATED</span> <span class="p">(</span><span class="n">P</span><span class="p">)</span> <span class="p">)</span> <span class="n">EXIT</span>
                     <span class="n">END</span> <span class="n">DO</span>
                 <span class="o">!</span><span class="n">$OMP</span> <span class="n">END</span> <span class="n">SINGLE</span>
             <span class="o">!</span><span class="n">$OMP</span> <span class="n">END</span> <span class="n">PARALLEL</span>

          <span class="n">END</span> <span class="n">SUBROUTINE</span>

      <span class="n">END</span> <span class="n">MODULE</span>

</pre></div>
</div>
</div>
</div>
<p>The  <code class="docutils literal notranslate"><span class="pre">fib()</span></code>  function should be called from within a  <code class="docutils literal notranslate"><span class="pre">parallel</span></code>   region  for the different specified tasks to be executed in parallel. Also, only one thread  of the  <code class="docutils literal notranslate"><span class="pre">parallel</span></code>  region should call  <code class="docutils literal notranslate"><span class="pre">fib()</span></code>  unless multiple concurrent  Fibonacci computations are desired.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="cm">/*</span>
<span class="cm">* name: tasking.4c</span>
<span class="cm">* type: C</span>
<span class="cm">* version: omp_3.0</span>
<span class="cm">*/</span>
     <span class="kt">int</span> <span class="nf">fib</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">)</span>
          <span class="k">return</span> <span class="n">n</span><span class="p">;</span>
        <span class="k">else</span> <span class="p">{</span>
           <span class="cp">#pragma omp task shared(i)</span>
              <span class="n">i</span><span class="o">=</span><span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="mi">-1</span><span class="p">);</span>
           <span class="cp">#pragma omp task shared(j)</span>
              <span class="n">j</span><span class="o">=</span><span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="mi">-2</span><span class="p">);</span>
           <span class="cp">#pragma omp taskwait</span>
              <span class="k">return</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="p">;</span>
        <span class="p">}</span>
     <span class="p">}</span>

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="o">!</span> <span class="nl">name</span><span class="p">:</span> <span class="n">tasking</span><span class="mf">.4f</span>
<span class="o">!</span> <span class="nl">type</span><span class="p">:</span> <span class="n">F</span><span class="o">-</span><span class="n">fixed</span>
<span class="o">!</span> <span class="nl">version</span><span class="p">:</span> <span class="n">omp_3</span><span class="mf">.0</span>
      <span class="n">RECURSIVE</span> <span class="n">INTEGER</span> <span class="n">FUNCTION</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="n">RESULT</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
      <span class="n">INTEGER</span> <span class="n">n</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span>
      <span class="n">IF</span> <span class="p">(</span> <span class="n">n</span> <span class="p">.</span><span class="n">LT</span><span class="p">.</span> <span class="mi">2</span><span class="p">)</span> <span class="n">THEN</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">n</span>
      <span class="n">ELSE</span>
<span class="o">!</span><span class="n">$OMP</span> <span class="n">TASK</span> <span class="n">SHARED</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">fib</span><span class="p">(</span> <span class="n">n</span><span class="mi">-1</span> <span class="p">)</span>
<span class="o">!</span><span class="n">$OMP</span> <span class="n">END</span> <span class="n">TASK</span>
<span class="o">!</span><span class="n">$OMP</span> <span class="n">TASK</span> <span class="n">SHARED</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">fib</span><span class="p">(</span> <span class="n">n</span><span class="mi">-2</span> <span class="p">)</span>
<span class="o">!</span><span class="n">$OMP</span> <span class="n">END</span> <span class="n">TASK</span>
<span class="o">!</span><span class="n">$OMP</span> <span class="n">TASKWAIT</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span>
      <span class="n">END</span> <span class="n">IF</span>
      <span class="n">END</span> <span class="n">FUNCTION</span>

</pre></div>
</div>
</div>
</div>
<p>Note: There are more efficient algorithms for computing Fibonacci numbers. This  classic recursion algorithm is for illustrative purposes.</p>
<p>The following example demonstrates a way to generate a large number of tasks with  one thread and execute them with the threads in the team. While generating these  tasks, the implementation may reach its limit on unassigned tasks.  If it does,  the implementation is allowed to cause the thread executing the task generating  loop to suspend its task at the task scheduling point in the  <code class="docutils literal notranslate"><span class="pre">task</span></code>  directive,  and start executing unassigned tasks.  Once the number of unassigned tasks is sufficiently  low, the thread may resume execution of the task generating loop.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="cm">/*</span>
<span class="cm">* name: tasking.5c</span>
<span class="cm">* type: C</span>
<span class="cm">* version: omp_3.0</span>
<span class="cm">*/</span>
<span class="cp">#define LARGE_NUMBER 10000000</span>
<span class="kt">double</span> <span class="n">item</span><span class="p">[</span><span class="n">LARGE_NUMBER</span><span class="p">];</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">process</span><span class="p">(</span><span class="kt">double</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="cp">#pragma omp parallel</span>
  <span class="p">{</span>
    <span class="cp">#pragma omp single</span>
    <span class="p">{</span>
      <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">LARGE_NUMBER</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
             <span class="cp">#pragma omp task    </span><span class="c1">// i is firstprivate, item is shared</span>
                  <span class="n">process</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="o">!</span> <span class="nl">name</span><span class="p">:</span> <span class="n">tasking</span><span class="mf">.5f</span>
<span class="o">!</span> <span class="nl">type</span><span class="p">:</span> <span class="n">F</span><span class="o">-</span><span class="n">fixed</span>
<span class="o">!</span> <span class="nl">version</span><span class="p">:</span> <span class="n">omp_3</span><span class="mf">.0</span>
       <span class="n">real</span><span class="o">*</span><span class="mi">8</span> <span class="n">item</span><span class="p">(</span><span class="mi">10000000</span><span class="p">)</span>
       <span class="n">integer</span> <span class="n">i</span>

<span class="o">!</span><span class="n">$omp</span> <span class="n">parallel</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">single</span> <span class="o">!</span> <span class="n">loop</span> <span class="n">iteration</span> <span class="n">variable</span> <span class="n">i</span> <span class="n">is</span> <span class="n">private</span>
       <span class="k">do</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">10000000</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">task</span>
         <span class="o">!</span> <span class="n">i</span> <span class="n">is</span> <span class="n">firstprivate</span><span class="p">,</span> <span class="n">item</span> <span class="n">is</span> <span class="n">shared</span>
          <span class="n">call</span> <span class="n">process</span><span class="p">(</span><span class="n">item</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">task</span>
       <span class="n">end</span> <span class="k">do</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">single</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">parallel</span>

       <span class="n">end</span>

</pre></div>
</div>
</div>
</div>
<p>The following example is the same as the previous one, except that the tasks are  generated in an untied task. While generating the tasks, the implementation may  reach its limit on unassigned tasks. If it does, the implementation is allowed  to cause the thread executing the task generating loop to suspend its task at the  task scheduling point in the  <code class="docutils literal notranslate"><span class="pre">task</span></code>  directive, and start executing unassigned  tasks.  If that thread begins execution of a task that takes a long time to complete,  the other threads may complete all the other tasks before it is finished.</p>
<p>In this case, since the loop is in an untied task, any other thread is eligible  to resume the task generating loop. In the previous examples, the other threads  would be forced to idle until the generating thread finishes its long task, since  the task generating loop was in a tied task.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="cm">/*</span>
<span class="cm">* name: tasking.6c</span>
<span class="cm">* type: C</span>
<span class="cm">* version: omp_3.0</span>
<span class="cm">*/</span>
<span class="cp">#define LARGE_NUMBER 10000000</span>
<span class="kt">double</span> <span class="n">item</span><span class="p">[</span><span class="n">LARGE_NUMBER</span><span class="p">];</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">process</span><span class="p">(</span><span class="kt">double</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
<span class="cp">#pragma omp parallel</span>
  <span class="p">{</span>
    <span class="cp">#pragma omp single</span>
    <span class="p">{</span>
      <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
      <span class="cp">#pragma omp task untied</span>
      <span class="c1">// i is firstprivate, item is shared</span>
      <span class="p">{</span>
         <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">LARGE_NUMBER</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
             <span class="cp">#pragma omp task</span>
                  <span class="n">process</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="o">!</span> <span class="nl">name</span><span class="p">:</span> <span class="n">tasking</span><span class="mf">.6f</span>
<span class="o">!</span> <span class="nl">type</span><span class="p">:</span> <span class="n">F</span><span class="o">-</span><span class="n">fixed</span>
<span class="o">!</span> <span class="nl">version</span><span class="p">:</span> <span class="n">omp_3</span><span class="mf">.0</span>
       <span class="n">real</span><span class="o">*</span><span class="mi">8</span> <span class="n">item</span><span class="p">(</span><span class="mi">10000000</span><span class="p">)</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">parallel</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">single</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">task</span> <span class="n">untied</span>
       <span class="o">!</span> <span class="n">loop</span> <span class="n">iteration</span> <span class="n">variable</span> <span class="n">i</span> <span class="n">is</span> <span class="n">private</span>
       <span class="k">do</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">10000000</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">task</span> <span class="o">!</span> <span class="n">i</span> <span class="n">is</span> <span class="n">firstprivate</span><span class="p">,</span> <span class="n">item</span> <span class="n">is</span> <span class="n">shared</span>
          <span class="n">call</span> <span class="n">process</span><span class="p">(</span><span class="n">item</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">task</span>
       <span class="n">end</span> <span class="k">do</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">task</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">single</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">parallel</span>
       <span class="n">end</span>

</pre></div>
</div>
</div>
</div>
<p>The following two examples demonstrate how the scheduling rules illustrated in  Section 2.11.3 of the OpenMP 4.0 specification affect the usage of   <code class="docutils literal notranslate"><span class="pre">threadprivate</span></code>  variables in tasks. A  <code class="docutils literal notranslate"><span class="pre">threadprivate</span></code>   variable can be modified by another task that is executed by the same thread. Thus,  the value of a  <code class="docutils literal notranslate"><span class="pre">threadprivate</span></code>  variable cannot be assumed to be unchanged  across a task scheduling point. In untied tasks, task scheduling points may be  added in any place by the implementation.</p>
<p>A task switch may occur at a task scheduling point. A single thread may execute  both of the task regions that modify  <code class="docutils literal notranslate"><span class="pre">tp</span></code> . The parts of these task regions  in which  <code class="docutils literal notranslate"><span class="pre">tp</span></code>  is modified may be executed in any order so the resulting  value of  <code class="docutils literal notranslate"><span class="pre">var</span></code>  can be either 1 or 2.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="cm">/*</span>
<span class="cm">* name: tasking.7c</span>
<span class="cm">* type: C</span>
<span class="cm">* version: omp_3.0</span>
<span class="cm">*/</span>

<span class="kt">int</span> <span class="n">tp</span><span class="p">;</span>
<span class="cp">#pragma omp threadprivate(tp)</span>
<span class="kt">int</span> <span class="n">var</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">work</span><span class="p">()</span>
<span class="p">{</span>
<span class="cp">#pragma omp task</span>
    <span class="p">{</span>
        <span class="cm">/* do work here */</span>
<span class="cp">#pragma omp task</span>
        <span class="p">{</span>
            <span class="n">tp</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="cm">/* do work here */</span>
<span class="cp">#pragma omp task</span>
            <span class="p">{</span>
                <span class="cm">/* no modification of tp */</span>
            <span class="p">}</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">tp</span><span class="p">;</span> <span class="c1">//value of tp can be 1 or 2</span>
        <span class="p">}</span>
        <span class="n">tp</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="o">!</span> <span class="nl">name</span><span class="p">:</span> <span class="n">tasking</span><span class="mf">.7f</span>
<span class="o">!</span> <span class="nl">type</span><span class="p">:</span> <span class="n">F</span><span class="o">-</span><span class="n">fixed</span>
<span class="o">!</span> <span class="nl">version</span><span class="p">:</span> <span class="n">omp_3</span><span class="mf">.0</span>
      <span class="n">module</span> <span class="n">example</span>
      <span class="n">integer</span> <span class="n">tp</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">threadprivate</span><span class="p">(</span><span class="n">tp</span><span class="p">)</span>
      <span class="n">integer</span> <span class="n">var</span>
      <span class="n">contains</span>
      <span class="n">subroutine</span> <span class="n">work</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">task</span>
         <span class="o">!</span> <span class="k">do</span> <span class="n">work</span> <span class="n">here</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">task</span>
         <span class="n">tp</span> <span class="o">=</span> <span class="mi">1</span>
         <span class="o">!</span> <span class="k">do</span> <span class="n">work</span> <span class="n">here</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">task</span>
           <span class="o">!</span> <span class="n">no</span> <span class="n">modification</span> <span class="n">of</span> <span class="n">tp</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">task</span>
         <span class="n">var</span> <span class="o">=</span> <span class="n">tp</span>    <span class="o">!</span> <span class="n">value</span> <span class="n">of</span> <span class="n">var</span> <span class="n">can</span> <span class="n">be</span> <span class="mi">1</span> <span class="n">or</span> <span class="mi">2</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">task</span>
        <span class="n">tp</span> <span class="o">=</span> <span class="mi">2</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">task</span>
      <span class="n">end</span> <span class="n">subroutine</span>
      <span class="n">end</span> <span class="n">module</span>

</pre></div>
</div>
</div>
</div>
<p>In this example, scheduling constraints prohibit a thread in the team from executing  a new task that modifies  <code class="docutils literal notranslate"><span class="pre">tp</span></code>   while another such task region tied to the  same thread is suspended. Therefore, the value written will persist across the  task scheduling point.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="cm">/*</span>
<span class="cm">* name: tasking.8c</span>
<span class="cm">* type: C</span>
<span class="cm">* version: omp_3.0</span>
<span class="cm">*/</span>

<span class="kt">int</span> <span class="n">tp</span><span class="p">;</span>
<span class="cp">#pragma omp threadprivate(tp)</span>
<span class="kt">int</span> <span class="n">var</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">work</span><span class="p">()</span>
<span class="p">{</span>
<span class="cp">#pragma omp parallel</span>
    <span class="p">{</span>
        <span class="cm">/* do work here */</span>
<span class="cp">#pragma omp task</span>
        <span class="p">{</span>
            <span class="n">tp</span><span class="o">++</span><span class="p">;</span>
            <span class="cm">/* do work here */</span>
<span class="cp">#pragma omp task</span>
            <span class="p">{</span>
                <span class="cm">/* do work here but don&#39;t modify tp */</span>
            <span class="p">}</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">tp</span><span class="p">;</span> <span class="c1">//Value does not change after write above</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
! name: tasking.8f
! type: F-fixed
! version: omp_3.0
      module example
      integer tp
!$omp threadprivate(tp)
      integer var
      contains
      subroutine work
!$omp parallel
         ! do work here
!$omp task
         tp = tp + 1
         ! do work here
!$omp task
           ! do work here but don&#39;t modify tp
!$omp end task
         var = tp    ! value does not change after write above
!$omp end task
!$omp end parallel
      end subroutine
      end module

</pre></div>
</div>
</div>
</div>
<p>The following two examples demonstrate how the scheduling rules illustrated in  Section 2.11.3 of the OpenMP 4.0 specification affect the usage of locks  and critical sections in tasks.  If a lock is held  across a task scheduling point, no attempt should be made to acquire the same lock  in any  that may be interleaved.  Otherwise, a deadlock is possible.</p>
<p>In the example below, suppose the thread executing task 1 defers task 2.  When  it encounters the task scheduling point at task 3, it could suspend task 1 and  begin task 2 which will result in a deadlock when it tries to enter critical region  1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="cm">/*</span>
<span class="cm">* name: tasking.9c</span>
<span class="cm">* type: C</span>
<span class="cm">* version: omp_3.0</span>
<span class="cm">*/</span>
<span class="kt">void</span> <span class="nf">work</span><span class="p">()</span>
<span class="p">{</span>
   <span class="cp">#pragma omp task</span>
   <span class="p">{</span> <span class="c1">//Task 1</span>
       <span class="cp">#pragma omp task</span>
       <span class="p">{</span> <span class="c1">//Task 2</span>
            <span class="cp">#pragma omp critical </span><span class="c1">//Critical region 1</span>
            <span class="p">{</span><span class="cm">/*do work here */</span> <span class="p">}</span>
       <span class="p">}</span>
       <span class="cp">#pragma omp critical </span><span class="c1">//Critical Region 2</span>
       <span class="p">{</span>
           <span class="c1">//Capture data for the following task</span>
           <span class="cp">#pragma omp task</span>
           <span class="p">{</span> <span class="cm">/* do work here */</span> <span class="p">}</span> <span class="c1">//Task 3</span>
       <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="o">!</span> <span class="nl">name</span><span class="p">:</span> <span class="n">tasking</span><span class="mf">.9f</span>
<span class="o">!</span> <span class="nl">type</span><span class="p">:</span> <span class="n">F</span><span class="o">-</span><span class="n">fixed</span>
<span class="o">!</span> <span class="nl">version</span><span class="p">:</span> <span class="n">omp_3</span><span class="mf">.0</span>
       <span class="n">module</span> <span class="n">example</span>
       <span class="n">contains</span>
       <span class="n">subroutine</span> <span class="n">work</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">task</span>
       <span class="o">!</span> <span class="n">Task</span> <span class="mi">1</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">task</span>
       <span class="o">!</span> <span class="n">Task</span> <span class="mi">2</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">critical</span>
       <span class="o">!</span> <span class="n">Critical</span> <span class="n">region</span> <span class="mi">1</span>
       <span class="o">!</span> <span class="k">do</span> <span class="n">work</span> <span class="n">here</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">critical</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">task</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">critical</span>
       <span class="o">!</span> <span class="n">Critical</span> <span class="n">region</span> <span class="mi">2</span>
       <span class="o">!</span> <span class="n">Capture</span> <span class="n">data</span> <span class="k">for</span> <span class="n">the</span> <span class="n">following</span> <span class="n">task</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">task</span>
       <span class="o">!</span><span class="n">Task</span> <span class="mi">3</span>
       <span class="o">!</span> <span class="k">do</span> <span class="n">work</span> <span class="n">here</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">task</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">critical</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">task</span>
      <span class="n">end</span> <span class="n">subroutine</span>
      <span class="n">end</span> <span class="n">module</span>

</pre></div>
</div>
</div>
</div>
<p>In the following example,  <code class="docutils literal notranslate"><span class="pre">lock</span></code>  is held across a task scheduling point.   However, according to the scheduling restrictions, the executing thread canât  begin executing one of the non-descendant tasks that also acquires  <code class="docutils literal notranslate"><span class="pre">lock</span></code>  before  the task region is complete.  Therefore, no deadlock is possible.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="cm">/*</span>
<span class="cm">* name: tasking.10c</span>
<span class="cm">* type: C</span>
<span class="cm">* version: omp_3.0</span>
<span class="cm">*/</span>
<span class="cp">#include</span> <span class="cpf">&lt;omp.h&gt;</span><span class="cp"></span>
<span class="kt">void</span> <span class="nf">work</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">omp_lock_t</span> <span class="n">lock</span><span class="p">;</span>
    <span class="n">omp_init_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock</span><span class="p">);</span>
<span class="cp">#pragma omp parallel</span>
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<span class="cp">#pragma omp for</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<span class="cp">#pragma omp task</span>
            <span class="p">{</span>
 <span class="c1">// lock is shared by default in the task</span>
 <span class="n">omp_set_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock</span><span class="p">);</span>
                <span class="c1">// Capture data for the following task</span>
<span class="cp">#pragma omp task</span>
 <span class="c1">// Task Scheduling Point 1</span>
                <span class="p">{</span> <span class="cm">/* do work here */</span> <span class="p">}</span>
                <span class="n">omp_unset_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">omp_destroy_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock</span><span class="p">);</span>
<span class="p">}</span>

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
! name: tasking.10f
! type: F-free
! version:    omp_3.0
      module example
      include &#39;omp_lib.h&#39;
      integer (kind=omp_lock_kind) lock
      integer i

      contains

      subroutine work
      call omp_init_lock(lock)
!$omp parallel
     !$omp do
      do i=1,100
         !$omp task
              ! Outer task
              call omp_set_lock(lock)    ! lock is shared by
                                         ! default in the task
                     ! Capture data for the following task
                     !$omp task     ! Task Scheduling Point 1
                              ! do work here
                     !$omp end task
               call omp_unset_lock(lock)
         !$omp end task
      end do
!$omp end parallel
      call omp_destroy_lock(lock)
      end subroutine

      end module

</pre></div>
</div>
</div>
</div>
<p>The following examples illustrate the use of the  <code class="docutils literal notranslate"><span class="pre">mergeable</span></code>  clause in the   <code class="docutils literal notranslate"><span class="pre">task</span></code>  construct. In this first example, the  <code class="docutils literal notranslate"><span class="pre">task</span></code>  construct has  been annotated with the  <code class="docutils literal notranslate"><span class="pre">mergeable</span></code>   clause. The addition of this clause  allows the implementation to reuse the data environment (including the ICVs) of  the parent task for the task inside  <code class="docutils literal notranslate"><span class="pre">foo</span></code>  if the task is included or undeferred.  Thus, the result of the execution may differ depending on whether the task is merged  or not. Therefore the mergeable clause needs to be used with caution. In this example,  the use of the mergeable clause is safe. As  <code class="docutils literal notranslate"><span class="pre">x</span></code>  is a shared variable the  outcome does not depend on whether or not the task is merged (that is, the task  will always increment the same variable and will always compute the same value  for  <code class="docutils literal notranslate"><span class="pre">x</span></code> ).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="cm">/*</span>
<span class="cm">* name: tasking.11c</span>
<span class="cm">* type: C</span>
<span class="cm">* version: omp_3.1</span>
<span class="cm">*/</span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="kt">void</span> <span class="nf">foo</span> <span class="p">(</span> <span class="p">)</span>
<span class="p">{</span>
   <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
   <span class="cp">#pragma omp task shared(x) mergeable</span>
   <span class="p">{</span>
      <span class="n">x</span><span class="o">++</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="cp">#pragma omp taskwait</span>
   <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>  <span class="c1">// prints 3</span>
<span class="p">}</span>

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="o">!</span> <span class="nl">name</span><span class="p">:</span> <span class="n">tasking</span><span class="mf">.11f</span>
<span class="o">!</span> <span class="nl">type</span><span class="p">:</span> <span class="n">F</span><span class="o">-</span><span class="n">free</span>
<span class="o">!</span> <span class="nl">version</span><span class="p">:</span>    <span class="n">omp_3</span><span class="mf">.1</span>
<span class="n">subroutine</span> <span class="n">foo</span><span class="p">()</span>
  <span class="n">integer</span> <span class="o">::</span> <span class="n">x</span>
  <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">task</span> <span class="n">shared</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">mergeable</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">task</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">taskwait</span>
  <span class="n">print</span> <span class="o">*</span><span class="p">,</span> <span class="n">x</span>     <span class="o">!</span> <span class="n">prints</span> <span class="mi">3</span>
<span class="n">end</span> <span class="n">subroutine</span>

</pre></div>
</div>
</div>
</div>
<p>This second example shows an incorrect use of the  <code class="docutils literal notranslate"><span class="pre">mergeable</span></code>  clause. In  this example, the created task will access different instances of the variable   <code class="docutils literal notranslate"><span class="pre">x</span></code>  if the task is not merged, as  <code class="docutils literal notranslate"><span class="pre">x</span></code>  is  <code class="docutils literal notranslate"><span class="pre">firstprivate</span></code> , but  it will access the same variable  <code class="docutils literal notranslate"><span class="pre">x</span></code>  if the task is merged. As a result,  the behavior of the program is unspecified and it can print two different values  for  <code class="docutils literal notranslate"><span class="pre">x</span></code>  depending on the decisions taken by the implementation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="cm">/*</span>
<span class="cm">* name: tasking.12c</span>
<span class="cm">* type: C</span>
<span class="cm">* version: omp_3.1</span>
<span class="cm">*/</span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="kt">void</span> <span class="nf">foo</span> <span class="p">(</span> <span class="p">)</span>
<span class="p">{</span>
   <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
   <span class="cp">#pragma omp task mergeable</span>
   <span class="p">{</span>
      <span class="n">x</span><span class="o">++</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="cp">#pragma omp taskwait</span>
   <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">x</span><span class="p">);</span>  <span class="c1">// prints 2 or 3</span>
<span class="p">}</span>

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="o">!</span> <span class="nl">name</span><span class="p">:</span> <span class="n">tasking</span><span class="mf">.12f</span>
<span class="o">!</span> <span class="nl">type</span><span class="p">:</span> <span class="n">F</span><span class="o">-</span><span class="n">free</span>
<span class="o">!</span> <span class="nl">version</span><span class="p">:</span>    <span class="n">omp_3</span><span class="mf">.1</span>
<span class="n">subroutine</span> <span class="n">foo</span><span class="p">()</span>
  <span class="n">integer</span> <span class="o">::</span> <span class="n">x</span>
  <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">task</span> <span class="n">mergeable</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">task</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">taskwait</span>
  <span class="n">print</span> <span class="o">*</span><span class="p">,</span> <span class="n">x</span>   <span class="o">!</span> <span class="n">prints</span> <span class="mi">2</span> <span class="n">or</span> <span class="mi">3</span>
<span class="n">end</span> <span class="n">subroutine</span>

</pre></div>
</div>
</div>
</div>
<p>The following example shows the use of the  <code class="docutils literal notranslate"><span class="pre">final</span></code>  clause and the  <code class="docutils literal notranslate"><span class="pre">omp_in_final</span></code>   API call in a recursive binary search program. To reduce overhead, once a certain  depth of recursion is reached the program uses the  <code class="docutils literal notranslate"><span class="pre">final</span></code>  clause to create  only included tasks, which allow additional optimizations.</p>
<p>The use of the  <code class="docutils literal notranslate"><span class="pre">omp_in_final</span></code>  API call allows programmers to optimize  their  by specifying which parts of the program are not necessary when a task  can create only included tasks (that is, the  is inside a  <code class="docutils literal notranslate"><span class="pre">final</span></code>  task).  In this example, the use of a different state variable is not necessary so once  the program reaches the part of the computation that is finalized and copying from  the parent state to the new state is eliminated. The allocation of  <code class="docutils literal notranslate"><span class="pre">new_state</span></code>   in the stack could also be avoided but it would make this example less clear. The   <code class="docutils literal notranslate"><span class="pre">final</span></code>  clause is most effective when used in conjunction with the  <code class="docutils literal notranslate"><span class="pre">mergeable</span></code>   clause since all tasks created in a  <code class="docutils literal notranslate"><span class="pre">final</span></code>  task region are included tasks  that can be merged if the  <code class="docutils literal notranslate"><span class="pre">mergeable</span></code>  clause is present.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="cm">/*</span>
<span class="cm">* name: tasking.13c</span>
<span class="cm">* type: C</span>
<span class="cm">* version: omp_3.1</span>
<span class="cm">*/</span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;omp.h&gt;</span><span class="cp"></span>
<span class="cp">#define LIMIT  3 </span><span class="cm">/* arbitrary limit on recursion depth */</span><span class="cp"></span>
<span class="kt">void</span> <span class="nf">check_solution</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">bin_search</span> <span class="p">(</span><span class="kt">int</span> <span class="n">pos</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">state</span><span class="p">)</span>
<span class="p">{</span>
   <span class="k">if</span> <span class="p">(</span> <span class="n">pos</span> <span class="o">==</span> <span class="n">n</span> <span class="p">)</span> <span class="p">{</span>
      <span class="n">check_solution</span><span class="p">(</span><span class="n">state</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="cp">#pragma omp task final( pos &gt; LIMIT ) mergeable</span>
   <span class="p">{</span>
      <span class="kt">char</span> <span class="n">new_state</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">omp_in_final</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
        <span class="n">memcpy</span><span class="p">(</span><span class="n">new_state</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">pos</span> <span class="p">);</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">new_state</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">state</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">bin_search</span><span class="p">(</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">state</span> <span class="p">);</span>
   <span class="p">}</span>
   <span class="cp">#pragma omp task final( pos &gt; LIMIT ) mergeable</span>
   <span class="p">{</span>
      <span class="kt">char</span> <span class="n">new_state</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="n">omp_in_final</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
        <span class="n">memcpy</span><span class="p">(</span><span class="n">new_state</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">pos</span> <span class="p">);</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">new_state</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">state</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="n">bin_search</span><span class="p">(</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">state</span> <span class="p">);</span>
   <span class="p">}</span>
   <span class="cp">#pragma omp taskwait</span>
<span class="p">}</span>

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="o">!</span> <span class="nl">name</span><span class="p">:</span> <span class="n">tasking</span><span class="mf">.13f</span>
<span class="o">!</span> <span class="nl">type</span><span class="p">:</span> <span class="n">F</span><span class="o">-</span><span class="n">free</span>
<span class="o">!</span> <span class="nl">version</span><span class="p">:</span>    <span class="n">omp_3</span><span class="mf">.1</span>
<span class="n">recursive</span> <span class="n">subroutine</span> <span class="n">bin_search</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
  <span class="n">use</span> <span class="n">omp_lib</span>
  <span class="n">integer</span> <span class="o">::</span> <span class="n">pos</span><span class="p">,</span> <span class="n">n</span>
  <span class="n">character</span><span class="p">,</span> <span class="n">pointer</span> <span class="o">::</span> <span class="n">state</span><span class="p">(</span><span class="o">:</span><span class="p">)</span>
  <span class="n">character</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">dimension</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">::</span> <span class="n">new_state1</span><span class="p">,</span> <span class="n">new_state2</span>
  <span class="n">integer</span><span class="p">,</span> <span class="n">parameter</span> <span class="o">::</span> <span class="n">LIMIT</span> <span class="o">=</span> <span class="mi">3</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">pos</span> <span class="p">.</span><span class="n">eq</span><span class="p">.</span> <span class="n">n</span><span class="p">)</span> <span class="n">then</span>
    <span class="n">call</span> <span class="n">check_solution</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
    <span class="k">return</span>
  <span class="n">endif</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">task</span> <span class="n">final</span><span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="n">LIMIT</span><span class="p">)</span> <span class="n">mergeable</span>
  <span class="k">if</span> <span class="p">(.</span><span class="n">not</span><span class="p">.</span> <span class="n">omp_in_final</span><span class="p">())</span> <span class="n">then</span>
    <span class="n">new_state1</span><span class="p">(</span><span class="mi">1</span><span class="o">:</span><span class="n">pos</span><span class="p">)</span> <span class="o">=</span> <span class="n">state</span><span class="p">(</span><span class="mi">1</span><span class="o">:</span><span class="n">pos</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=&gt;</span> <span class="n">new_state1</span>
  <span class="n">endif</span>
  <span class="n">state</span><span class="p">(</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="sc">&#39;z&#39;</span>
  <span class="n">call</span> <span class="n">bin_search</span><span class="p">(</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">task</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">task</span> <span class="n">final</span><span class="p">(</span><span class="n">pos</span> <span class="o">&gt;</span> <span class="n">LIMIT</span><span class="p">)</span> <span class="n">mergeable</span>
  <span class="k">if</span> <span class="p">(.</span><span class="n">not</span><span class="p">.</span> <span class="n">omp_in_final</span><span class="p">())</span> <span class="n">then</span>
    <span class="n">new_state2</span><span class="p">(</span><span class="mi">1</span><span class="o">:</span><span class="n">pos</span><span class="p">)</span> <span class="o">=</span> <span class="n">state</span><span class="p">(</span><span class="mi">1</span><span class="o">:</span><span class="n">pos</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=&gt;</span> <span class="n">new_state2</span>
  <span class="n">endif</span>
  <span class="n">state</span><span class="p">(</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="sc">&#39;y&#39;</span>
  <span class="n">call</span> <span class="n">bin_search</span><span class="p">(</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">task</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">taskwait</span>
<span class="n">end</span> <span class="n">subroutine</span>

</pre></div>
</div>
</div>
</div>
<p>The following example illustrates the difference between the  <code class="docutils literal notranslate"><span class="pre">if</span></code>   and the   <code class="docutils literal notranslate"><span class="pre">final</span></code>  clauses. The  <code class="docutils literal notranslate"><span class="pre">if</span></code>  clause has a local effect. In the first  nest of tasks, the one that has the  <code class="docutils literal notranslate"><span class="pre">if</span></code>   clause will be undeferred but  the task nested inside that task will not be affected by the  <code class="docutils literal notranslate"><span class="pre">if</span></code>  clause  and will be created as usual. Alternatively, the  <code class="docutils literal notranslate"><span class="pre">final</span></code>  clause affects  all  <code class="docutils literal notranslate"><span class="pre">task</span></code>  constructs in the  <code class="docutils literal notranslate"><span class="pre">final</span></code>  task region but not the  <code class="docutils literal notranslate"><span class="pre">final</span></code>   task itself. In the second nest of tasks, the nested tasks will be created as included  tasks. Note also that the conditions for the  <code class="docutils literal notranslate"><span class="pre">if</span></code>  and  <code class="docutils literal notranslate"><span class="pre">final</span></code>  clauses  are usually the opposite.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="cm">/*</span>
<span class="cm">* name: tasking.14c</span>
<span class="cm">* type: C</span>
<span class="cm">* version: omp_3.1</span>
<span class="cm">*/</span>
<span class="kt">void</span> <span class="nf">bar</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">foo</span> <span class="p">(</span> <span class="p">)</span>
<span class="p">{</span>
   <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
   <span class="cp">#pragma omp task if(0)  </span><span class="c1">// This task is undeferred</span>
   <span class="p">{</span>
      <span class="cp">#pragma omp task     </span><span class="c1">// This task is a regular task</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="cp">#pragma omp task     </span><span class="c1">// This task is a regular task</span>
          <span class="n">bar</span><span class="p">();</span>
      <span class="p">}</span>
   <span class="p">}</span>
   <span class="cp">#pragma omp task final(1) </span><span class="c1">// This task is a regular task</span>
   <span class="p">{</span>
      <span class="cp">#pragma omp task  </span><span class="c1">// This task is included</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="cp">#pragma omp task     </span><span class="c1">// This task is also included</span>
          <span class="n">bar</span><span class="p">();</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="o">!</span> <span class="nl">name</span><span class="p">:</span> <span class="n">tasking</span><span class="mf">.14f</span>
<span class="o">!</span> <span class="nl">type</span><span class="p">:</span> <span class="n">F</span><span class="o">-</span><span class="n">free</span>
<span class="o">!</span> <span class="nl">version</span><span class="p">:</span>    <span class="n">omp_3</span><span class="mf">.1</span>
<span class="n">subroutine</span> <span class="n">foo</span><span class="p">()</span>
<span class="n">integer</span> <span class="n">i</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">task</span> <span class="k">if</span><span class="p">(.</span><span class="n">FALSE</span><span class="p">.)</span> <span class="o">!</span> <span class="n">This</span> <span class="n">task</span> <span class="n">is</span> <span class="n">undeferred</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">task</span>             <span class="o">!</span> <span class="n">This</span> <span class="n">task</span> <span class="n">is</span> <span class="n">a</span> <span class="n">regular</span> <span class="n">task</span>
  <span class="k">do</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span>
    <span class="o">!</span><span class="n">$omp</span> <span class="n">task</span>             <span class="o">!</span> <span class="n">This</span> <span class="n">task</span> <span class="n">is</span> <span class="n">a</span> <span class="n">regular</span> <span class="n">task</span>
      <span class="n">call</span> <span class="n">bar</span><span class="p">()</span>
    <span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">task</span>
  <span class="n">enddo</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">task</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">task</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">task</span> <span class="n">final</span><span class="p">(.</span><span class="n">TRUE</span><span class="p">.)</span> <span class="o">!</span> <span class="n">This</span> <span class="n">task</span> <span class="n">is</span> <span class="n">a</span> <span class="n">regular</span> <span class="n">task</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">task</span>               <span class="o">!</span> <span class="n">This</span> <span class="n">task</span> <span class="n">is</span> <span class="n">included</span>
  <span class="k">do</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span>
    <span class="o">!</span><span class="n">$omp</span> <span class="n">task</span>               <span class="o">!</span> <span class="n">This</span> <span class="n">task</span> <span class="n">is</span> <span class="n">also</span> <span class="n">included</span>
     <span class="n">call</span> <span class="n">bar</span><span class="p">()</span>
    <span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">task</span>
  <span class="n">enddo</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">task</span>
<span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">task</span>
<span class="n">end</span> <span class="n">subroutine</span>

</pre></div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "native"
        },
        kernelOptions: {
            kernelName: "native",
            path: "./contents"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'native'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="Chap_tasking.html" title="previous page">Tasking</a>
    <a class='right-next' id="next-link" href="Examples_task_priority.html" title="next page">Task Priority</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The OpenMP Community<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>