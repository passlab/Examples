
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>target data Construct &#8212; OpenMP Application Programming Interface Examples</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.c441f2ba0852f4cabcb80105e3a46ae6.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="target enter data and target exit data Constructs" href="Examples_target_unstructured_data.html" />
    <link rel="prev" title="declare mapper Construct" href="Examples_target_mapper.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">OpenMP Application Programming Interface Examples</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Welcome to OMP Jupyter Book
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="Foreword_Chapt.html">
   Foreword
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Introduction_Chapt.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Examples_Chapt.html">
   Examples
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="Chap_parallel_execution.html">
   Parallel Execution
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_ploop.html">
     A Simple Parallel Loop
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_parallel.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       parallel
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_host_teams.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       teams
      </span>
     </code>
     Construct on Host
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_nthrs_nesting.html">
     Controlling the Number of Threads on Multiple Nesting Levels
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_nthrs_dynamic.html">
     Interaction Between the
     <code class="docutils literal notranslate">
      <span class="pre">
       num_threads
      </span>
     </code>
     Clause and
     <code class="docutils literal notranslate">
      <span class="pre">
       omp_set_dynamic
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_fort_do.html">
     Fortran Restrictions on the
     <code class="docutils literal notranslate">
      <span class="pre">
       do
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_nowait.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       nowait
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_collapse.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       collapse
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_linear_in_loop.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       linear
      </span>
     </code>
     Clause in Loop Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_psections.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       parallel
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       sections
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_fpriv_sections.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       firstprivate
      </span>
     </code>
     Clause and the
     <code class="docutils literal notranslate">
      <span class="pre">
       sections
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_single.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       single
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_workshare.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       workshare
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_master.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       master
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_loop.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       loop
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_pra_iterator.html">
     Parallel Random Access Iterator Loop
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_set_dynamic_nthrs.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       omp_set_dynamic
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       omp_set_num_threads
      </span>
     </code>
     Routines
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_get_nthrs.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       omp_get_num_threads
      </span>
     </code>
     Routine
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="Chap_affinity.html">
   OpenMP Affinity
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_affinity.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       proc_bind
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_task_affinity.html">
     Task Affinity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_affinity_display.html">
     Affinity Display
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_affinity_query.html">
     Affinity Query Functions
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="Chap_tasking.html">
   Tasking
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_tasking.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       task
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       taskwait
      </span>
     </code>
     Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_task_priority.html">
     Task Priority
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_task_dep.html">
     Task Dependences
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_taskgroup.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       taskgroup
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_taskyield.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       taskyield
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_taskloop.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       taskloop
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_parallel_master_taskloop.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       parallel
      </span>
      <span class="pre">
       master
      </span>
      <span class="pre">
       taskloop
      </span>
     </code>
     Construct
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 current active collapsible-parent">
  <a class="reference internal" href="Chap_devices.html">
   Devices
  </a>
  <ul class="current collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_defaultmap.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       defaultmap
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_pointer_mapping.html">
     Pointer mapping
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_structure_mapping.html">
     Structure mapping
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_array_sections.html">
     Array Sections in Device Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_array_shaping.html">
     Array Shaping
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_mapper.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       declare
      </span>
      <span class="pre">
       mapper
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       data
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_unstructured_data.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       enter
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       data
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       exit
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       data
      </span>
     </code>
     Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_unstructured_data.html#simple-target-enter-data-and-target-exit-data-constructs">
     Simple target enter data and target exit data Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_update.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       update
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_declare_target.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       declare
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_teams.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       teams
      </span>
     </code>
     Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_async_target_depend.html">
     Asynchronous
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     Execution and Dependences
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_async_target_with_tasks.html">
     Asynchronous
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     with Tasks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_async_target_nowait.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       nowait
      </span>
     </code>
     Clause on
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_async_target_nowait_depend.html">
     Asynchronous
     <code class="docutils literal notranslate">
      <span class="pre">
       target
      </span>
     </code>
     with
     <code class="docutils literal notranslate">
      <span class="pre">
       nowait
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       depend
      </span>
     </code>
     Clauses
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_device.html">
     Device Routines
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="Chap_SIMD.html">
   SIMD
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_SIMD.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       simd
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       declare
      </span>
     </code>
     <code class="docutils literal notranslate">
      <span class="pre">
       simd
      </span>
     </code>
     Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_SIMD.html#inbranch-and-notinbranch-clauses">
     <code class="docutils literal notranslate">
      <span class="pre">
       inbranch
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       notinbranch
      </span>
     </code>
     Clauses
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_SIMD.html#loop-carried-lexical-forward-dependence">
     Loop-Carried Lexical Forward Dependence
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_linear_modifier.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       ref
      </span>
     </code>
     ,
     <code class="docutils literal notranslate">
      <span class="pre">
       val
      </span>
     </code>
     ,
     <code class="docutils literal notranslate">
      <span class="pre">
       uval
      </span>
     </code>
     Modifiers for
     <code class="docutils literal notranslate">
      <span class="pre">
       linear
      </span>
     </code>
     Clause
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="Chap_synchronization.html">
   Synchronization
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_critical.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       critical
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_worksharing_critical.html">
     Worksharing Constructs Inside a
     <code class="docutils literal notranslate">
      <span class="pre">
       critical
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_barrier_regions.html">
     Binding of
     <code class="docutils literal notranslate">
      <span class="pre">
       barrier
      </span>
     </code>
     Regions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_atomic.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       atomic
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_atomic_restrict.html">
     Restrictions on the
     <code class="docutils literal notranslate">
      <span class="pre">
       atomic
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_flush_nolist.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       flush
      </span>
     </code>
     Construct without a List
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_acquire_release.html">
     Synchronization Based on Acquire/Release Semantics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_ordered.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       ordered
      </span>
     </code>
     Clause and the
     <code class="docutils literal notranslate">
      <span class="pre">
       ordered
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_depobj.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       depobj
      </span>
     </code>
     Construct
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_doacross.html">
     Doacross Loop Nest
    </a>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="Examples_locks.html">
     Lock Routines
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="Examples_init_lock.html">
       The
       <code class="docutils literal notranslate">
        <span class="pre">
         omp_init_lock
        </span>
       </code>
       Routine
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Examples_init_lock_with_hint.html">
       The
       <code class="docutils literal notranslate">
        <span class="pre">
         omp_init_lock_with_hint
        </span>
       </code>
       Routine
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Examples_lock_owner.html">
       Ownership of Locks
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Examples_simple_lock.html">
       Simple Lock Routines
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="Examples_nestable_lock.html">
       Nestable Lock Routines
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="Chap_data_environment.html">
   Data Environment
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_threadprivate.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       threadprivate
      </span>
     </code>
     Directive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_default_none.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       default(none)
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_private.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       private
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_fort_loopvar.html">
     Fortran Private Loop Iteration Variables
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_fort_sp_common.html">
     Fortran Restrictions on
     <code class="docutils literal notranslate">
      <span class="pre">
       shared
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       private
      </span>
     </code>
     Clauses with Common Blocks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_fort_sa_private.html">
     Fortran Restrictions on Storage Association with the
     <code class="docutils literal notranslate">
      <span class="pre">
       private
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_carrays_fpriv.html">
     C/C++ Arrays in a
     <code class="docutils literal notranslate">
      <span class="pre">
       firstprivate
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_lastprivate.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       lastprivate
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_reduction.html">
     Reduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_udr.html">
     User-Defined Reduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_scan.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       scan
      </span>
     </code>
     Directive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_copyin.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       copyin
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_copyprivate.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       copyprivate
      </span>
     </code>
     Clause
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_cpp_reference.html">
     C++ Reference in Data-Sharing Clauses
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="Chap_memory_model.html">
   Memory Model
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_mem_model.html">
     The OpenMP Memory Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_allocators.html">
     Memory Allocators
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_fort_race.html">
     Race Conditions Caused by Implied Copies of Shared Variables in Fortran
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="Chap_program_control.html">
   Program Control
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_cond_comp.html">
     Conditional Compilation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_icv.html">
     Internal Control Variables (ICVs)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_cancellation.html">
     Cancellation Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_requires.html">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       requires
      </span>
     </code>
     Directive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_variant.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       declare
      </span>
     </code>
     ~
     <code class="docutils literal notranslate">
      <span class="pre">
       variant
      </span>
     </code>
     Directive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_metadirective.html">
     Metadirective Directive
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_nested_loop.html">
     Nested Loop Constructs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_nesting_restrict.html">
     Restrictions on Nesting of Regions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Examples_target_offload.html">
     Target Offload
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="History.html">
   Document Revision History
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/contents/Examples_target_data.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/passlab/Examples"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/passlab/Examples/issues/new?title=Issue%20on%20page%20%2Fcontents/Examples_target_data.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/passlab/Examples/main?urlpath=lab/tree/notebook/contents/Examples_target_data.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i>
            Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#simple-target-data-construct">
   Simple
   <code class="docutils literal notranslate">
    <span class="pre">
     target
    </span>
   </code>
   <code class="docutils literal notranslate">
    <span class="pre">
     data
    </span>
   </code>
   Construct
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#target-data-region-enclosing-multiple-target-regions">
   <code class="docutils literal notranslate">
    <span class="pre">
     target
    </span>
   </code>
   <code class="docutils literal notranslate">
    <span class="pre">
     data
    </span>
   </code>
   Region Enclosing Multiple
   <code class="docutils literal notranslate">
    <span class="pre">
     target
    </span>
   </code>
   Regions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#target-data-construct-with-orphaned-call">
   <code class="docutils literal notranslate">
    <span class="pre">
     target
    </span>
   </code>
   <code class="docutils literal notranslate">
    <span class="pre">
     data
    </span>
   </code>
   Construct with Orphaned Call
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#target-data-construct-with-if-clause">
   <code class="docutils literal notranslate">
    <span class="pre">
     target
    </span>
   </code>
   <code class="docutils literal notranslate">
    <span class="pre">
     data
    </span>
   </code>
   Construct with
   <code class="docutils literal notranslate">
    <span class="pre">
     if
    </span>
   </code>
   Clause
  </a>
 </li>
</ul>

        </nav>
        
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="target-data-construct">
<h1><code class="docutils literal notranslate"><span class="pre">target</span></code>   <code class="docutils literal notranslate"><span class="pre">data</span></code>  Construct<a class="headerlink" href="#target-data-construct" title="Permalink to this headline">¶</a></h1>
<div class="section" id="simple-target-data-construct">
<h2>Simple  <code class="docutils literal notranslate"><span class="pre">target</span></code>   <code class="docutils literal notranslate"><span class="pre">data</span></code>  Construct<a class="headerlink" href="#simple-target-data-construct" title="Permalink to this headline">¶</a></h2>
<p>This example shows how the  <code class="docutils literal notranslate"><span class="pre">target</span></code>   <code class="docutils literal notranslate"><span class="pre">data</span></code>  construct maps variables  to a device data environment. The  <code class="docutils literal notranslate"><span class="pre">target</span></code>   <code class="docutils literal notranslate"><span class="pre">data</span></code>  construct creates  a new device data environment and maps the variables  <em>v1</em> ,  <em>v2</em> , and  <em>p</em>  to the new device  data environment. The  <code class="docutils literal notranslate"><span class="pre">target</span></code>  construct enclosed in the  <code class="docutils literal notranslate"><span class="pre">target</span></code>    <code class="docutils literal notranslate"><span class="pre">data</span></code>  region creates a new device data environment, which inherits the  variables  <em>v1</em> ,  <em>v2</em> , and  <em>p</em>  from the enclosing device data environment. The variable   <em>N</em>  is mapped into the new device data environment from the encountering task’s data  environment.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="cm">/*</span>
<span class="cm">* name: target_data.1c</span>
<span class="cm">* type: C</span>
<span class="cm">* version: omp_4.0</span>
<span class="cm">*/</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">init</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">output</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">vec_mult</span><span class="p">(</span><span class="kt">float</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">float</span> <span class="o">*</span><span class="n">v1</span><span class="p">,</span> <span class="kt">float</span> <span class="o">*</span><span class="n">v2</span><span class="p">,</span> <span class="kt">int</span> <span class="n">N</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
   <span class="n">init</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
   <span class="cp">#pragma omp target data map(to: v1[0:N], v2[:N]) map(from: p[0:N])</span>
   <span class="p">{</span>
      <span class="cp">#pragma omp target</span>
      <span class="cp">#pragma omp parallel for</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
 <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">v2</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
   <span class="p">}</span>
   <span class="n">output</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
<span class="p">}</span>

</pre></div>
</div>
</div>
</div>
<p>The Fortran  passes a reference and specifies the extent of the arrays in the  declaration. No length information is necessary in the map clause, as is required  with C/C++ pointers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="o">!</span> <span class="nl">name</span><span class="p">:</span> <span class="n">target_data</span><span class="mf">.1f</span>
<span class="o">!</span> <span class="nl">type</span><span class="p">:</span> <span class="n">F</span><span class="o">-</span><span class="n">free</span>
<span class="o">!</span> <span class="nl">version</span><span class="p">:</span>    <span class="n">omp_4</span><span class="mf">.0</span>
<span class="n">subroutine</span> <span class="n">vec_mult</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
   <span class="n">real</span>    <span class="o">::</span>  <span class="n">p</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">v1</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">v2</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
   <span class="n">integer</span> <span class="o">::</span>  <span class="n">i</span>
   <span class="n">call</span> <span class="n">init</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
   <span class="o">!</span><span class="n">$omp</span> <span class="n">target</span> <span class="n">data</span> <span class="n">map</span><span class="p">(</span><span class="nl">to</span><span class="p">:</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span> <span class="n">map</span><span class="p">(</span><span class="nl">from</span><span class="p">:</span> <span class="n">p</span><span class="p">)</span>
   <span class="o">!</span><span class="n">$omp</span> <span class="n">target</span>
   <span class="o">!</span><span class="n">$omp</span> <span class="n">parallel</span> <span class="k">do</span>
      <span class="k">do</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
  <span class="n">p</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">v1</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">v2</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
      <span class="n">end</span> <span class="k">do</span>
   <span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">target</span>
   <span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">target</span> <span class="n">data</span>
   <span class="n">call</span> <span class="n">output</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<span class="n">end</span> <span class="n">subroutine</span>

</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="target-data-region-enclosing-multiple-target-regions">
<h2><code class="docutils literal notranslate"><span class="pre">target</span></code>   <code class="docutils literal notranslate"><span class="pre">data</span></code>  Region Enclosing Multiple  <code class="docutils literal notranslate"><span class="pre">target</span></code>  Regions<a class="headerlink" href="#target-data-region-enclosing-multiple-target-regions" title="Permalink to this headline">¶</a></h2>
<p>The following examples show how the  <code class="docutils literal notranslate"><span class="pre">target</span></code>   <code class="docutils literal notranslate"><span class="pre">data</span></code>  construct maps  variables to a device data environment of a  <code class="docutils literal notranslate"><span class="pre">target</span></code>  region. The  <code class="docutils literal notranslate"><span class="pre">target</span></code>    <code class="docutils literal notranslate"><span class="pre">data</span></code>  construct creates a device data environment and encloses  <code class="docutils literal notranslate"><span class="pre">target</span></code>   regions, which have their own device data environments. The device data environment  of the  <code class="docutils literal notranslate"><span class="pre">target</span></code>   <code class="docutils literal notranslate"><span class="pre">data</span></code>  region is inherited by the device data environment  of an enclosed  <code class="docutils literal notranslate"><span class="pre">target</span></code>  region. The  <code class="docutils literal notranslate"><span class="pre">target</span></code>   <code class="docutils literal notranslate"><span class="pre">data</span></code>  construct  is used to create variables that will persist throughout the  <code class="docutils literal notranslate"><span class="pre">target</span></code>   <code class="docutils literal notranslate"><span class="pre">data</span></code>   region.</p>
<p>In the following example the variables  <em>v1</em>  and  <em>v2</em>  are mapped at each  <code class="docutils literal notranslate"><span class="pre">target</span></code>   construct. Instead of mapping the variable  <em>p</em>  twice, once at each  <code class="docutils literal notranslate"><span class="pre">target</span></code>   construct,  <em>p</em>  is mapped once by the  <code class="docutils literal notranslate"><span class="pre">target</span></code>   <code class="docutils literal notranslate"><span class="pre">data</span></code>  construct.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="cm">/*</span>
<span class="cm">* name: target_data.2c</span>
<span class="cm">* type: C</span>
<span class="cm">* version: omp_4.0</span>
<span class="cm">*/</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">init</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">init_again</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">output</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">vec_mult</span><span class="p">(</span><span class="kt">float</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">float</span> <span class="o">*</span><span class="n">v1</span><span class="p">,</span> <span class="kt">float</span> <span class="o">*</span><span class="n">v2</span><span class="p">,</span> <span class="kt">int</span> <span class="n">N</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
   <span class="n">init</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
   <span class="cp">#pragma omp target data map(from: p[0:N])</span>
   <span class="p">{</span>
      <span class="cp">#pragma omp target map(to: v1[:N], v2[:N])</span>
      <span class="cp">#pragma omp parallel for</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
 <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">v2</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
      <span class="n">init_again</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
      <span class="cp">#pragma omp target map(to: v1[:N], v2[:N])</span>
      <span class="cp">#pragma omp parallel for</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
 <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">v1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">v2</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
   <span class="p">}</span>
   <span class="n">output</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
<span class="p">}</span>

</pre></div>
</div>
</div>
</div>
<p>The Fortran  uses reference and specifies the extent of the  <em>p</em> ,  <em>v1</em>  and  <em>v2</em>  arrays.  No length information is necessary in the  <code class="docutils literal notranslate"><span class="pre">map</span></code>  clause, as is required with  C/C++ pointers. The arrays  <em>v1</em>  and  <em>v2</em>  are mapped at each  <code class="docutils literal notranslate"><span class="pre">target</span></code>  construct.  Instead of mapping the array  <em>p</em>  twice, once at each target construct,  <em>p</em>  is mapped  once by the  <code class="docutils literal notranslate"><span class="pre">target</span></code>   <code class="docutils literal notranslate"><span class="pre">data</span></code>  construct.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="o">!</span> <span class="nl">name</span><span class="p">:</span> <span class="n">target_data</span><span class="mf">.2f</span>
<span class="o">!</span> <span class="nl">type</span><span class="p">:</span> <span class="n">F</span><span class="o">-</span><span class="n">free</span>
<span class="o">!</span> <span class="nl">version</span><span class="p">:</span>    <span class="n">omp_4</span><span class="mf">.0</span>
<span class="n">subroutine</span> <span class="n">vec_mult</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
   <span class="n">real</span>    <span class="o">::</span>  <span class="n">p</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">v1</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">v2</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
   <span class="n">integer</span> <span class="o">::</span>  <span class="n">i</span>
   <span class="n">call</span> <span class="n">init</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
   <span class="o">!</span><span class="n">$omp</span> <span class="n">target</span> <span class="n">data</span> <span class="n">map</span><span class="p">(</span><span class="nl">from</span><span class="p">:</span> <span class="n">p</span><span class="p">)</span>
      <span class="o">!</span><span class="n">$omp</span> <span class="n">target</span> <span class="n">map</span><span class="p">(</span><span class="nl">to</span><span class="p">:</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span> <span class="p">)</span>
         <span class="o">!</span><span class="n">$omp</span> <span class="n">parallel</span> <span class="k">do</span>
         <span class="k">do</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
            <span class="n">p</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">v1</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">v2</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
         <span class="n">end</span> <span class="k">do</span>
      <span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">target</span>
      <span class="n">call</span> <span class="n">init_again</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
      <span class="o">!</span><span class="n">$omp</span> <span class="n">target</span> <span class="n">map</span><span class="p">(</span><span class="nl">to</span><span class="p">:</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span> <span class="p">)</span>
         <span class="o">!</span><span class="n">$omp</span> <span class="n">parallel</span> <span class="k">do</span>
         <span class="k">do</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
            <span class="n">p</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">p</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">v1</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">v2</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
         <span class="n">end</span> <span class="k">do</span>
      <span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">target</span>
   <span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">target</span> <span class="n">data</span>
   <span class="n">call</span> <span class="n">output</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<span class="n">end</span> <span class="n">subroutine</span>

</pre></div>
</div>
</div>
</div>
<p>In the following example, the array  <em>Q</em>  is mapped once at the enclosing   <code class="docutils literal notranslate"><span class="pre">target</span></code> ~ <code class="docutils literal notranslate"><span class="pre">data</span></code>  region instead of at each  <code class="docutils literal notranslate"><span class="pre">target</span></code>  construct.  In OpenMP 4.0, a scalar variable is implicitly mapped with the  <code class="docutils literal notranslate"><span class="pre">tofrom</span></code>  map-type. But since OpenMP 4.5, a scalar variable, such as the  <em>tmp</em>  variable, has to be explicitly mapped with  the  <code class="docutils literal notranslate"><span class="pre">tofrom</span></code>  map-type at the first  <code class="docutils literal notranslate"><span class="pre">target</span></code>  construct in order to return  its reduced value from the parallel loop construct to the host. The variable defaults to firstprivate at the second  <code class="docutils literal notranslate"><span class="pre">target</span></code>  construct.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="cm">/*</span>
<span class="cm">* name: target_data.3c</span>
<span class="cm">* type: C</span>
<span class="cm">* version: omp_4.0</span>
<span class="cm">*/</span>

<span class="cp">#include</span> <span class="cpf">&lt;math.h&gt;</span><span class="cp"></span>
<span class="cp">#define COLS 100</span>

<span class="kt">void</span> <span class="nf">gramSchmidt</span><span class="p">(</span><span class="kt">float</span> <span class="n">Q</span><span class="p">[][</span><span class="n">COLS</span><span class="p">],</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">rows</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">COLS</span><span class="p">;</span>
    <span class="cp">#pragma omp target data map(Q[0:rows][0:cols])</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">cols</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">double</span> <span class="n">tmp</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>

        <span class="cp">#pragma omp target map(tofrom: tmp)</span>
        <span class="cp">#pragma omp parallel for reduction(+:tmp)</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">rows</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="n">tmp</span> <span class="o">+=</span> <span class="p">(</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]);</span>

        <span class="n">tmp</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tmp</span><span class="p">);</span>

        <span class="cp">#pragma omp target</span>
        <span class="cp">#pragma omp parallel for</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">rows</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="n">tmp</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* Note:  The variable tmp is now mapped with tofrom, for correct</span>
<span class="cm">   execution with 4.5 (and pre-4.5) compliant compilers. See Devices Intro.</span>
<span class="cm"> */</span>

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="o">!</span> <span class="nl">name</span><span class="p">:</span> <span class="n">target_data</span><span class="mf">.3f</span>
<span class="o">!</span> <span class="nl">type</span><span class="p">:</span> <span class="n">F</span><span class="o">-</span><span class="n">free</span>
<span class="o">!</span> <span class="nl">version</span><span class="p">:</span>    <span class="n">omp_4</span><span class="mf">.0</span>
<span class="n">subroutine</span> <span class="n">gramSchmidt</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span><span class="n">rows</span><span class="p">,</span><span class="n">cols</span><span class="p">)</span>
<span class="n">integer</span>             <span class="o">::</span>   <span class="n">rows</span><span class="p">,</span><span class="n">cols</span><span class="p">,</span>  <span class="n">i</span><span class="p">,</span><span class="n">k</span>
<span class="kt">double</span> <span class="n">precision</span>    <span class="o">::</span> <span class="n">Q</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span><span class="n">cols</span><span class="p">),</span> <span class="n">tmp</span>
      <span class="o">!</span><span class="n">$omp</span> <span class="n">target</span> <span class="n">data</span> <span class="n">map</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>
      <span class="k">do</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">cols</span>
         <span class="n">tmp</span> <span class="o">=</span> <span class="mf">0.0</span><span class="n">d0</span>
        <span class="o">!</span><span class="n">$omp</span> <span class="n">target</span> <span class="n">map</span><span class="p">(</span><span class="nl">tofrom</span><span class="p">:</span> <span class="n">tmp</span><span class="p">)</span>
           <span class="o">!</span><span class="n">$omp</span> <span class="n">parallel</span> <span class="k">do</span> <span class="n">reduction</span><span class="p">(</span><span class="o">+:</span><span class="n">tmp</span><span class="p">)</span>
           <span class="k">do</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">rows</span>
              <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span> <span class="o">+</span> <span class="p">(</span><span class="n">Q</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">*</span> <span class="n">Q</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
           <span class="n">end</span> <span class="k">do</span>
        <span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">target</span>

          <span class="n">tmp</span> <span class="o">=</span> <span class="mf">1.0</span><span class="n">d0</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

        <span class="o">!</span><span class="n">$omp</span> <span class="n">target</span>
           <span class="o">!</span><span class="n">$omp</span> <span class="n">parallel</span> <span class="k">do</span>
           <span class="k">do</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">rows</span>
               <span class="n">Q</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">Q</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">tmp</span>
           <span class="n">enddo</span>
        <span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">target</span>
      <span class="n">end</span> <span class="k">do</span>
      <span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">target</span> <span class="n">data</span>
<span class="n">end</span> <span class="n">subroutine</span>

<span class="o">!</span> <span class="nl">Note</span><span class="p">:</span>  <span class="n">The</span> <span class="n">variable</span> <span class="n">tmp</span> <span class="n">is</span> <span class="n">now</span> <span class="n">mapped</span> <span class="n">with</span> <span class="n">tofrom</span><span class="p">,</span> <span class="k">for</span> <span class="n">correct</span>
<span class="o">!</span> <span class="n">execution</span> <span class="n">with</span> <span class="mf">4.5</span> <span class="p">(</span><span class="n">and</span> <span class="n">pre</span><span class="mf">-4.5</span><span class="p">)</span> <span class="n">compliant</span> <span class="n">compilers</span><span class="p">.</span> <span class="n">See</span> <span class="n">Devices</span> <span class="n">Intro</span><span class="p">.</span>

</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="target-data-construct-with-orphaned-call">
<h2><code class="docutils literal notranslate"><span class="pre">target</span></code>   <code class="docutils literal notranslate"><span class="pre">data</span></code>  Construct with Orphaned Call<a class="headerlink" href="#target-data-construct-with-orphaned-call" title="Permalink to this headline">¶</a></h2>
<p>The following two examples show how the  <code class="docutils literal notranslate"><span class="pre">target</span></code>   <code class="docutils literal notranslate"><span class="pre">data</span></code>  construct  maps variables to a device data environment. The  <code class="docutils literal notranslate"><span class="pre">target</span></code>   <code class="docutils literal notranslate"><span class="pre">data</span></code>   construct’s device data environment encloses the  <code class="docutils literal notranslate"><span class="pre">target</span></code>  construct’s device  data environment in the function  <code class="docutils literal notranslate"><span class="pre">vec_mult()</span></code> .</p>
<p>When the type of the variable appearing in an array section is pointer, the pointer  variable and the storage location of the corresponding array section are mapped  to the device data environment. The pointer variable is treated as if it had appeared  in a  <code class="docutils literal notranslate"><span class="pre">map</span></code>  clause with a map-type of  <code class="docutils literal notranslate"><span class="pre">alloc</span></code> . The array section’s  storage location is mapped according to the map-type in the  <code class="docutils literal notranslate"><span class="pre">map</span></code>  clause  (the default map-type is  <code class="docutils literal notranslate"><span class="pre">tofrom</span></code> ).</p>
<p>The  <code class="docutils literal notranslate"><span class="pre">target</span></code>  construct’s device data environment inherits the storage locations  of the array sections  <em>v1[0:N]</em> ,  <em>v2[:n]</em> , and  <em>p0[0:N]</em>  from the enclosing target data  construct’s device data environment. Neither initialization nor assignment is performed  for the array sections in the new device data environment.</p>
<p>The pointer variables  <em>p1</em> ,  <em>v3</em> , and  <em>v4</em>  are mapped into the target construct’s device  data environment with an implicit map-type of alloc and they are assigned the address  of the storage location associated with their corresponding array sections. Note  that the following pairs of array section storage locations are equivalent ( <em>p0[:N]</em> ,   <em>p1[:N]</em> ), ( <em>v1[:N]</em> , <em>v3[:N]</em> ), and ( <em>v2[:N]</em> , <em>v4[:N]</em> ).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="cm">/*</span>
<span class="cm">* name: target_data.4c</span>
<span class="cm">* type: C</span>
<span class="cm">* version: omp_4.0</span>
<span class="cm">*/</span>


<span class="kt">void</span> <span class="nf">vec_mult</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">init</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">output</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>


<span class="kt">void</span> <span class="nf">foo</span><span class="p">(</span><span class="kt">float</span> <span class="o">*</span><span class="n">p0</span><span class="p">,</span> <span class="kt">float</span> <span class="o">*</span><span class="n">v1</span><span class="p">,</span> <span class="kt">float</span> <span class="o">*</span><span class="n">v2</span><span class="p">,</span> <span class="kt">int</span> <span class="n">N</span><span class="p">)</span>
<span class="p">{</span>
   <span class="n">init</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>

   <span class="cp">#pragma omp target data map(to: v1[0:N], v2[:N]) map(from: p0[0:N])</span>
   <span class="p">{</span>
      <span class="n">vec_mult</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
   <span class="p">}</span>

   <span class="n">output</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
<span class="p">}</span>



<span class="kt">void</span> <span class="nf">vec_mult</span><span class="p">(</span><span class="kt">float</span> <span class="o">*</span><span class="n">p1</span><span class="p">,</span> <span class="kt">float</span> <span class="o">*</span><span class="n">v3</span><span class="p">,</span> <span class="kt">float</span> <span class="o">*</span><span class="n">v4</span><span class="p">,</span> <span class="kt">int</span> <span class="n">N</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
   <span class="cp">#pragma omp target map(to: v3[0:N], v4[:N]) map(from: p1[0:N])</span>
   <span class="cp">#pragma omp parallel for</span>
   <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
   <span class="p">{</span>
     <span class="n">p1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">v4</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
   <span class="p">}</span>
<span class="p">}</span>


</pre></div>
</div>
</div>
</div>
<p>The Fortran  maps the pointers and storage in an identical manner (same extent,  but uses indices from 1 to  <em>N</em> ).</p>
<p>The  <code class="docutils literal notranslate"><span class="pre">target</span></code>  construct’s device data environment inherits the storage locations  of the arrays  <em>v1</em> ,  <em>v2</em>  and  <em>p0</em>  from the enclosing  <code class="docutils literal notranslate"><span class="pre">target</span></code>   <code class="docutils literal notranslate"><span class="pre">data</span></code>  constructs’s  device data environment. However, in Fortran the associated data of the pointer  is known, and the shape is not required.</p>
<p>The pointer variables  <em>p1</em> ,  <em>v3</em> , and  <em>v4</em>  are mapped into the  <code class="docutils literal notranslate"><span class="pre">target</span></code>  construct’s  device data environment with an implicit map-type of  <code class="docutils literal notranslate"><span class="pre">alloc</span></code>  and they are  assigned the address of the storage location associated with their corresponding  array sections. Note that the following pair of array storage locations are equivalent  ( <em>p0</em> , <em>p1</em> ), ( <em>v1</em> , <em>v3</em> ), and ( <em>v2</em> , <em>v4</em> ).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="o">!</span> <span class="nl">name</span><span class="p">:</span> <span class="n">target_data</span><span class="mf">.4f</span>
<span class="o">!</span> <span class="nl">type</span><span class="p">:</span> <span class="n">F</span><span class="o">-</span><span class="n">free</span>
<span class="o">!</span> <span class="nl">version</span><span class="p">:</span>    <span class="n">omp_4</span><span class="mf">.0</span>

<span class="n">module</span> <span class="n">mults</span>
<span class="n">contains</span>
<span class="n">subroutine</span> <span class="n">foo</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<span class="n">real</span><span class="p">,</span><span class="n">pointer</span><span class="p">,</span><span class="n">dimension</span><span class="p">(</span><span class="o">:</span><span class="p">)</span> <span class="o">::</span> <span class="n">p0</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span>
<span class="n">integer</span>                   <span class="o">::</span> <span class="n">N</span><span class="p">,</span><span class="n">i</span>

   <span class="n">call</span> <span class="n">init</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

   <span class="o">!</span><span class="n">$omp</span> <span class="n">target</span> <span class="n">data</span> <span class="n">map</span><span class="p">(</span><span class="nl">to</span><span class="p">:</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span> <span class="n">map</span><span class="p">(</span><span class="nl">from</span><span class="p">:</span> <span class="n">p0</span><span class="p">)</span>
    <span class="n">call</span> <span class="n">vec_mult</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
   <span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">target</span> <span class="n">data</span>

   <span class="n">call</span> <span class="n">output</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

<span class="n">end</span> <span class="n">subroutine</span>

<span class="n">subroutine</span> <span class="n">vec_mult</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="n">v4</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<span class="n">real</span><span class="p">,</span><span class="n">pointer</span><span class="p">,</span><span class="n">dimension</span><span class="p">(</span><span class="o">:</span><span class="p">)</span> <span class="o">::</span> <span class="n">p1</span><span class="p">,</span> <span class="n">v3</span><span class="p">,</span> <span class="n">v4</span>
<span class="n">integer</span>                   <span class="o">::</span> <span class="n">N</span><span class="p">,</span><span class="n">i</span>

   <span class="o">!</span><span class="n">$omp</span> <span class="n">target</span> <span class="n">map</span><span class="p">(</span><span class="nl">to</span><span class="p">:</span> <span class="n">v3</span><span class="p">,</span> <span class="n">v4</span><span class="p">)</span> <span class="n">map</span><span class="p">(</span><span class="nl">from</span><span class="p">:</span> <span class="n">p1</span><span class="p">)</span>
   <span class="o">!</span><span class="n">$omp</span> <span class="n">parallel</span> <span class="k">do</span>
   <span class="k">do</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
      <span class="n">p1</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">v3</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">v4</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
   <span class="n">end</span> <span class="k">do</span>
   <span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">target</span>

<span class="n">end</span> <span class="n">subroutine</span>
<span class="n">end</span> <span class="n">module</span>

</pre></div>
</div>
</div>
</div>
<p>In the following example, the variables  <em>p1</em> ,  <em>v3</em> , and  <em>v4</em>  are references to the pointer  variables  <em>p0</em> ,  <em>v1</em>  and  <em>v2</em>  respectively. The  <code class="docutils literal notranslate"><span class="pre">target</span></code>  construct’s device data  environment inherits the pointer variables  <em>p0</em> ,  <em>v1</em> , and  <em>v2</em>  from the enclosing  <code class="docutils literal notranslate"><span class="pre">target</span></code>    <code class="docutils literal notranslate"><span class="pre">data</span></code>  construct’s device data environment. Thus,  <em>p1</em> ,  <em>v3</em> , and  <em>v4</em>  are already  present in the device data environment.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="cm">/*</span>
<span class="cm">* name: target_data.5c</span>
<span class="cm">* type: C++</span>
<span class="cm">* version: omp_4.0</span>
<span class="cm">*/</span>
<span class="kt">void</span> <span class="nf">vec_mult</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span> <span class="o">&amp;</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="o">&amp;</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="o">&amp;</span><span class="p">,</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">init</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">output</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">foo</span><span class="p">(</span><span class="kt">float</span> <span class="o">*</span><span class="n">p0</span><span class="p">,</span> <span class="kt">float</span> <span class="o">*</span><span class="n">v1</span><span class="p">,</span> <span class="kt">float</span> <span class="o">*</span><span class="n">v2</span><span class="p">,</span> <span class="kt">int</span> <span class="n">N</span><span class="p">)</span>
<span class="p">{</span>
   <span class="n">init</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
   <span class="cp">#pragma omp target data map(to: v1[0:N], v2[:N]) map(from: p0[0:N])</span>
   <span class="p">{</span>
      <span class="n">vec_mult</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
   <span class="p">}</span>
   <span class="n">output</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">vec_mult</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span> <span class="o">&amp;</span><span class="n">p1</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="o">&amp;</span><span class="n">v3</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="o">&amp;</span><span class="n">v4</span><span class="p">,</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">N</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
   <span class="cp">#pragma omp target map(to: v3[0:N], v4[:N]) map(from: p1[0:N])</span>
   <span class="cp">#pragma omp parallel for</span>
   <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
     <span class="n">p1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">v4</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="p">}</span>

</pre></div>
</div>
</div>
</div>
<p>In the following example, the usual Fortran approach is used for dynamic memory.  The  <em>p0</em> ,  <em>v1</em> , and  <em>v2</em>  arrays are allocated in the main program and passed as references  from one routine to another. In  <code class="docutils literal notranslate"><span class="pre">vec_mult</span></code> ,  <em>p1</em> ,  <em>v3</em>  and  <em>v4</em>  are references to the   <em>p0</em> ,  <em>v1</em> , and  <em>v2</em>  arrays, respectively. The  <code class="docutils literal notranslate"><span class="pre">target</span></code>  construct’s device data  environment inherits the arrays  <em>p0</em> ,  <em>v1</em> , and  <em>v2</em>  from the enclosing target data construct’s  device data environment. Thus,  <em>p1</em> ,  <em>v3</em> , and  <em>v4</em>  are already present in the device  data environment.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="o">!</span> <span class="nl">name</span><span class="p">:</span> <span class="n">target_data</span><span class="mf">.5f</span>
<span class="o">!</span> <span class="nl">type</span><span class="p">:</span> <span class="n">F</span><span class="o">-</span><span class="n">free</span>
<span class="o">!</span> <span class="nl">version</span><span class="p">:</span>    <span class="n">omp_4</span><span class="mf">.0</span>
<span class="n">module</span> <span class="n">my_mult</span>
<span class="n">contains</span>
<span class="n">subroutine</span> <span class="n">foo</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<span class="n">real</span><span class="p">,</span><span class="n">dimension</span><span class="p">(</span><span class="o">:</span><span class="p">)</span> <span class="o">::</span> <span class="n">p0</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span>
<span class="n">integer</span>           <span class="o">::</span> <span class="n">N</span><span class="p">,</span><span class="n">i</span>
   <span class="n">call</span> <span class="n">init</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
   <span class="o">!</span><span class="n">$omp</span> <span class="n">target</span> <span class="n">data</span> <span class="n">map</span><span class="p">(</span><span class="nl">to</span><span class="p">:</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span> <span class="n">map</span><span class="p">(</span><span class="nl">from</span><span class="p">:</span> <span class="n">p0</span><span class="p">)</span>
    <span class="n">call</span> <span class="n">vec_mult</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
   <span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">target</span> <span class="n">data</span>
   <span class="n">call</span> <span class="n">output</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<span class="n">end</span> <span class="n">subroutine</span>
<span class="n">subroutine</span> <span class="n">vec_mult</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="n">v4</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<span class="n">real</span><span class="p">,</span><span class="n">dimension</span><span class="p">(</span><span class="o">:</span><span class="p">)</span> <span class="o">::</span> <span class="n">p1</span><span class="p">,</span> <span class="n">v3</span><span class="p">,</span> <span class="n">v4</span>
<span class="n">integer</span>           <span class="o">::</span> <span class="n">N</span><span class="p">,</span><span class="n">i</span>
   <span class="o">!</span><span class="n">$omp</span> <span class="n">target</span> <span class="n">map</span><span class="p">(</span><span class="nl">to</span><span class="p">:</span> <span class="n">v3</span><span class="p">,</span> <span class="n">v4</span><span class="p">)</span> <span class="n">map</span><span class="p">(</span><span class="nl">from</span><span class="p">:</span> <span class="n">p1</span><span class="p">)</span>
   <span class="o">!</span><span class="n">$omp</span> <span class="n">parallel</span> <span class="k">do</span>
   <span class="k">do</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
      <span class="n">p1</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">v3</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">v4</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
   <span class="n">end</span> <span class="k">do</span>
   <span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">target</span>
<span class="n">end</span> <span class="n">subroutine</span>
<span class="n">end</span> <span class="n">module</span>
<span class="n">program</span> <span class="n">main</span>
<span class="n">use</span> <span class="n">my_mult</span>
<span class="n">integer</span><span class="p">,</span> <span class="n">parameter</span> <span class="o">::</span> <span class="n">N</span><span class="o">=</span><span class="mi">1024</span>
<span class="n">real</span><span class="p">,</span><span class="n">allocatable</span><span class="p">,</span> <span class="n">dimension</span><span class="p">(</span><span class="o">:</span><span class="p">)</span> <span class="o">::</span> <span class="n">p</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span>
   <span class="n">allocate</span><span class="p">(</span> <span class="n">p</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">v1</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">v2</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="p">)</span>
   <span class="n">call</span> <span class="n">foo</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<span class="n">end</span> <span class="n">program</span>

</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="target-data-construct-with-if-clause">
<h2><code class="docutils literal notranslate"><span class="pre">target</span></code>   <code class="docutils literal notranslate"><span class="pre">data</span></code>  Construct with  <code class="docutils literal notranslate"><span class="pre">if</span></code>  Clause<a class="headerlink" href="#target-data-construct-with-if-clause" title="Permalink to this headline">¶</a></h2>
<p>The following two examples show how the  <code class="docutils literal notranslate"><span class="pre">target</span></code>   <code class="docutils literal notranslate"><span class="pre">data</span></code>  construct  maps variables to a device data environment.</p>
<p>In the following example, the if clause on the  <code class="docutils literal notranslate"><span class="pre">target</span></code>   <code class="docutils literal notranslate"><span class="pre">data</span></code>  construct  indicates that if the variable  <em>N</em>  is smaller than a given threshold, then the  <code class="docutils literal notranslate"><span class="pre">target</span></code>    <code class="docutils literal notranslate"><span class="pre">data</span></code>  construct will not create a device data environment.</p>
<p>The  <code class="docutils literal notranslate"><span class="pre">target</span></code>  constructs enclosed in the  <code class="docutils literal notranslate"><span class="pre">target</span></code>   <code class="docutils literal notranslate"><span class="pre">data</span></code>  region  must also use an  <code class="docutils literal notranslate"><span class="pre">if</span></code>  clause on the same condition, otherwise the pointer  variable  <em>p</em>  is implicitly mapped with a map-type of  <code class="docutils literal notranslate"><span class="pre">tofrom</span></code> , but the storage  location for the array section  <em>p[0:N]</em>  will not be mapped in the device data environments  of the  <code class="docutils literal notranslate"><span class="pre">target</span></code>  constructs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="cm">/*</span>
<span class="cm">* name: target_data.6c</span>
<span class="cm">* type: C</span>
<span class="cm">* version: omp_4.0</span>
<span class="cm">*/</span>
<span class="cp">#define THRESHOLD 1000000</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">init</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">init_again</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">output</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">vec_mult</span><span class="p">(</span><span class="kt">float</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">float</span> <span class="o">*</span><span class="n">v1</span><span class="p">,</span> <span class="kt">float</span> <span class="o">*</span><span class="n">v2</span><span class="p">,</span> <span class="kt">int</span> <span class="n">N</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
   <span class="n">init</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
   <span class="cp">#pragma omp target data if(N&gt;THRESHOLD) map(from: p[0:N])</span>
   <span class="p">{</span>
      <span class="cp">#pragma omp target if (N&gt;THRESHOLD) map(to: v1[:N], v2[:N])</span>
      <span class="cp">#pragma omp parallel for</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">v2</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
      <span class="n">init_again</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
      <span class="cp">#pragma omp target if (N&gt;THRESHOLD) map(to: v1[:N], v2[:N])</span>
      <span class="cp">#pragma omp parallel for</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">v1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">v2</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
   <span class="p">}</span>
   <span class="n">output</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
<span class="p">}</span>

</pre></div>
</div>
</div>
</div>
<p>The  <code class="docutils literal notranslate"><span class="pre">if</span></code>  clauses work the same way for the following Fortran . The  <code class="docutils literal notranslate"><span class="pre">target</span></code>   constructs enclosed in the  <code class="docutils literal notranslate"><span class="pre">target</span></code>   <code class="docutils literal notranslate"><span class="pre">data</span></code>  region should also use  an  <code class="docutils literal notranslate"><span class="pre">if</span></code>  clause with the same condition, so that the  <code class="docutils literal notranslate"><span class="pre">target</span></code>   <code class="docutils literal notranslate"><span class="pre">data</span></code>   region and the  <code class="docutils literal notranslate"><span class="pre">target</span></code>  region are either both created for the device, or  are both ignored.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="o">!</span> <span class="nl">name</span><span class="p">:</span> <span class="n">target_data</span><span class="mf">.6f</span>
<span class="o">!</span> <span class="nl">type</span><span class="p">:</span> <span class="n">F</span><span class="o">-</span><span class="n">free</span>
<span class="o">!</span> <span class="nl">version</span><span class="p">:</span>    <span class="n">omp_4</span><span class="mf">.0</span>
<span class="n">module</span> <span class="n">params</span>
<span class="n">integer</span><span class="p">,</span><span class="n">parameter</span> <span class="o">::</span> <span class="n">THRESHOLD</span><span class="o">=</span><span class="mi">1000000</span>
<span class="n">end</span> <span class="n">module</span>
<span class="n">subroutine</span> <span class="n">vec_mult</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
   <span class="n">use</span> <span class="n">params</span>
   <span class="n">real</span>    <span class="o">::</span>  <span class="n">p</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">v1</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">v2</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
   <span class="n">integer</span> <span class="o">::</span>  <span class="n">i</span>
   <span class="n">call</span> <span class="n">init</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
   <span class="o">!</span><span class="n">$omp</span> <span class="n">target</span> <span class="n">data</span> <span class="k">if</span><span class="p">(</span><span class="n">N</span><span class="o">&gt;</span><span class="n">THRESHOLD</span><span class="p">)</span> <span class="n">map</span><span class="p">(</span><span class="nl">from</span><span class="p">:</span> <span class="n">p</span><span class="p">)</span>
      <span class="o">!</span><span class="n">$omp</span> <span class="n">target</span> <span class="k">if</span><span class="p">(</span><span class="n">N</span><span class="o">&gt;</span><span class="n">THRESHOLD</span><span class="p">)</span> <span class="n">map</span><span class="p">(</span><span class="nl">to</span><span class="p">:</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span>
         <span class="o">!</span><span class="n">$omp</span> <span class="n">parallel</span> <span class="k">do</span>
         <span class="k">do</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
            <span class="n">p</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">v1</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">v2</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
         <span class="n">end</span> <span class="k">do</span>
      <span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">target</span>
      <span class="n">call</span> <span class="n">init_again</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
      <span class="o">!</span><span class="n">$omp</span> <span class="n">target</span> <span class="k">if</span><span class="p">(</span><span class="n">N</span><span class="o">&gt;</span><span class="n">THRESHOLD</span><span class="p">)</span> <span class="n">map</span><span class="p">(</span><span class="nl">to</span><span class="p">:</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span>
         <span class="o">!</span><span class="n">$omp</span> <span class="n">parallel</span> <span class="k">do</span>
         <span class="k">do</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
            <span class="n">p</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">p</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">v1</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">v2</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
         <span class="n">end</span> <span class="k">do</span>
      <span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">target</span>
   <span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">target</span> <span class="n">data</span>
   <span class="n">call</span> <span class="n">output</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<span class="n">end</span> <span class="n">subroutine</span>

</pre></div>
</div>
</div>
</div>
<p>In the following example, when the  <code class="docutils literal notranslate"><span class="pre">if</span></code>  clause conditional expression on  the  <code class="docutils literal notranslate"><span class="pre">target</span></code>  construct evaluates to  <em>false</em> , the target region will  execute on the host device. However, the  <code class="docutils literal notranslate"><span class="pre">target</span></code>   <code class="docutils literal notranslate"><span class="pre">data</span></code>  construct  created an enclosing device data environment that mapped  <em>p[0:N]</em>  to a device data  environment on the default device. At the end of the  <code class="docutils literal notranslate"><span class="pre">target</span></code>   <code class="docutils literal notranslate"><span class="pre">data</span></code>   region the array section  <em>p[0:N]</em>  will be assigned from the device data environment  to the corresponding variable in the data environment of the task that encountered  the  <code class="docutils literal notranslate"><span class="pre">target</span></code>   <code class="docutils literal notranslate"><span class="pre">data</span></code>  construct, resulting in undefined values in  <em>p[0:N]</em> .</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="cm">/*</span>
<span class="cm">* name: target_data.7c</span>
<span class="cm">* type: C</span>
<span class="cm">* version: omp_4.0</span>
<span class="cm">*/</span>
<span class="cp">#define THRESHOLD 1000000</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">init</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">output</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">vec_mult</span><span class="p">(</span><span class="kt">float</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">float</span> <span class="o">*</span><span class="n">v1</span><span class="p">,</span> <span class="kt">float</span> <span class="o">*</span><span class="n">v2</span><span class="p">,</span> <span class="kt">int</span> <span class="n">N</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
   <span class="n">init</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
   <span class="cp">#pragma omp target data map(from: p[0:N])</span>
   <span class="p">{</span>
      <span class="cp">#pragma omp target if (N&gt;THRESHOLD) map(to: v1[:N], v2[:N])</span>
      <span class="cp">#pragma omp parallel for</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">v2</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
   <span class="p">}</span> <span class="cm">/* UNDEFINED behavior if N&lt;=THRESHOLD */</span>
   <span class="n">output</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
<span class="p">}</span>

</pre></div>
</div>
</div>
</div>
<p>The  <code class="docutils literal notranslate"><span class="pre">if</span></code>  clauses work the same way for the following Fortran . When  the  <code class="docutils literal notranslate"><span class="pre">if</span></code>  clause conditional expression on the  <code class="docutils literal notranslate"><span class="pre">target</span></code>  construct  evaluates to  <em>false</em> , the  <code class="docutils literal notranslate"><span class="pre">target</span></code>  region will execute on the host  device. However, the  <code class="docutils literal notranslate"><span class="pre">target</span></code>   <code class="docutils literal notranslate"><span class="pre">data</span></code>  construct created an enclosing  device data environment that mapped the  <em>p</em>  array (and  <em>v1</em>  and  <em>v2</em> ) to a device data  environment on the default target device. At the end of the  <code class="docutils literal notranslate"><span class="pre">target</span></code>   <code class="docutils literal notranslate"><span class="pre">data</span></code>   region the  <em>p</em>  array will be assigned from the device data environment to the corresponding  variable in the data environment of the task that encountered the  <code class="docutils literal notranslate"><span class="pre">target</span></code>    <code class="docutils literal notranslate"><span class="pre">data</span></code>  construct, resulting in undefined values in  <em>p</em> .</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="o">!</span> <span class="nl">name</span><span class="p">:</span> <span class="n">target_data</span><span class="mf">.7f</span>
<span class="o">!</span> <span class="nl">type</span><span class="p">:</span> <span class="n">F</span><span class="o">-</span><span class="n">free</span>
<span class="o">!</span> <span class="nl">version</span><span class="p">:</span>    <span class="n">omp_4</span><span class="mf">.0</span>
<span class="n">module</span> <span class="n">params</span>
<span class="n">integer</span><span class="p">,</span> <span class="n">parameter</span> <span class="o">::</span> <span class="n">THRESHOLD</span><span class="o">=</span><span class="mi">1000000</span>
<span class="n">end</span> <span class="n">module</span>
<span class="n">subroutine</span> <span class="n">vec_mult</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
   <span class="n">use</span> <span class="n">params</span>
   <span class="n">real</span>    <span class="o">::</span>  <span class="n">p</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">v1</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">v2</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
   <span class="n">integer</span> <span class="o">::</span>  <span class="n">i</span>
   <span class="n">call</span> <span class="n">init</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
   <span class="o">!</span><span class="n">$omp</span> <span class="n">target</span> <span class="n">data</span> <span class="n">map</span><span class="p">(</span><span class="nl">from</span><span class="p">:</span> <span class="n">p</span><span class="p">)</span>
      <span class="o">!</span><span class="n">$omp</span> <span class="n">target</span> <span class="k">if</span><span class="p">(</span><span class="n">N</span><span class="o">&gt;</span><span class="n">THRESHOLD</span><span class="p">)</span> <span class="n">map</span><span class="p">(</span><span class="nl">to</span><span class="p">:</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span>
         <span class="o">!</span><span class="n">$omp</span> <span class="n">parallel</span> <span class="k">do</span>
         <span class="k">do</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
            <span class="n">p</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">v1</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">v2</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
         <span class="n">end</span> <span class="k">do</span>
      <span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">target</span>
   <span class="o">!</span><span class="n">$omp</span> <span class="n">end</span> <span class="n">target</span> <span class="n">data</span>
   <span class="n">call</span> <span class="n">output</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>  <span class="o">!***</span> <span class="n">UNDEFINED</span> <span class="n">behavior</span> <span class="k">if</span> <span class="n">N</span><span class="o">&lt;=</span><span class="n">THRESHOLD</span>
<span class="n">end</span> <span class="n">subroutine</span>

</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "native"
        },
        kernelOptions: {
            kernelName: "native",
            path: "./contents"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'native'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="Examples_target_mapper.html" title="previous page"><code class="docutils literal notranslate"><span class="pre">declare</span> <span class="pre">mapper</span></code>  Construct</a>
    <a class='right-next' id="next-link" href="Examples_target_unstructured_data.html" title="next page"><code class="docutils literal notranslate"><span class="pre">target</span></code>   <code class="docutils literal notranslate"><span class="pre">enter</span></code>   <code class="docutils literal notranslate"><span class="pre">data</span></code>  and  <code class="docutils literal notranslate"><span class="pre">target</span></code>   <code class="docutils literal notranslate"><span class="pre">exit</span></code>   <code class="docutils literal notranslate"><span class="pre">data</span></code>  Constructs</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The OpenMP Community<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>